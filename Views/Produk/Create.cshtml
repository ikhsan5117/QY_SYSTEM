@model AplikasiCheckDimensi.ViewModels.CreateProdukWithStandarViewModel
@{
    ViewData["Title"] = "Tambah Produk Baru";
    Layout = "_LayoutDesktop";
}

<style>
    .create-container {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .page-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: white;
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .header-title {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .header-title i {
        font-size: 48px;
    }

    .header-title h1 {
        font-size: 28px;
        font-weight: 800;
        margin: 0;
    }

    .btn-back {
        padding: 12px 20px;
        background: white;
        color: #1e293b;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
    }

    .btn-back:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        color: #1e293b;
    }

    .form-sections {
        display: grid;
        gap: 20px;
    }

    .form-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        overflow: hidden;
    }

    .section-header {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        padding: 20px 30px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .section-header i {
        font-size: 24px;
    }

    .section-header h2 {
        font-size: 18px;
        font-weight: 700;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .section-body {
        padding: 30px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .form-grid-full {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-group label {
        font-weight: 700;
        color: #1e293b;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .form-group label .required {
        color: #ef4444;
    }

    .form-control {
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        font-weight: 600;
    }

    .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    .form-control:disabled {
        background: #f1f5f9;
        color: #64748b;
        cursor: not-allowed;
    }

    /* Dimension Fields */
    .dimension-fields {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
    }

    .dimension-group {
        background: #f8fafc;
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #3b82f6;
    }

    .dimension-label {
        font-size: 12px;
        font-weight: 700;
        color: #64748b;
        text-transform: uppercase;
        margin-bottom: 10px;
        display: block;
    }

    .dimension-inputs {
        display: grid;
        gap: 8px;
    }

    .dimension-input-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .dimension-input-group span {
        font-size: 11px;
        font-weight: 700;
        color: #64748b;
        width: 35px;
    }

    .dimension-input-group input {
        flex: 1;
        padding: 8px 10px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
    }

    .dimension-input-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Upload Areas */
    .upload-area {
        border: 3px dashed #cbd5e1;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        background: #f8fafc;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .upload-area:hover {
        border-color: #3b82f6;
        background: #eff6ff;
    }

    .upload-area i {
        font-size: 48px;
        color: #94a3b8;
        margin-bottom: 15px;
    }

    .upload-area h4 {
        font-size: 16px;
        color: #1e293b;
        margin-bottom: 8px;
        font-weight: 700;
    }

    .upload-area p {
        font-size: 13px;
        color: #64748b;
        margin: 0;
    }

    .upload-area input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }

    .file-preview {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background: #eff6ff;
        border-radius: 10px;
        border: 2px solid #3b82f6;
    }

    .file-preview.show {
        display: block;
    }

    .file-preview-name {
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 5px;
    }

    .file-preview-size {
        font-size: 13px;
        color: #64748b;
        margin-bottom: 10px;
    }

    .progress-container {
        margin-top: 10px;
    }

    .progress-bar-wrapper {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 5px;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        transition: width 0.3s ease;
        border-radius: 10px;
    }

    .progress-text {
        font-size: 12px;
        font-weight: 600;
        color: #3b82f6;
        text-align: center;
    }

    .upload-success {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #10b981;
        font-weight: 700;
        font-size: 13px;
        margin-top: 5px;
    }

    /* Form Actions */
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        padding: 30px;
        background: #f8fafc;
        margin-top: 30px;
        border-radius: 16px;
    }

    .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
    }

    .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
        background: #e2e8f0;
        color: #64748b;
    }

    .btn-secondary:hover {
        background: #cbd5e1;
        color: #475569;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
    }

    .alert-info {
        background: #dbeafe;
        color: #1e40af;
        border-left: 4px solid #3b82f6;
    }

    .packing-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 2fr;
        gap: 20px;
    }
</style>

<div class="create-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-title">
            <i class="bi bi-plus-circle"></i>
            <h1>Tambah Produk Baru</h1>
        </div>
        <a href="@Url.Action("Index", "Produk")" class="btn-back">
            <i class="bi bi-arrow-left"></i>
            Kembali
        </a>
    </div>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        <div class="form-sections">
            
            <!-- Section 1: Informasi Produk -->
            <div class="form-section">
                <div class="section-header" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    <i class="bi bi-info-circle"></i>
                    <h2>Informasi Produk</h2>
                </div>
                <div class="section-body">
                    <div class="alert alert-info">
                        <i class="bi bi-lightbulb"></i>
                        <span>Field yang ditandai dengan <span style="color: #ef4444;">*</span> wajib diisi</span>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                Part Name
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.NamaProduk" 
                                   placeholder="Masukkan nama part...">
                            <span asp-validation-for="Produk.NamaProduk" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label>Part No</label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.PartNo" 
                                   placeholder="Masukkan part number...">
                        </div>

                        <div class="form-group">
                            <label>Part Code</label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.PartCode" 
                                   placeholder="Masukkan part code...">
                        </div>

                        <div class="form-group">
                            <label>CT (Cycle Time) - detik</label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.CT" 
                                   placeholder="Contoh: 60">
                        </div>

                        <div class="form-group">
                            <label>Plant</label>
                            <select class="form-control" asp-for="Produk.Plant">
                                <option value="">-- Pilih Plant --</option>
                                <option value="BTR">BTR</option>
                                <option value="MOLDED">MOLDED</option>
                                <option value="HOSE">HOSE</option>
                                <option value="RVI">RVI</option>
                                <option value="MIXING">MIXING</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Identifikasi Item</label>
                            <select class="form-control" asp-for="Produk.IdentifikasiItem">
                                <option value="">-- Pilih Identifikasi --</option>
                                <option value="Delta S">Delta S</option>
                                <option value="Delta R">Delta R</option>
                                <option value="Function">Function</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                Operator / PIC
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.Operator" 
                                   placeholder="Masukkan nama operator...">
                            <span asp-validation-for="Produk.Operator" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Informasi Dimensi -->
            <div class="form-section">
                <div class="section-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <i class="bi bi-rulers"></i>
                    <h2>Standar Dimensi</h2>
                </div>
                <div class="section-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <span>Masukkan nilai Min dan Max untuk setiap dimensi yang diukur (dalam mm)</span>
                    </div>

                    <!-- SISI A -->
                    <h3 style="color: #059669; margin: 20px 0 15px 0; font-size: 1.1rem; font-weight: 600;">
                        <i class="bi bi-square"></i> SISI A
                    </h3>
                    <div class="dimension-fields">
                        <!-- Inner Diameter Sisi A -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-circle"></i> Inner Diameter
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.InnerDiameter_SisiA_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.InnerDiameter_SisiA_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- Outer Diameter Sisi A -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-circle"></i> Outer Diameter
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.OuterDiameter_SisiA_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.OuterDiameter_SisiA_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- Thickness Sisi A -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-arrows-expand"></i> Thickness
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_SisiA_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_SisiA_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SISI B -->
                    <h3 style="color: #059669; margin: 30px 0 15px 0; font-size: 1.1rem; font-weight: 600;">
                        <i class="bi bi-square"></i> SISI B
                    </h3>
                    <div class="dimension-fields">
                        <!-- Inner Diameter Sisi B -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-circle"></i> Inner Diameter
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.InnerDiameter_SisiB_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.InnerDiameter_SisiB_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- Outer Diameter Sisi B -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-circle"></i> Outer Diameter
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.OuterDiameter_SisiB_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.OuterDiameter_SisiB_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- Thickness Sisi B -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-arrows-expand"></i> Thickness
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_SisiB_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_SisiB_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dimensi Lainnya -->
                    <h3 style="color: #059669; margin: 30px 0 15px 0; font-size: 1.1rem; font-weight: 600;">
                        <i class="bi bi-arrows-fullscreen"></i> Dimensi Lainnya
                    </h3>
                    <div class="dimension-fields">
                        <!-- Thickness (OLD - Untuk backward compatibility) -->
                        <div class="dimension-group" style="display: none;">
                            <span class="dimension-label">
                                <i class="bi bi-arrows-expand"></i> Thickness (Legacy)
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Thickness_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- Panjang -->
                        <div class="dimension-group">
                            <span class="dimension-label">
                                <i class="bi bi-arrows-vertical"></i> Panjang
                            </span>
                            <div class="dimension-inputs">
                                <div class="dimension-input-group">
                                    <span>Min:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Panjang_Min" 
                                           placeholder="0.00">
                                </div>
                                <div class="dimension-input-group">
                                    <span>Max:</span>
                                    <input type="number" 
                                           step="0.01" 
                                           asp-for="StandarDimensi.Panjang_Max" 
                                           placeholder="0.00">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Standar Checking Fixture -->
            <div class="form-section">
                <div class="section-header" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">
                    <i class="bi bi-clipboard-check"></i>
                    <h2>Standar Checking Fixture</h2>
                </div>
                <div class="section-body">
                    <div class="packing-grid">
                        <div class="form-group" style="grid-column: 1 / 2;">
                            <label>Standar C/F</label>
                            <textarea class="form-control" 
                                      asp-for="Produk.StandarCF" 
                                      rows="3" 
                                      placeholder="Masukkan standar checking fixture..."></textarea>
                        </div>

                        <div class="form-group" style="grid-column: 2 / 4;">
                            <label>Gambar C/F</label>
                            <div class="upload-area" id="cfUploadArea">
                                <input type="file" 
                                       name="GambarCFFile" 
                                       id="gambarCFFile" 
                                       accept="image/*"
                                       onchange="handleFileSelect(event, 'cf')">
                                <i class="bi bi-image"></i>
                                <h4>Upload Gambar Checking Fixture</h4>
                                <p>Format: JPG, PNG • Max 5MB</p>
                            </div>
                            <div class="file-preview" id="cfPreview">
                                <div class="file-preview-name" id="cfFileName"></div>
                                <div class="file-preview-size" id="cfFileSize"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 4: Informasi Packing -->
            <div class="form-section">
                <div class="section-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    <i class="bi bi-box"></i>
                    <h2>Informasi Packing</h2>
                </div>
                <div class="section-body">
                    <div class="packing-grid">
                        <div class="form-group">
                            <label>Type Box</label>
                            <input type="text" 
                                   class="form-control" 
                                   asp-for="Produk.TypeBox" 
                                   placeholder="Contoh: Carton A">
                        </div>

                        <div class="form-group">
                            <label>Qty / Box</label>
                            <input type="number" 
                                   class="form-control" 
                                   asp-for="Produk.QtyPerBox" 
                                   placeholder="Contoh: 100">
                        </div>

                        <div class="form-group">
                            <label>Gambar Packing</label>
                            <div class="upload-area" id="packingUploadArea">
                                <input type="file" 
                                       name="GambarPackingFile" 
                                       id="gambarPackingFile" 
                                       accept="image/*"
                                       onchange="handleFileSelect(event, 'packing')">
                                <i class="bi bi-image"></i>
                                <h4>Upload Gambar Packing</h4>
                                <p>Format: JPG, PNG • Max 5MB</p>
                            </div>
                            <div class="file-preview" id="packingPreview">
                                <div class="file-preview-name" id="packingFileName"></div>
                                <div class="file-preview-size" id="packingFileSize"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 5: Upload Video Checking -->
            <div class="form-section">
                <div class="section-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <i class="bi bi-camera-video"></i>
                    <h2>Video SOP Checking</h2>
                </div>
                <div class="section-body">
                    <div class="form-group">
                        <div class="upload-area" id="videoUploadArea">
                            <input type="file" 
                                   name="VideoFile" 
                                   id="videoFile" 
                                   accept="video/*"
                                   onchange="handleFileSelect(event, 'video')">
                            <i class="bi bi-camera-video"></i>
                            <h4>Upload Video SOP</h4>
                            <p>Format: MP4, AVI, MOV • Max 500MB</p>
                        </div>
                        <div class="file-preview" id="videoPreview">
                            <div class="file-preview-name" id="videoFileName"></div>
                            <div class="file-preview-size" id="videoFileSize"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <a href="@Url.Action("Index", "Produk")" class="btn btn-secondary">
                <i class="bi bi-x-circle"></i>
                Batal
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle"></i>
                Simpan Produk
            </button>
        </div>
    </form>
</div>

<script>
function handleFileSelect(event, type) {
    const file = event.target.files[0];
    if (!file) return;

    const previewId = type + 'Preview';
    const fileNameId = type + 'FileName';
    const fileSizeId = type + 'FileSize';

    // Show preview
    const previewElement = document.getElementById(previewId);
    previewElement.classList.add('show');
    document.getElementById(fileNameId).textContent = file.name;
    document.getElementById(fileSizeId).textContent = formatFileSize(file.size);

    // Create progress bar if doesn't exist
    let progressContainer = previewElement.querySelector('.progress-container');
    if (!progressContainer) {
        progressContainer = document.createElement('div');
        progressContainer.className = 'progress-container';
        progressContainer.innerHTML = `
            <div class="progress-bar-wrapper">
                <div class="progress-bar" id="${type}ProgressBar" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="${type}ProgressText">Preparing...</div>
        `;
        previewElement.appendChild(progressContainer);
    }

    // Simulate upload progress (since we're using form submit, this is just visual feedback)
    simulateProgress(type);
}

function simulateProgress(type) {
    const progressBar = document.getElementById(type + 'ProgressBar');
    const progressText = document.getElementById(type + 'ProgressText');
    let progress = 0;

    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            progressBar.style.width = '100%';
            progressText.innerHTML = '<span class="upload-success"><i class="bi bi-check-circle"></i> Ready to upload</span>';
        } else {
            progressBar.style.width = progress + '%';
            progressText.textContent = Math.round(progress) + '%';
        }
    }, 200);
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
