@model AplikasiCheckDimensi.Models.QCHoseData
@{
    ViewData["Title"] = "E_LWP";
    Layout = "_LayoutDesktop";
}

<style>
    .qchose-page {
        max-width: 480px;
        margin: 0 auto;
        padding: 20px 16px 100px 16px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: #f1f5f9;
    }

    /* Tablet: lebar penuh dan perbesar elemen - OVERRIDE AGRESIF */
    @@media (min-width: 768px) and (max-width: 1024px) {
        /* Override SEMUA container parent - level paling atas */
        body.desktop-view,
        body {
            overflow-x: hidden !important;
        }
        
        body.desktop-view .main-content {
            margin-left: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
            padding: 0 !important;
        }
        
        /* Override content-area dengan selektor yang lebih spesifik */
        body.desktop-view .main-content .content-area,
        body .main-content .content-area,
        .content-area,
        div.content-area {
            padding: 0 !important;
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }
        
        /* Pastikan form benar-benar full width - HAPUS SEMUA PADDING/MARGIN */
        body.desktop-view .main-content .content-area .qchose-page,
        body .main-content .content-area .qchose-page,
        .content-area .qchose-page,
        .qchose-page,
        div.qchose-page {
            max-width: 100% !important;
            width: 100% !important;
            padding: 16px 0 100px 0 !important;
            margin: 0 !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            box-sizing: border-box !important;
            position: relative !important;
        }
        
        /* Override khusus untuk body dan html agar tidak ada scroll horizontal */
        html, body {
            overflow-x: hidden !important;
            max-width: 100% !important;
        }
        
        /* Pastikan semua wrapper tidak membatasi */
        body.desktop-view .main-content > *,
        body.desktop-view .main-content .content-area > *,
        .main-content > *,
        .main-content .content-area > * {
            max-width: 100% !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }
        
        /* Pastikan form section juga full width - HAPUS SEMUA PADDING */
        .qchose-page form,
        form[method="post"][action="/QCHose/Create"] {
            width: 100% !important;
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }
        
        /* Pastikan section form juga tidak ada margin dan full width */
        .qchose-page .qchose-section {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
        
        /* Pastikan semua input dan select juga full width */
        .qchose-page .qchose-select,
        .qchose-page .qchose-input,
        .qchose-page form .qchose-select,
        .qchose-page form .qchose-input {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
        }
        
        /* Override untuk wrapper section agar tidak ada padding ekstra */
        .qchose-page > * {
            padding-left: 12px !important;
            padding-right: 12px !important;
            box-sizing: border-box !important;
        }
        
        .qchose-page form {
            padding-left: 12px !important;
            padding-right: 12px !important;
        }
        
        /* Perbesar header untuk tablet */
        .qchose-header-title {
            font-size: 28px !important;
            margin-bottom: 8px !important;
            color: #f1f5f9 !important;
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 50%, #3b82f6 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5) !important;
            filter: drop-shadow(0 2px 10px rgba(59, 130, 246, 0.4)) !important;
        }
        
        .qchose-header-subtitle {
            font-size: 15px !important;
            margin-bottom: 24px !important;
        }
        
        /* Perbesar section dengan padding yang efisien */
        .qchose-section {
            padding: 18px 16px !important;
            margin-bottom: 20px !important;
            border-radius: 18px !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        /* Perbesar label */
        .qchose-label {
            font-size: 15px !important;
            margin-bottom: 8px !important;
        }
        
        /* Perbesar input dan select */
        .qchose-select,
        .qchose-input {
            padding: 14px 16px !important;
            font-size: 17px !important;
            border-radius: 12px !important;
        }
        
        /* Perbesar input dengan max-width khusus (Qty NG) */
        .qchose-input[style*="max-width"] {
            max-width: 180px !important;
        }
        
        /* Perbesar radio button dan text */
        .qchose-radio-item {
            font-size: 17px !important;
            gap: 8px !important;
        }
        
        .qchose-radio-item input[type="radio"] {
            width: 20px !important;
            height: 20px !important;
        }
        
        /* Perbesar inline row (Part Code area) */
        .qchose-inline-row {
            gap: 10px !important;
            margin-top: 8px !important;
        }
        
        /* Perbesar tombol QR */
        .qchose-btn-qr {
            width: 50px !important;
            height: 50px !important;
            font-size: 22px !important;
            border-radius: 12px !important;
        }
        
        /* Perbesar tombol Dimensi */
        .qchose-btn-dimensi {
            padding: 14px 18px !important;
            font-size: 15px !important;
            border-radius: 12px !important;
        }
        
        /* Perbesar time stop */
        .qchose-time-stop {
            font-size: 17px !important;
            margin-top: 10px !important;
        }
        
        .qchose-time-stop-label {
            font-size: 17px !important;
        }
        
        .qchose-time-stop-value {
            font-size: 19px !important;
        }
        
        /* Perbesar section title */
        .qchose-section-title {
            font-size: 17px !important;
            margin-bottom: 10px !important;
        }
        
        /* Perbesar tombol utama */
        .qchose-btn-primary,
        .qchose-btn-secondary {
            padding: 16px 20px !important;
            font-size: 17px !important;
            border-radius: 14px !important;
            margin-top: 10px !important;
        }
        
        /* Perbesar status indicator */
        .qchose-status-label {
            font-size: 17px !important;
        }
        
        .qchose-status-dot {
            width: 16px !important;
            height: 16px !important;
        }
        
        .qchose-status-time {
            font-size: 18px !important;
        }
        
        /* Perbesar line stop timer */
        .line-stop-timer-container {
            padding: 18px !important;
            margin-top: 18px !important;
            border-radius: 12px !important;
        }
        
        .line-stop-checking-label {
            font-size: 17px !important;
        }
        
        .line-stop-timer-display {
            font-size: 20px !important;
        }
        
        /* Perbesar toggle switch */
        .toggle-switch {
            transform: scale(1.15) !important;
        }
        
        /* Perbesar alert */
        .alert {
            padding: 14px 18px !important;
            font-size: 15px !important;
            margin-bottom: 18px !important;
        }
        
        /* Perbesar text danger (validation) */
        .text-danger {
            font-size: 13px !important;
        }
        
        /* Perbesar back button */
        .qchose-header-back {
            padding: 10px 14px !important;
            font-size: 15px !important;
        }
        
        /* Pastikan tombol home tetap terlihat dan posisinya tepat - FIXED saat scroll */
        .data-menu-icon-btn-fixed,
        #btnLihatData {
            position: fixed !important;
            bottom: 15px !important;
            right: 15px !important;
            left: auto !important;
            z-index: 99999 !important;
            transform: none !important;
            margin: 0 !important;
            top: auto !important;
        }
        
        .data-menu-icon-btn-fixed:hover,
        #btnLihatData:hover {
            transform: scale(1.05) !important;
            right: 15px !important;
            left: auto !important;
        }
        
        .data-menu-icon-btn-fixed:active,
        #btnLihatData:active {
            right: 15px !important;
            left: auto !important;
        }
        
        /* Pastikan inner button tidak terlalu besar */
        .data-menu-icon-btn-fixed .data-menu-icon-inner,
        #btnLihatData .data-menu-icon-inner {
            width: 56px !important;
            height: 56px !important;
        }
    }

    .qchose-header {
        position: relative;
    }

    .qchose-header-back {
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 8px;
        padding: 8px 12px;
        color: #f1f5f9;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .qchose-header-back:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.4);
        color: #f1f5f9;
        box-shadow: 
            0 4px 12px rgba(59, 130, 246, 0.3),
            0 0 15px rgba(59, 130, 246, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transform: translateY(-50%) translateX(2px);
    }

    .qchose-header-title {
        font-size: 24px;
        font-weight: 800;
        text-align: center;
        letter-spacing: 1px;
        margin-bottom: 4px;
        color: #f1f5f9;
        background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 50%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        filter: drop-shadow(0 2px 10px rgba(59, 130, 246, 0.4));
    }

    .qchose-header-subtitle {
        text-align: center;
        font-size: 13px;
        color: #94a3b8;
        margin-bottom: 20px;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .qchose-section {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 
            0 4px 16px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        margin-bottom: 16px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .qchose-section:hover {
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.5),
            0 0 20px rgba(59, 130, 246, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        border-color: rgba(59, 130, 246, 0.3);
    }
    
    /* Spacing khusus untuk Line Stop section */
    #lineStopSelect {
        margin-bottom: 16px;
    }

    .qchose-label {
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: #f1f5f9;
        margin-bottom: 6px;
        background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.3));
    }

    .qchose-select,
    .qchose-input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 14px;
        outline: none;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        color: #f1f5f9 !important;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .qchose-select::placeholder,
    .qchose-input::placeholder {
        color: #94a3b8;
        opacity: 0.6;
    }
    
    .qchose-select option {
        background: rgba(15, 23, 42, 0.95);
        color: #f1f5f9;
    }

    .qchose-select:focus,
    .qchose-input:focus {
        border-color: #3b82f6;
        background: rgba(15, 23, 42, 0.8);
        box-shadow: 
            0 0 0 3px rgba(59, 130, 246, 0.2),
            0 0 20px rgba(59, 130, 246, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .qchose-radio-group {
        display: flex;
        gap: 32px;
        align-items: center;
        margin-top: 4px;
        margin-bottom: 4px;
    }

    .qchose-radio-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        color: #f1f5f9;
    }

    .qchose-inline-row {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 4px;
    }

    .qchose-partcode-input {
        flex: 1;
    }

    .qchose-partcode-input:disabled {
        background-color: #f3f4f6 !important;
        cursor: not-allowed !important;
        color: #6b7280;
    }

    .line-stop-message {
        position: absolute;
        top: 50%;
        left: 12px;
        transform: translateY(-50%);
        background: #fef3c7;
        color: #92400e;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        pointer-events: none;
        z-index: 10;
        border: 1px solid #fbbf24;
    }

    .line-stop-message i {
        font-size: 14px;
    }

    .qchose-inline-row > div:first-child {
        position: relative;
        flex: 1;
    }

    .line-stop-message {
        position: absolute;
        top: 50%;
        left: 12px;
        transform: translateY(-50%);
        background: #fef3c7;
        color: #92400e;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        pointer-events: none;
        z-index: 10;
        border: 1px solid #fbbf24;
    }

    .line-stop-message i {
        font-size: 14px;
    }

    .qchose-inline-row {
        position: relative;
    }

    /* Line Stop Warning Modal */
    .line-stop-warning-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .line-stop-warning-content {
        background: white;
        border-radius: 16px;
        padding: 0;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        animation: slideUp 0.3s ease;
    }

    @@keyframes slideUp {
        from {
            transform: translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .line-stop-warning-header {
        padding: 24px 24px 16px;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
    }

    .line-stop-warning-header h3 {
        margin: 12px 0 0;
        font-size: 20px;
        font-weight: 700;
        color: #111827;
    }

    .line-stop-warning-body {
        padding: 24px;
        text-align: center;
    }

    .line-stop-warning-body p {
        margin: 8px 0;
        font-size: 15px;
        color: #374151;
        line-height: 1.5;
    }

    .line-stop-warning-body p strong {
        color: #111827;
        font-weight: 600;
    }

    .line-stop-warning-footer {
        padding: 16px 24px 24px;
        text-align: center;
    }

    .line-stop-warning-btn {
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 12px 32px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: background 0.2s;
    }

    .line-stop-warning-btn:hover {
        background: #2563eb;
    }

    .line-stop-warning-btn:active {
        transform: scale(0.98);
    }

    /* Data Menu Icon Button - Lingkaran Ungu Fixed Position */
    .data-menu-icon-btn-fixed {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        left: auto !important;
        background: none !important;
        border: none !important;
        padding: 0 !important;
        cursor: pointer;
        outline: none;
        z-index: 9999 !important;
        transition: transform 0.2s;
        transform: none !important;
        top: auto !important;
    }

    .data-menu-icon-btn-fixed:hover {
        transform: scale(1.1);
    }

    .data-menu-icon-inner {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        transition: transform 0.2s;
    }

    .data-menu-icon-btn-fixed:hover .data-menu-icon-inner {
        transform: scale(1.05);
    }

    .data-menu-icon-btn-fixed:active .data-menu-icon-inner {
        transform: scale(0.95);
    }

    /* Mobile: tengah bawah - tetap FIXED position */
    @@media (max-width: 767px) {
        .data-menu-icon-btn-fixed,
        #btnLihatData {
            position: fixed !important;
            bottom: 20px !important;
            right: 50% !important;
            left: auto !important;
            transform: translateX(50%) !important;
            z-index: 9999 !important;
            top: auto !important;
        }

        .data-menu-icon-btn-fixed:hover,
        #btnLihatData:hover {
            transform: translateX(50%) scale(1.1) !important;
        }
    }

    /* Tablet: kanan bawah - di-handle oleh media query di atas (line 17) */

    /* Desktop: kanan bawah - tetap FIXED */
    @@media (min-width: 1025px) {
        .data-menu-icon-btn-fixed,
        #btnLihatData {
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
            left: auto !important;
            transform: none !important;
            z-index: 9999 !important;
            top: auto !important;
        }

        .data-menu-icon-btn-fixed:hover,
        #btnLihatData:hover {
            transform: scale(1.1) !important;
        }
    }

    /* Data Menu Modal */
    .data-menu-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        animation: fadeIn 0.3s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .data-menu-content {
        background: white;
        border-radius: 20px;
        padding: 24px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
    }

    @@keyframes slideUp {
        from {
            transform: translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .data-menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e5e7eb;
    }

    .data-menu-title {
        font-size: 24px;
        font-weight: 700;
        color: #111827;
        letter-spacing: 2px;
    }

    .data-menu-close {
        background: #f3f4f6;
        border: none;
        border-radius: 8px;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #6b7280;
        font-size: 18px;
        transition: all 0.2s;
    }

    .data-menu-close:hover {
        background: #e5e7eb;
        color: #111827;
    }

    .data-menu-body {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .data-menu-row {
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: space-between;
    }

    .data-menu-btn {
        flex: 1;
        padding: 14px 20px;
        background: #374151;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
    }

    .data-menu-btn:hover {
        background: #4b5563;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(55, 65, 81, 0.3);
    }

    .data-menu-btn:active {
        transform: translateY(0);
    }

    .data-menu-icon-circle {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .data-menu-icon-circle:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
    }

    .data-menu-icon-circle:active {
        transform: scale(0.95);
    }

    .data-menu-footer {
        display: flex;
        justify-content: center;
        margin-top: 8px;
    }

    .qchose-btn-qr {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        background-color: #f9fafb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #111827;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        z-index: 1;
    }
    
    .qchose-btn-qr:hover {
        background-color: #e5e7eb;
        border-color: #3b82f6;
        color: #3b82f6;
        transform: scale(1.05);
    }
    
    .qchose-btn-qr:active {
        transform: scale(0.95);
    }
    
    .qchose-btn-qr:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }

    .qchose-btn-dimensi {
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        background-color: #facc15;
        color: #111827;
        font-weight: 700;
        font-size: 13px;
        white-space: nowrap;
        cursor: pointer;
    }

    .qchose-time-stop {
        margin-top: 8px;
        font-size: 14px;
    }

    .qchose-time-stop-label {
        color: #ef4444;
        font-weight: 600;
        margin-right: 4px;
    }

    .qchose-time-stop-value {
        font-weight: 700;
        letter-spacing: 0.1em;
    }

    .qchose-section-title {
        font-size: 14px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .qchose-btn-primary,
    .qchose-btn-secondary {
        width: 100%;
        padding: 12px 16px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 15px;
        border: none;
        margin-top: 8px;
        cursor: pointer;
    }

    .qchose-btn-primary {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: white;
    }

    .qchose-btn-secondary {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }

    .qchose-status-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 12px;
    }

    .qchose-status-label {
        font-size: 15px;
        font-weight: 600;
        color: #16a34a;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .qchose-status-dot {
        width: 14px;
        height: 14px;
        border-radius: 999px;
        background-color: #22c55e;
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.35);
    }

    .qchose-status-time {
        font-family: "SF Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 16px;
        letter-spacing: 0.15em;
    }

    .text-danger {
        color: #dc2626;
        font-size: 12px;
        margin-top: 4px;
    }

    .alert {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 16px;
    }

    .alert-success {
        background: #dcfce7;
        color: #15803d;
        border: 1px solid #86efac;
    }

    .alert-danger {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fca5a5;
    }

    /* QR Scanner Modal */
    .qr-scanner-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }

    .qr-scanner-content {
        background: white;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        max-height: 85vh;
        overflow: hidden;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        animation: slideUp 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .qr-scanner-header {
        padding: 20px 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .qr-scanner-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .qr-scanner-header h3::before {
        content: 'ðŸ“·';
        font-size: 20px;
    }

    .qr-scanner-close {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 28px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        line-height: 1;
    }

    .qr-scanner-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }
    
    .qr-scanner-switch-camera {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        font-size: 20px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }
    
    .qr-scanner-switch-camera:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1) rotate(180deg);
    }

    .qr-scanner-body {
        padding: 20px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        min-height: 0;
    }

    #qr-video {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        aspect-ratio: 4 / 3;
        border-radius: 12px;
        background: #000;
        margin-bottom: 16px;
        position: relative;
        object-fit: cover;
        display: block;
    }
    
    #qr-scanner-container {
        position: relative;
        display: block;
        width: 100%;
        max-width: 100%;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        aspect-ratio: 4 / 3;
        margin: 0 auto;
    }
    
    #qr-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        border-radius: 12px;
    }
    
    /* Bounding box overlay untuk QR code */
    .qr-bounding-box {
        position: absolute;
        border: 3px solid #22c55e;
        border-radius: 8px;
        background: rgba(34, 197, 94, 0.1);
        pointer-events: none;
        z-index: 10;
        transition: all 0.1s ease;
        box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
        display: none;
    }
    
    .qr-bounding-box.active {
        display: block;
        animation: pulse-border 1s ease-in-out infinite;
    }
    
    @@keyframes pulse-border {
        0%, 100% {
            border-color: #22c55e;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
        }
        50% {
            border-color: #16a34a;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5);
        }
    }
    
    /* Scanning indicator */
    .qr-scanning-indicator {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        z-index: 11;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .qr-scanning-indicator.scanning {
        display: flex;
    }
    
    .qr-scanning-indicator.detected {
        background: rgba(34, 197, 94, 0.9);
    }
    
    .qr-scanning-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #22c55e;
        animation: blink 1s ease-in-out infinite;
    }
    
    @@keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }

    .qr-scanner-instructions {
        margin-top: 16px;
        padding: 14px 16px;
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border-radius: 12px;
        border: 1px solid #bae6fd;
        width: 100%;
        box-sizing: border-box;
    }

    .qr-scanner-instructions p {
        margin: 6px 0;
        font-size: 14px;
        color: #0c4a6e;
        font-weight: 500;
    }

    .qr-scanner-instructions i {
        color: #0284c7;
        margin-right: 8px;
        font-size: 16px;
    }
    
    /* Perbaikan untuk tablet */
    @@media (min-width: 768px) and (max-width: 1024px) {
        .qr-scanner-content {
            max-width: 550px;
        }
        
        #qr-scanner-container {
            max-width: 100%;
        }
        
        #qr-video {
            max-width: 100% !important;
            width: 100% !important;
        }
    }

    /* Styling khusus untuk elemen video/canvas dari QuaggaJS agar rapi */
    #quagga-scanner-container {
        position: relative;
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
        border-radius: 12px;
        overflow: hidden;
        aspect-ratio: 4 / 3;
    }
    
    #quagga-scanner-container canvas,
    #quagga-scanner-container video {
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        aspect-ratio: 4 / 3;
        object-fit: cover;
    }

    #quagga-scanner-container video {
        width: 100% !important;
        height: auto !important;
        display: block;
        object-fit: cover;
        border-radius: 12px;
        background: #000;
    }

    #quagga-scanner-container canvas {
        position: absolute !important;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        border-radius: 12px;
        pointer-events: none;
    }
</style>

<div class="qchose-page" id="qchosePageContainer">
    <div class="qchose-header" style="margin-bottom: 16px;">
        <div class="qchose-header-title">INPUT DATA QUALITY CONTROL</div>
        <div class="qchose-header-subtitle" id="qcHoseNow"></div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success" id="successAlert">
            <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
        </div>
    }

    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle"></i> @ViewBag.ErrorMessage
        </div>
    }

    <!-- Form ini akan menyimpan data LANGSUNG KE DATABASE (tabel QCHoseData) -->
    <form asp-action="Create" method="post" id="qchoseForm">
        @Html.AntiForgeryToken()

        <div class="qchose-section">
            <div class="qchose-label">Line Checking</div>
            <select asp-for="LineChecking" class="qchose-select" required>
                <option value="">- Pilih line -</option>
                @if (ViewBag.LineChecking != null)
                {
                    @foreach (var line in ViewBag.LineChecking)
                    {
                        <option value="@line">@line</option>
                    }
                }
                else
                {
                    <option value="Line 1">Line 1</option>
                    <option value="Line 2">Line 2</option>
                    <option value="Line 3">Line 3</option>
                    <option value="Line 4">Line 4</option>
                }
            </select>
            <span asp-validation-for="LineChecking" class="text-danger"></span>

            <div class="qchose-label" style="margin-top: 12px;">Nama Inspector</div>
            <input type="text" 
                   asp-for="NamaInspector" 
                   class="qchose-input" 
                   value="@ViewBag.NamaInspectorLogin" 
                   readonly 
                   style="background: rgba(30, 41, 59, 0.4) !important; backdrop-filter: blur(10px); cursor: not-allowed; color: #64748b !important; border-color: rgba(148, 163, 184, 0.1) !important; opacity: 0.6;" 
                   required />
            <span asp-validation-for="NamaInspector" class="text-danger"></span>

            <div class="qchose-label" style="margin-top: 12px;">Group Checking</div>
            <div class="qchose-radio-group">
                @if (ViewBag.GroupChecking != null)
                {
                    @foreach (var group in ViewBag.GroupChecking)
                    {
                        <label class="qchose-radio-item">
                            @if (group == "A" || (ViewBag.GroupChecking != null && ((List<string>)ViewBag.GroupChecking).IndexOf(group) == 0))
                            {
                                <input type="radio" asp-for="GroupChecking" value="@group" checked />
                            }
                            else
                            {
                                <input type="radio" asp-for="GroupChecking" value="@group" />
                            }
                            <span>@group</span>
                        </label>
                    }
                }
                else
                {
                    <label class="qchose-radio-item">
                        <input type="radio" asp-for="GroupChecking" value="A" checked />
                        <span>A</span>
                    </label>
                    <label class="qchose-radio-item">
                        <input type="radio" asp-for="GroupChecking" value="B" />
                        <span>B</span>
                    </label>
                }
            </div>

            <div class="qchose-label" style="margin-top: 12px;">Part Code</div>
            <div class="qchose-inline-row">
                <div style="position: relative; flex: 1; z-index: 10;">
                    <input asp-for="PartCode" class="qchose-input qchose-partcode-input" placeholder="Masukan part code" id="partCodeInputField" autocomplete="off" required />
                    <div id="lineStopMessage" class="line-stop-message" style="display: none;">
                        <i class="bi bi-exclamation-triangle"></i> Sedang Line Stop
                    </div>
                    <div id="partCodeSuggestions" class="part-code-suggestions" style="display: none;"></div>
                </div>
                <datalist id="partCodeList">
                    @if (ViewBag.PartCodes != null)
                    {
                        @foreach (var partCode in ViewBag.PartCodes)
                        {
                            <option value="@partCode">@partCode</option>
                        }
                    }
                </datalist>
                <button type="button" class="qchose-btn-qr" title="Scan QR" id="btnScanQR">
                    <i class="bi bi-qr-code-scan"></i>
                </button>
                <a href="@Url.Action("Input", "Dimensi")" class="qchose-btn-dimensi" id="btnDimensi" target="_blank">
                    Dimensi
                </a>
            </div>
            <span asp-validation-for="PartCode" class="text-danger"></span>

            <div class="qchose-time-stop">
                <span class="qchose-time-stop-label" id="timeStopLabel">Time Stop :</span>
                <span class="qchose-time-stop-value" id="qcHoseTimeStop">0:0:0</span>
                <p style="margin-top: 8px; font-size: 11px; color: #6b7280; font-style: italic;">
                    Timer otomatis mulai saat Part Code diklik atau diisi
                </p>
            </div>
            <input type="hidden" asp-for="TimeStop" id="timeStopValue" value="0:0:0" />
        </div>

        <div class="qchose-section">
            <div class="qchose-section-title">Qty NG</div>
            <select asp-for="JenisNG" class="qchose-select">
                <option value="">- Pilih Jenis NG -</option>
                @if (ViewBag.JenisNG != null)
                {
                    @foreach (var jenis in ViewBag.JenisNG)
                    {
                        <option value="@jenis">@jenis</option>
                    }
                }
                else
                {
                    <option value="Dimensi">Dimensi</option>
                    <option value="Visual">Visual</option>
                    <option value="Fungsi">Fungsi</option>
                    <option value="Lainnya">Lainnya</option>
                }
            </select>

            <div class="qchose-inline-row" style="margin-top: 8px;">
                <input asp-for="NamaOPR" class="qchose-input" placeholder="Nama OPR" />
                <input asp-for="QtyNG" type="number" class="qchose-input" style="max-width: 140px;" placeholder="Qty (pcs)" min="0" />
            </div>

            <button type="button" class="qchose-btn-primary" id="btnUpdateNG">
                UPDATE NG
            </button>
            <div id="ngUpdateMessage" style="margin-top: 8px; padding: 8px; border-radius: 6px; display: none; font-size: 12px;"></div>
        </div>

        <div class="qchose-section">
            <div class="qchose-section-title">Qty Check</div>
            <input asp-for="QtyCheck" type="number" class="qchose-input" placeholder="Qty (pcs)" min="0" required />
            <span asp-validation-for="QtyCheck" class="text-danger"></span>

            <button type="submit" class="qchose-btn-secondary" id="btnSelesaiCheck">
                SELESAI CHECK
            </button>
        </div>

        <div class="qchose-section">
            <div class="qchose-section-title">Line Stop</div>
            <select asp-for="LineStop" class="qchose-select" id="lineStopSelect" style="margin-bottom: 16px;">
                <option value="">- Pilih Line Stop -</option>
                @if (ViewBag.LineStop != null)
                {
                    @foreach (var line in ViewBag.LineStop)
                    {
                        <option value="@line">@line</option>
                    }
                }
                else
                {
                    <option value="Line 1">Line 1</option>
                    <option value="Line 2">Line 2</option>
                    <option value="Line 3">Line 3</option>
                    <option value="Line 4">Line 4</option>
                }
            </select>

            <div class="line-stop-timer-container" id="lineStopTimerRow" style="display: none;">
                <div class="line-stop-timer-header">
                    <div class="line-stop-checking-group">
                        <span class="line-stop-checking-label">Checking</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="lineStopToggle" onchange="toggleLineStopTimer()" tabindex="0" aria-label="Toggle Line Stop Timer">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="line-stop-timer-display" id="qcHoseLineStopTime">0:0:0:0</div>
                </div>
            </div>
            <input type="hidden" asp-for="StatusChecking" value="Checking" />
            <input type="hidden" asp-for="StatusCheckingTime" id="lineStopDurationValue" value="0:0:0:0" />
            <!-- StatusCheckingTime digunakan untuk menyimpan durasi Line Stop -->
        </div>
    </form>

    <!-- Modal Warning Line Stop -->
    <div id="lineStopWarningModal" class="line-stop-warning-modal" style="display: none;">
        <div class="line-stop-warning-content">
            <div class="line-stop-warning-header">
                <i class="bi bi-exclamation-triangle-fill" style="color: #f59e0b; font-size: 32px;"></i>
                <h3>Peringatan</h3>
            </div>
            <div class="line-stop-warning-body">
                <p><strong>Update QTY Check terlebih dahulu</strong></p>
                <p>Waktu Pengecekan sedang berjalan</p>
            </div>
            <div class="line-stop-warning-footer">
                <button type="button" class="line-stop-warning-btn" id="closeLineStopWarning" onclick="document.getElementById('lineStopWarningModal').style.display='none';">
                    Mengerti
                </button>
            </div>
        </div>
    </div>

    <!-- Tombol Navigasi -->
    <div class="nav-buttons-container">
        <a href="@Url.Action("Index", "Home")" class="nav-btn nav-btn-home">
            <i class="bi bi-house-door-fill"></i>
            <span>HOME</span>
        </a>
        <button type="button" id="btnSCW" class="nav-btn nav-btn-scw">
            <i class="bi bi-bell-fill"></i>
            <span>SCW</span>
        </button>
    </div>

</div>

<!-- FAB Speed Dial Container -->
<div class="fab-speed-dial" id="fabSpeedDial">
    <!-- Main FAB Button -->
    <button type="button" id="btnLihatData" class="fab-main-button">
        <i class="bi bi-house-door-fill fab-main-icon"></i>
    </button>
    
    <!-- Speed Dial Items -->
    <div class="fab-dial-items" id="fabDialItems">
        <!-- Planning QC -->
        <div class="fab-dial-item" data-action="planning-qc">
            <span class="fab-dial-label">Planning QC</span>
            <button type="button" class="fab-dial-button" style="background: #3b82f6;">
                <i class="bi bi-file-text"></i>
            </button>
        </div>
        
        <!-- Output Check -->
        <div class="fab-dial-item" data-action="output-check">
            <span class="fab-dial-label">Output Check</span>
            <button type="button" class="fab-dial-button" style="background: #22c55e;">
                <i class="bi bi-check-square"></i>
            </button>
        </div>
        
        <!-- Detail NG -->
        <div class="fab-dial-item" data-action="detail-ng">
            <span class="fab-dial-label">Detail NG</span>
            <button type="button" class="fab-dial-button" style="background: #ef4444;">
                <i class="bi bi-x-square"></i>
            </button>
        </div>
    </div>
    
    <!-- Backdrop overlay -->
    <div class="fab-backdrop" id="fabBackdrop"></div>
</div>

<!-- Andon System Modal -->
<div id="andonModal" class="andon-modal-overlay" style="display: none;">
    <div class="andon-modal-content">
        <div class="andon-modal-title">ANDON SYSTEM</div>
        <div class="andon-modal-body">
            <label class="andon-label">List Abnormality :</label>
            <select id="listAbnormality" class="andon-select">
                <option value="">- Pilih Abnormality -</option>
                @if (ViewBag.ListAbnormality != null)
                {
                    @foreach (var abnormality in ViewBag.ListAbnormality)
                    {
                        <option value="@abnormality">@abnormality</option>
                    }
                }
            </select>
            <div class="andon-buttons">
                <button type="button" class="andon-btn-leader" onclick="panggilLeader()">
                    Panggil Leader
                </button>
                <button type="button" class="andon-btn-wa" onclick="panggilWhatsApp()">
                    <i class="bi bi-whatsapp" style="font-size: 24px;"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Data Table Modal -->
<div id="dataTableModal" class="data-modal-overlay" style="display: none;">
    <div class="data-modal-content">
        <div class="data-modal-header">
            <h2 class="data-modal-title">
                <i class="bi bi-table"></i> Tabel Data E_LWP
            </h2>
            <button type="button" class="data-modal-close" id="btnCloseDataModal">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="data-modal-body" id="dataModalBody">
            <div class="data-loading">
                <i class="bi bi-arrow-repeat" style="animation: spin 1s linear infinite;"></i>
                <span>Memuat data...</span>
            </div>
        </div>
    </div>
</div>

<!-- Detail NG Modal -->
<div id="detailNGModal" class="data-modal-overlay" style="display: none;">
    <div class="data-modal-content">
        <div class="data-modal-header">
            <h2 class="data-modal-title">
                <i class="bi bi-x-square"></i> Detail NG
            </h2>
            <button type="button" class="data-modal-close" id="btnCloseNGModal">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="data-modal-date-picker" style="padding: 16px 24px; border-bottom: 1px solid rgba(148, 163, 184, 0.2); background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px);">
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class="bi bi-calendar3" style="color: #ef4444; font-size: 20px; filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.5));"></i>
                <label for="ngDatePicker" style="font-weight: 600; color: #f1f5f9; font-size: 14px;">Pilih Tanggal:</label>
                <input 
                    type="date" 
                    id="ngDatePicker" 
                    class="form-control" 
                    style="max-width: 200px; padding: 8px 12px; border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; font-size: 14px; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); color: #f1f5f9; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);"
                />
                <span id="selectedNGDateInfo" style="color: #94a3b8; font-size: 13px; font-style: italic;"></span>
                <button type="button" id="btnClearNGDate" style="padding: 8px 16px; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 6px; font-size: 13px; cursor: pointer; display: none; color: #f1f5f9; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'; this.style.borderColor='rgba(239, 68, 68, 0.4)';" onmouseout="this.style.background='rgba(30, 41, 59, 0.6)'; this.style.borderColor='rgba(148, 163, 184, 0.2)';">
                    <i class="bi bi-x-circle"></i> Clear
                </button>
            </div>
        </div>
        <div class="data-modal-body" id="ngModalBody">
            <div class="data-loading" id="ngLoading">
                <i class="bi bi-arrow-repeat" style="animation: spin 1s linear infinite;"></i>
                <span>Memuat data...</span>
            </div>
            <div class="ng-table-wrapper" style="overflow-x: auto; overflow-y: visible;">
                <table id="ngTable" class="data-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Line</th>
                            <th>Part Code</th>
                            <th>Jenis NG</th>
                            <th>Nama OPR</th>
                            <th>QTY NG</th>
                        </tr>
                    </thead>
                    <tbody id="ngTableBody"></tbody>
                </table>
            </div>
            <div id="ngNoData" style="display: none; text-align: center; padding: 40px; color: #94a3b8;">
                <i class="bi bi-inbox" style="font-size: 48px; display: block; margin-bottom: 16px; opacity: 0.5; color: #64748b; filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.2));"></i>
                <p style="color: #f1f5f9; font-weight: 600;">Tidak ada data NG</p>
            </div>
        </div>
    </div>
</div>

<!-- Output Check Modal -->
<div id="outputCheckModal" class="data-modal-overlay" style="display: none;">
    <div class="data-modal-content">
        <div class="data-modal-header">
            <h2 class="data-modal-title">
                <i class="bi bi-check-square"></i> Output Check
            </h2>
            <button type="button" class="data-modal-close" id="btnCloseOutputModal">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="data-modal-date-picker" style="padding: 20px 28px; border-bottom: 1px solid rgba(148, 163, 184, 0.2); background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px);">
            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 12px; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); padding: 12px 16px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); border: 1px solid rgba(59, 130, 246, 0.3);">
                    <i class="bi bi-calendar3" style="color: #3b82f6; font-size: 22px; filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.5));"></i>
                    <label for="outputDatePicker" style="font-weight: 600; color: #f1f5f9; font-size: 15px; margin: 0;">Pilih Tanggal:</label>
                </div>
                <input 
                    type="date" 
                    id="outputDatePicker" 
                    class="form-control" 
                    style="max-width: 220px; padding: 12px 16px; border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 12px; font-size: 14px; font-weight: 500; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); color: #f1f5f9; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);"
                />
                <span id="selectedDateInfo" style="color: #94a3b8; font-size: 14px; font-style: italic; padding: 8px 12px; background: rgba(59, 130, 246, 0.15); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);"></span>
            </div>
        </div>
        
        <!-- Statistics Cards -->
        <div class="output-check-stats" id="outputCheckStats" style="display: none; padding: 16px 20px; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(148, 163, 184, 0.2);">
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div class="output-stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%); color: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4), 0 0 20px rgba(59, 130, 246, 0.2); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div style="position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%); pointer-events: none;"></div>
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 6px; opacity: 0.95; text-transform: uppercase; letter-spacing: 0.5px; position: relative; z-index: 1; text-align: center;">TOTAL QTY CHECK</div>
                    <div id="statTotalQtyCheck" style="font-size: 28px; font-weight: 800; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); position: relative; z-index: 1; animation: countUp 0.6s ease-out; text-align: center; margin-bottom: 8px; line-height: 1.2;">0</div>
                    <div style="width: 100%; height: 5px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; overflow: hidden; position: relative; z-index: 1;">
                        <div id="progressQtyCheck" style="height: 100%; background: linear-gradient(90deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)); border-radius: 10px; transition: width 0.6s ease-out; width: 0%; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);"></div>
                    </div>
                </div>
                <div class="output-stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%); color: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4), 0 0 20px rgba(239, 68, 68, 0.2); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div style="position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%); pointer-events: none;"></div>
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 6px; opacity: 0.95; text-transform: uppercase; letter-spacing: 0.5px; position: relative; z-index: 1; text-align: center;">TOTAL NG</div>
                    <div id="statTotalNG" style="font-size: 28px; font-weight: 800; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); position: relative; z-index: 1; animation: countUp 0.6s ease-out; text-align: center; margin-bottom: 8px; line-height: 1.2;">0</div>
                    <div style="width: 100%; height: 5px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; overflow: hidden; position: relative; z-index: 1;">
                        <div id="progressNG" style="height: 100%; background: linear-gradient(90deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)); border-radius: 10px; transition: width 0.6s ease-out; width: 0%; box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);"></div>
                    </div>
                </div>
                <div class="output-stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%); color: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4), 0 0 20px rgba(139, 92, 246, 0.2); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div style="position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%); pointer-events: none;"></div>
                    <div style="font-size: 11px; font-weight: 600; margin-bottom: 6px; opacity: 0.95; text-transform: uppercase; letter-spacing: 0.5px; position: relative; z-index: 1; text-align: center;">TOTAL RR %</div>
                    <div id="statTotalRR" style="font-size: 28px; font-weight: 800; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); position: relative; z-index: 1; animation: countUp 0.6s ease-out; text-align: center; line-height: 1.2;">0%</div>
                </div>
            </div>
        </div>
        
        <style>
            @@keyframes countUp {
                from {
                    opacity: 0;
                    transform: translateY(10px) scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
            
            .output-stat-card:hover {
                transform: translateY(-4px) scale(1.02);
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2), 0 0 30px rgba(59, 130, 246, 0.3) !important;
            }
            
            #outputDatePicker:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(59, 130, 246, 0.2);
            }
        </style>
        
        <div class="data-modal-body" id="outputModalBody">
            <div class="data-loading" id="outputLoading">
                <i class="bi bi-arrow-repeat" style="animation: spin 1s linear infinite;"></i>
                <span>Memuat data...</span>
            </div>
            <div class="output-table-wrapper" style="overflow-x: auto; overflow-y: visible;">
                <table id="outputTable" class="data-table output-check-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Line</th>
                            <th>Group</th>
                            <th>Inspector</th>
                            <th>Part Code</th>
                            <th>QTY Check</th>
                            <th>Line Stop</th>
                        </tr>
                    </thead>
                    <tbody id="outputTableBody"></tbody>
                </table>
            </div>
            <div id="outputNoData" style="display: none; text-align: center; padding: 40px; color: #94a3b8;">
                <i class="bi bi-inbox" style="font-size: 48px; display: block; margin-bottom: 16px; opacity: 0.5; color: #64748b; filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.2));"></i>
                <p style="color: #f1f5f9; font-weight: 600;">Tidak ada data untuk filter yang dipilih</p>
            </div>
        </div>
    </div>
</div>


<style>
    /* FAB Speed Dial Styles */
    .fab-speed-dial {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 9999;
    }
    
    /* Main FAB Button */
    .fab-main-button {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: #8b5cf6;
        border: none;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        z-index: 10;
    }
    
    .fab-main-button:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
    }
    
    .fab-main-button:active {
        transform: scale(0.92);
        transition: all 0.1s ease;
    }
    
    .fab-main-icon {
        font-size: 24px;
        color: white;
        transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* Rotate icon when active */
    .fab-speed-dial.active .fab-main-icon {
        transform: rotate(180deg);
    }
    
    /* Speed Dial Items Container */
    .fab-dial-items {
        position: absolute;
        bottom: 70px;
        right: 0;
        display: flex;
        flex-direction: column;
        gap: 12px;
        pointer-events: none;
    }
    
    .fab-speed-dial.active .fab-dial-items {
        pointer-events: auto;
    }
    
    
    /* Individual Dial Item */
    .fab-dial-item {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 12px;
        opacity: 0;
        transform: translateY(30px) scale(0.7);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* Show items when active with staggered animation */
    .fab-speed-dial.active .fab-dial-item:nth-child(1) {
        opacity: 1;
        transform: translateY(0) scale(1);
        transition-delay: 0.08s;
    }
    
    .fab-speed-dial.active .fab-dial-item:nth-child(2) {
        opacity: 1;
        transform: translateY(0) scale(1);
        transition-delay: 0.14s;
    }
    
    .fab-speed-dial.active .fab-dial-item:nth-child(3) {
        opacity: 1;
        transform: translateY(0) scale(1);
        transition-delay: 0.20s;
    }
    
    /* Dial Button */
    .fab-dial-button {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    
    .fab-dial-button:hover {
        transform: scale(1.15);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
    }
    
    .fab-dial-button:active {
        transform: scale(0.95);
    }
    
    .fab-dial-button i {
        font-size: 20px;
        color: white;
    }
    
    /* Dial Label */
    .fab-dial-label {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        opacity: 0;
        transform: translateX(10px);
        transition: all 0.2s ease;
        pointer-events: none;
    }
    
    .fab-dial-item:hover .fab-dial-label {
        opacity: 1;
        transform: translateX(0);
    }
    
    /* Backdrop */
    .fab-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: -1;
    }
    
    .fab-speed-dial.active .fab-backdrop {
        opacity: 1;
        visibility: visible;
    }
    
    /* Responsive adjustments */
    @@media (max-width: 768px) {
        .fab-speed-dial {
            bottom: 20px;
            right: 20px;
        }
        
        .fab-dial-label {
            font-size: 12px;
            padding: 6px 12px;
        }
    }
</style>

<style>
    /* Andon System Modal Styles */
    .andon-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .andon-modal-content {
        background: white;
        border-radius: 12px;
        padding: 24px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .andon-modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #000;
        text-align: center;
        margin-bottom: 20px;
        text-transform: uppercase;
    }

    .andon-modal-body {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .andon-label {
        font-size: 14px;
        font-weight: 600;
        color: #000;
        margin-bottom: 4px;
    }

    .andon-select {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%233b82f6' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 40px;
    }

    .andon-buttons {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .andon-btn-leader {
        flex: 1;
        padding: 14px;
        background: #4b5563;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        text-align: center;
    }

    .andon-btn-leader:hover {
        background: #374151;
    }

    .andon-btn-wa {
        width: 50px;
        height: 50px;
        background: #25d366;
        color: white;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
    }

    .andon-btn-wa:hover {
        background: #20ba5a;
        transform: scale(1.05);
    }

    /* Filter Buttons Styles */
    .data-modal-filters {
        display: flex;
        gap: 8px;
        padding: 16px 24px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
    }

    .filter-btn {
        flex: 1;
        padding: 10px 20px;
        border: 1px solid #d1d5db;
        background: white;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        color: #374151;
    }

    .filter-btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
    }

    .filter-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
    }

    /* Data Table Modal Styles */
    .data-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(30, 41, 59, 0.9));
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    }

    .data-modal-content {
        background: rgba(30, 41, 59, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 24px;
        width: 100%;
        max-width: 1200px;
        max-height: 90vh;
        box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.6),
            0 0 40px rgba(59, 130, 246, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    
    @@keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    @@keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .data-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px 28px;
        border-bottom: none;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
        color: white;
        box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        position: relative;
        overflow: hidden;
    }
    
    .data-modal-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
        pointer-events: none;
    }

    .data-modal-title {
        font-size: 22px;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1;
    }
    
    .data-modal-title i {
        font-size: 24px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    .data-modal-close {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 20px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        z-index: 1;
        backdrop-filter: blur(10px);
    }

    .data-modal-close:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .data-modal-body {
        padding: 28px;
        overflow-y: auto;
        overflow-x: hidden;
        flex: 1;
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(10px);
        max-height: calc(100vh - 200px);
    }

    /* Firefox scrollbar styling for modal body */
    .data-modal-body {
        scrollbar-width: thin;
        scrollbar-color: rgba(59, 130, 246, 0.8) rgba(15, 23, 42, 0.5);
    }
    
    /* Custom Scrollbar for Modal */
    .data-modal-body::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    .data-modal-body::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 10px;
    }
    
    .data-modal-body::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }
    
    .data-modal-body::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #2563eb, #4f46e5);
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
    }

    /* Output Table Wrapper for Horizontal Scroll */
    .output-table-wrapper {
        overflow-x: auto;
        overflow-y: visible;
        margin: 0;
        border-radius: 0;
        max-width: 100%;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }

    /* Custom Scrollbar for Output Table Wrapper - Horizontal & Vertical */
    .output-table-wrapper::-webkit-scrollbar {
        width: 12px;
        height: 12px;
    }
    
    .output-table-wrapper::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 10px;
        margin: 4px;
    }
    
    .output-table-wrapper::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        border: 2px solid rgba(15, 23, 42, 0.3);
    }
    
    .output-table-wrapper::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #2563eb, #4f46e5);
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
    }

    /* Corner styling when both scrollbars are visible */
    .output-table-wrapper::-webkit-scrollbar-corner {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 10px;
    }

    /* Firefox scrollbar styling */
    .output-table-wrapper {
        scrollbar-width: thin;
        scrollbar-color: rgba(59, 130, 246, 0.8) rgba(15, 23, 42, 0.6);
    }

    /* Detail NG Table Wrapper for Horizontal Scroll */
    .ng-table-wrapper {
        overflow-x: auto;
        overflow-y: visible;
        margin: 0;
        border-radius: 0;
        max-width: 100%;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }

    /* Custom Scrollbar for Detail NG Table Wrapper - Horizontal & Vertical */
    .ng-table-wrapper::-webkit-scrollbar {
        width: 12px;
        height: 12px;
    }
    
    .ng-table-wrapper::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 10px;
        margin: 4px;
    }
    
    .ng-table-wrapper::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ef4444, #dc2626); /* Red gradient for NG table */
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
        border: 2px solid rgba(15, 23, 42, 0.3);
    }
    
    .ng-table-wrapper::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
    }

    /* Corner styling when both scrollbars are visible */
    .ng-table-wrapper::-webkit-scrollbar-corner {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 10px;
    }

    /* Firefox scrollbar styling for Detail NG */
    .ng-table-wrapper {
        scrollbar-width: thin;
        scrollbar-color: rgba(239, 68, 68, 0.8) rgba(15, 23, 42, 0.6);
    }

    .data-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
        gap: 16px;
        color: #94a3b8;
        font-size: 14px;
    }

    .data-table-wrapper {
        overflow-x: auto;
        margin: 16px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .data-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 14px;
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 
            0 8px 24px rgba(0, 0, 0, 0.4),
            0 0 20px rgba(59, 130, 246, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .data-table thead {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 50%, #4338ca 100%);
        position: sticky;
        top: 0;
        z-index: 10;
        position: relative;
        overflow: hidden;
    }
    
    .data-table thead::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
        pointer-events: none;
    }

    .data-table th {
        padding: 16px 20px;
        text-align: left;
        font-weight: 700;
        color: white;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        border: none;
        white-space: nowrap;
        position: relative;
        z-index: 1;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    /* Center align headers for centered columns */
    .output-check-table th:nth-child(2),  /* Line */
    .output-check-table th:nth-child(3),  /* Group */
    .output-check-table th:nth-child(6),  /* QTY Check */
    .output-check-table th:nth-child(7) { /* Line Stop */
        text-align: center;
    }

    /* Center align body cells to match headers */
    .output-check-table td:nth-child(2),  /* Line */
    .output-check-table td:nth-child(3),  /* Group */
    .output-check-table td:nth-child(6),  /* QTY Check */
    .output-check-table td:nth-child(7) { /* Line Stop */
        text-align: center;
    }

    #ngTable th:nth-child(2),            /* Line in Detail NG */
    #ngTable th:nth-child(6) {           /* QTY NG in Detail NG */
        text-align: center;
    }

    #ngTable td:nth-child(2),            /* Line body cells in Detail NG */
    #ngTable td:nth-child(6) {           /* QTY NG body cells in Detail NG */
        text-align: center;
    }

    .data-table td {
        padding: 14px 20px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        transition: all 0.2s ease;
        color: #f1f5f9;
        font-size: 13px;
    }

    .data-table tbody tr {
        transition: all 0.2s ease;
    }

    .data-table tbody tr:last-child td {
        border-bottom: none;
    }

    .data-table tbody tr:hover {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.15));
        transform: translateX(2px);
        box-shadow: 
            inset 4px 0 0 #3b82f6,
            0 2px 8px rgba(0, 0, 0, 0.3),
            0 0 15px rgba(59, 130, 246, 0.2);
    }

    /* Output Check Table Enhancements */
    .output-check-table tbody tr:nth-child(even) {
        background: rgba(30, 41, 59, 0.4);
    }

    .output-check-table tbody tr:nth-child(odd) {
        background: rgba(15, 23, 42, 0.3);
    }

    .output-check-table tbody tr:hover {
        background: linear-gradient(90deg, rgba(59, 130, 246, 0.25) 0%, rgba(99, 102, 241, 0.2) 100%) !important;
        transform: translateX(4px);
        box-shadow: 
            inset 4px 0 0 #3b82f6,
            0 2px 8px rgba(0, 0, 0, 0.3),
            0 0 15px rgba(59, 130, 246, 0.3);
    }

    /* Column Width Constraints for Output Check Table */
    .output-check-table {
        table-layout: auto !important; /* Changed from fixed to auto to allow natural column widths */
        width: max-content !important; /* Allow table to expand based on content */
        min-width: 100% !important; /* Ensure table takes at least full width of container */
    }

    .output-check-table th,
    .output-check-table td {
        white-space: nowrap !important;
        overflow: visible !important; /* Changed from hidden to visible to show full text */
        text-overflow: clip !important; /* Changed from ellipsis to clip to show full text */
        vertical-align: middle !important;
    }

    .output-check-table th:nth-child(1),
    .output-check-table td:nth-child(1) { 
        width: 200px !important; 
        min-width: 200px !important;
    } /* Tanggal - increased for full date+time display */
    
    .output-check-table th:nth-child(2),
    .output-check-table td:nth-child(2) { 
        width: 90px !important; 
        min-width: 90px !important;
    } /* Line */
    
    .output-check-table th:nth-child(3),
    .output-check-table td:nth-child(3) { 
        width: 80px !important; 
        min-width: 80px !important;
    } /* Group */
    
    .output-check-table th:nth-child(4),
    .output-check-table td:nth-child(4) { 
        width: 180px !important; 
        min-width: 180px !important;
    } /* Inspector - increased for full name visibility */
    
    .output-check-table th:nth-child(5),
    .output-check-table td:nth-child(5) { 
        width: 160px !important; 
        min-width: 160px !important;
    } /* Part Code - increased for full code visibility */
    
    .output-check-table th:nth-child(6),
    .output-check-table td:nth-child(6) { 
        width: 100px !important; 
        min-width: 100px !important;
    } /* QTY Check */
    
    .output-check-table th:nth-child(7),
    .output-check-table td:nth-child(7) { 
        width: 150px !important; 
        min-width: 150px !important;
    } /* Line Stop - increased for full visibility */

    /* Tablet - Allow table to scroll horizontally and show all columns */
    @@media (min-width: 768px) and (max-width: 1024px) {
        /* Make modal body scrollable vertically only - horizontal scroll handled by wrapper */
        #outputModalBody {
            overflow-x: hidden !important;
            overflow-y: auto !important;
            padding: 0 !important;
        }

        /* Output table wrapper handles horizontal scroll */
        .output-table-wrapper {
            overflow-x: auto !important;
            overflow-y: visible !important;
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Ensure table has enough width to show all columns properly */
        .output-check-table {
            table-layout: auto !important;
            min-width: 1000px !important; /* Increased to 1000px to ensure all columns including LINE STOP are fully visible */
            width: max-content !important;
            display: table !important;
        }

        /* Remove text truncation for tablet - show full content */
        .output-check-table th,
        .output-check-table td {
            white-space: nowrap !important; /* Use nowrap to prevent text wrapping */
            overflow: visible !important;
            text-overflow: clip !important;
            word-wrap: normal !important;
            padding: 12px 16px !important; /* Adequate padding for readability */
        }

        /* Set appropriate minimum widths for columns on tablet to ensure full visibility */
        .output-check-table th:nth-child(1),
        .output-check-table td:nth-child(1) { 
            min-width: 200px !important; /* Tanggal - increased for full date+time display */
            width: 200px !important;
        }
        
        .output-check-table th:nth-child(2),
        .output-check-table td:nth-child(2) { 
            min-width: 90px !important; /* Line - increased slightly */
            width: 90px !important;
        }
        
        .output-check-table th:nth-child(3),
        .output-check-table td:nth-child(3) { 
            min-width: 80px !important; /* Group - increased slightly */
            width: 80px !important;
        }
        
        .output-check-table th:nth-child(4),
        .output-check-table td:nth-child(4) { 
            min-width: 160px !important; /* Inspector - increased for full name visibility */
            width: 160px !important;
        }
        
        .output-check-table th:nth-child(5),
        .output-check-table td:nth-child(5) { 
            min-width: 140px !important; /* Part Code - increased for full code visibility */
            width: 140px !important;
        }
        
        .output-check-table th:nth-child(6),
        .output-check-table td:nth-child(6) { 
            min-width: 100px !important; /* QTY Check - increased */
            width: 100px !important;
        }
        
        .output-check-table th:nth-child(7),
        .output-check-table td:nth-child(7) { 
            min-width: 140px !important; /* Line Stop - increased significantly for full visibility */
            width: 140px !important;
        }
        
        /* Ensure table header is sticky and visible when scrolling */
        .output-check-table thead {
            position: sticky !important;
            top: 0 !important;
            z-index: 100 !important;
        }
    }

    .date-cell {
        font-weight: 500;
        color: #94a3b8;
        font-size: 12px;
    }

    .line-cell {
        font-weight: 600;
        color: #60a5fa;
        filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5));
    }

    .group-cell {
        font-weight: 600;
        color: #a78bfa;
        filter: drop-shadow(0 0 5px rgba(139, 92, 246, 0.5));
    }

    .part-code-cell {
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: #34d399;
        background: rgba(16, 185, 129, 0.15);
        backdrop-filter: blur(10px);
        padding: 6px 10px !important;
        border-radius: 4px;
        font-size: 12px;
        border: 1px solid rgba(16, 185, 129, 0.3);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
    }

    .qty-cell {
        font-weight: 700;
        color: #22d3ee;
        text-align: center;
        font-size: 15px;
        filter: drop-shadow(0 0 5px rgba(8, 145, 178, 0.5));
    }

    .linestop-cell {
        font-weight: 600;
        color: #fca5a5;
        text-align: center;
        filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5));
    }

    .status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 16px;
        font-size: 11px;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .status-checking {
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        color: white;
    }

    .status-done {
        background: linear-gradient(135deg, #34d399, #10b981);
        color: white;
    }

    .status-stop {
        background: linear-gradient(135deg, #f87171, #ef4444);
        color: white;
    }

    /* Detail NG Modal Body - Scrollable */
    #ngModalBody {
        overflow-x: hidden !important;
        overflow-y: auto !important;
        max-height: calc(100vh - 300px);
    }

    /* Detail NG Table Enhancements */
    #ngTable {
        table-layout: auto !important;
        width: max-content !important;
        min-width: 100% !important;
    }

    #ngTable th,
    #ngTable td {
        white-space: nowrap !important;
        overflow: visible !important;
        text-overflow: clip !important;
        vertical-align: middle !important;
    }

    /* Set column widths for Detail NG table */
    #ngTable th:nth-child(1),
    #ngTable td:nth-child(1) { 
        width: 200px !important; 
        min-width: 200px !important;
    } /* Tanggal */
    
    #ngTable th:nth-child(2),
    #ngTable td:nth-child(2) { 
        width: 90px !important; 
        min-width: 90px !important;
    } /* Line */
    
    #ngTable th:nth-child(3),
    #ngTable td:nth-child(3) { 
        width: 160px !important; 
        min-width: 160px !important;
    } /* Part Code */
    
    #ngTable th:nth-child(4),
    #ngTable td:nth-child(4) { 
        width: 150px !important; 
        min-width: 150px !important;
    } /* Jenis NG */
    
    #ngTable th:nth-child(5),
    #ngTable td:nth-child(5) { 
        width: 180px !important; 
        min-width: 180px !important;
    } /* Nama OPR */
    
    #ngTable th:nth-child(6),
    #ngTable td:nth-child(6) { 
        width: 100px !important; 
        min-width: 100px !important;
    } /* QTY NG */

    #ngTable tbody tr:nth-child(even) {
        background: rgba(239, 68, 68, 0.05);
    }

    #ngTable tbody tr:nth-child(odd) {
        background: rgba(15, 23, 42, 0.3);
    }

    #ngTable tbody tr:hover {
        background: linear-gradient(90deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.15) 100%) !important;
        transform: translateX(4px);
        box-shadow: 
            inset 4px 0 0 #ef4444,
            0 2px 8px rgba(0, 0, 0, 0.3),
            0 0 15px rgba(239, 68, 68, 0.3);
    }

    #ngTable td:nth-child(3) {
        font-weight: 700;
        color: #fca5a5;
        text-align: center;
        font-size: 15px;
        filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5));
    }

    /* Tablet - Detail NG Table Responsive */
    @@media (min-width: 768px) and (max-width: 1024px) {
        #ngModalBody {
            overflow-x: hidden !important;
            overflow-y: auto !important;
            padding: 0 !important;
        }

        .ng-table-wrapper {
            overflow-x: auto !important;
            overflow-y: visible !important;
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #ngTable {
            table-layout: auto !important;
            min-width: 900px !important; /* Ensure all columns are visible */
            width: max-content !important;
            display: table !important;
        }

        #ngTable th,
        #ngTable td {
            white-space: nowrap !important;
            overflow: visible !important;
            text-overflow: clip !important;
            word-wrap: normal !important;
            padding: 12px 16px !important;
        }

        /* Ensure table header is sticky and visible when scrolling */
        #ngTable thead {
            position: sticky !important;
            top: 0 !important;
            z-index: 100 !important;
        }
    }

    /* Table Column Widths for Better Layout */
    .output-check-table th:nth-child(1),  /* Tanggal */
    .output-check-table td:nth-child(1) {
        width: 130px;
        min-width: 130px;
    }

    .output-check-table th:nth-child(2),  /* Line */
    .output-check-table td:nth-child(2) {
        width: 80px;
        min-width: 80px;
    }

    .output-check-table th:nth-child(3),  /* Group */
    .output-check-table td:nth-child(3) {
        width: 70px;
        min-width: 70px;
    }

    .output-check-table th:nth-child(4),  /* Inspector */
    .output-check-table td:nth-child(4) {
        width: auto;
        min-width: 150px;
    }

    .output-check-table th:nth-child(5),  /* Part Code */
    .output-check-table td:nth-child(5) {
        width: auto;
        min-width: 120px;
    }

    .output-check-table th:nth-child(6),  /* QTY Check */
    .output-check-table td:nth-child(6) {
        width: 90px;
        min-width: 90px;
    }

    .output-check-table th:nth-child(7),  /* Line Stop */
    .output-check-table td:nth-child(7) {
        width: 90px;
        min-width: 90px;
    }

    .output-check-table th:nth-child(8),  /* Status */
    .output-check-table td:nth-child(8) {
        width: 100px;
        min-width: 100px;
    }

    .data-empty {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
    }

    .data-empty i {
        font-size: 64px;
        color: #d1d5db;
        margin-bottom: 16px;
    }

    .data-empty h3 {
        font-size: 18px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
    }

    .data-empty p {
        font-size: 14px;
        color: #6b7280;
    }

    @@keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Part Code Autocomplete Styles */
    .part-code-suggestions {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: white;
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 12px;
        max-height: 250px;
        overflow-y: auto;
        z-index: 10000;
        box-shadow: 
            0 20px 50px rgba(0, 0, 0, 0.15),
            0 0 0 1px rgba(0, 0, 0, 0.05);
        margin-top: 4px;
        opacity: 0;
        transform: translateY(-10px) scale(0.95);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .part-code-suggestions[style*="display: block"],
    .part-code-suggestions.show {
        opacity: 1 !important;
        transform: translateY(0) scale(1) !important;
        animation: dropdownSlideIn 0.2s ease-out;
    }

    .part-code-suggestion-item {
        padding: 12px 16px;
        cursor: pointer;
        border-bottom: 1px solid #f3f4f6;
        font-size: 14px;
        color: #1f2937;
        transition: all 0.2s ease;
        position: relative;
        border-left: 3px solid transparent;
    }

    .part-code-suggestion-item:hover {
        background: linear-gradient(90deg, #f3f4f6 0%, #e5e7eb 100%);
        border-left-color: #3b82f6;
        padding-left: 18px;
        transform: translateX(2px);
        font-weight: 500;
    }

    .part-code-suggestion-item:last-child {
        border-bottom: none;
    }

    .qchose-inline-row {
        position: relative;
    }

    /* Navigation Buttons Styles */
    .nav-buttons-container {
        display: flex;
        gap: 16px;
        margin-top: 32px;
        padding: 0 16px 32px;
    }

    .nav-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px 20px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 15px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }

    .nav-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }

    .nav-btn:hover::before {
        left: 100%;
    }

    .nav-btn i {
        font-size: 18px;
    }

    .nav-btn-home {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .nav-btn-home:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        color: white;
    }

    .nav-btn-scw {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }

    .nav-btn-scw:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        color: white;
    }

    .nav-btn-data {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        width: 100%;
    }

    .nav-btn-data:hover {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
    }

    .nav-btn:active {
        transform: translateY(0);
    }

    /* --------- RESPONSIVE LAYOUT (Desktop only, tidak untuk tablet) --------- */
    @@media (min-width: 1025px) {
        /* Pastikan desktop tetap normal dengan sidebar - OVERRIDE semua style tablet */
        /* Override dengan selector lebih spesifik untuk desktop */
        html body.desktop-view .main-content,
        body.desktop-view .main-content {
            margin-left: 260px !important;
            width: calc(100% - 260px) !important;
            max-width: calc(100% - 260px) !important;
            padding: 0 !important;
        }
        
        html body.desktop-view .main-content .content-area,
        body.desktop-view .main-content .content-area {
            padding: 30px !important;
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }
        
        html body.desktop-view .main-content .content-area .qchose-page,
        body.desktop-view .main-content .content-area .qchose-page,
        .qchose-page {
            max-width: 480px !important;
            width: 480px !important;
            padding: 20px 16px 100px 16px !important;
            margin: 0 auto !important;
            margin-left: auto !important;
            margin-right: auto !important;
            box-sizing: border-box !important;
        }
        
        /* Pastikan tombol desktop tetap normal */
        #btnLihatData,
        .data-menu-icon-btn-fixed {
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
        }
        
        .qchose-section {
            border-radius: 18px;
        }

        .qchose-header-title {
            font-size: 26px;
            color: #f1f5f9 !important;
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 50%, #3b82f6 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5) !important;
            filter: drop-shadow(0 2px 10px rgba(59, 130, 246, 0.4)) !important;
        }

        .qchose-header-subtitle {
            font-size: 14px;
            color: #94a3b8 !important;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }
    }

        .qchose-label {
            font-size: 13px;
        }

        .qchose-select,
        .qchose-input {
            font-size: 14px;
        }

        .qchose-inline-row {
            gap: 12px;
        }

        .nav-buttons-container {
            max-width: 720px;
            margin-left: auto;
            margin-right: auto;
        }
    }


        .qchose-header-subtitle {
            font-size: 15px;
        }

        .qchose-label {
            font-size: 14px;
        }

        .qchose-select,
        .qchose-input {
            font-size: 15px;
        }

        .nav-buttons-container {
            max-width: 900px;
        }
    }

    /* Line Stop Timer Styles */
    .line-stop-timer-container {
        margin-top: 16px;
        padding: 16px;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
    }

    .line-stop-timer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
    }

    .line-stop-checking-group {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        min-width: 150px;
    }

    .line-stop-checking-label {
        color: #22c55e;
        font-weight: 600;
        font-size: 14px;
        letter-spacing: 0.05em;
        white-space: nowrap;
    }

    .line-stop-timer-display {
        font-size: 18px;
        font-weight: 700;
        color: #22c55e;
        letter-spacing: 0.1em;
        font-family: 'Courier New', monospace;
        min-width: 80px;
        text-align: right;
        white-space: nowrap;
    }

    /* Responsive untuk Line Stop Timer */
    @@media (max-width: 480px) {
        .line-stop-timer-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .line-stop-checking-group {
            width: 100%;
            justify-content: space-between;
        }

        .line-stop-timer-display {
            width: 100%;
            text-align: left;
            font-size: 16px;
        }
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
        position: absolute;
    }

    /* Keyboard navigation support untuk toggle switch */
    .toggle-switch input:focus + .toggle-slider {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }

    .toggle-switch input:focus-visible + .toggle-slider {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: .4s;
        border-radius: 34px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
        background-color: #22c55e;
    }

    .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(22px);
    }
</style>

@section Scripts {
    <script>
        // Header datetime & timer dengan kontrol
        (function () {
            const timeStopEl = document.getElementById('qcHoseTimeStop');
            const statusTimeEl = document.getElementById('qcHoseStatusTime');
            const nowEl = document.getElementById('qcHoseNow');
            const timeStopValue = document.getElementById('timeStopValue');
            const statusCheckingTimeValue = document.getElementById('statusCheckingTimeValue');
            const timeStopLabel = document.getElementById('timeStopLabel');

            let timeStopSeconds = 0;
            let statusSeconds = 0;
            let timeStopInterval = null;
            let statusInterval = null;
            let timeStopRunning = false;
            let statusRunning = false;
            let timerStarted = false; // Flag untuk memastikan timer hanya start sekali

            // Update jam & tanggal realtime
            if (nowEl) {
                const updateNow = () => {
                    const d = new Date();
                    const pad = (n) => n.toString().padStart(2, '0');
                    const formatted = `${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
                    nowEl.textContent = formatted;
                };
                updateNow();
                setInterval(updateNow, 1000);
            }

            // Format waktu untuk Line Stop (H:M:S:MS) - jam:menit:detik:mili
            const formatLineStopTime = (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                const ms = 0; // Milidetik selalu 0 untuk sekarang
                // Format: H:M:S:MS (tanpa padding)
                return `${h}:${m}:${s}:${ms}`;
            };

            // Format waktu (H:M:S) - jam:menit:detik
            const formatTime = (seconds) => {
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                const s = seconds % 60;
                // Format: H:M:S (tanpa padding)
                return `${h}:${m}:${s}`;
            };

            // Timer untuk Time Stop
            const updateTimeStop = () => {
                if (timeStopRunning && timeStopEl) {
                    timeStopSeconds++;
                    const display = formatTime(timeStopSeconds);
                    timeStopEl.textContent = display;
                    if (timeStopValue) {
                        timeStopValue.value = display;
                    }
                }
            };

            // Timer untuk Line Stop Duration
            const lineStopTimeEl = document.getElementById('qcHoseLineStopTime');
            const lineStopDurationValue = document.getElementById('lineStopDurationValue');
            let lineStopSeconds = 0;
            let lineStopInterval = null;
            let lineStopRunning = false;

            const updateLineStopTimer = () => {
                if (lineStopRunning && lineStopTimeEl) {
                    lineStopSeconds++;
                    const display = formatLineStopTime(lineStopSeconds);
                    lineStopTimeEl.textContent = display;
                    if (lineStopDurationValue) {
                        lineStopDurationValue.value = display;
                    }
                }
            };

            // Toggle timer Line Stop (toggle switch)
            window.toggleLineStopTimer = () => {
                const toggle = document.getElementById('lineStopToggle');
                if (!toggle) return;

                const partCodeInput = document.getElementById('partCodeInputField') || document.getElementById('PartCode');
                const lineStopMessage = document.getElementById('lineStopMessage');
                const btnScanQR = document.getElementById('btnScanQR');
                const btnDimensi = document.getElementById('btnDimensi');
                const warningModal = document.getElementById('lineStopWarningModal');

                if (toggle.checked) {
                    // Cek apakah Part Code sudah diisi dan Time Stop timer sedang berjalan
                    const partCodeValue = partCodeInput ? partCodeInput.value.trim() : '';
                    const isPartCodeFilled = partCodeValue !== '';
                    const isTimeStopRunning = timeStopRunning && timeStopInterval !== null;

                    if (isPartCodeFilled && isTimeStopRunning) {
                        // Tampilkan popup peringatan dan uncheck toggle
                        toggle.checked = false;
                        if (warningModal) {
                            warningModal.style.display = 'flex';
                        }
                        console.log('Line Stop blocked: Part Code filled and Time Stop running');
                        return; // Jangan lanjutkan, stop di sini
                    }

                    // Start timer
                    lineStopRunning = true;
                    if (!lineStopInterval) {
                        lineStopInterval = setInterval(updateLineStopTimer, 1000);
                    }
                    
                    // Update label text dari "Checking" ke "Line Stop"
                    const lineStopLabel = document.querySelector('.line-stop-checking-label');
                    if (lineStopLabel) {
                        lineStopLabel.textContent = 'Line Stop';
                        lineStopLabel.style.color = '#ef4444'; // Red color untuk Line Stop
                        lineStopLabel.style.fontWeight = '700';
                    }
                    
                    // Disable Part Code input dan tampilkan pesan
                    if (partCodeInput) {
                        partCodeInput.disabled = true;
                        partCodeInput.style.backgroundColor = '#f3f4f6';
                        partCodeInput.style.cursor = 'not-allowed';
                        partCodeInput.value = ''; // Clear value saat Line Stop
                        // Stop Time Stop timer jika sedang berjalan
                        if (timeStopRunning && timeStopInterval) {
                            clearInterval(timeStopInterval);
                            timeStopInterval = null;
                            timeStopRunning = false;
                            timeStopSeconds = 0;
                            if (timeStopEl) timeStopEl.textContent = '0:0:0';
                            if (timeStopValue) timeStopValue.value = '0:0:0';
                        }
                    }
                    
                    // Tampilkan pesan "Sedang Line Stop"
                    if (lineStopMessage) {
                        lineStopMessage.style.display = 'flex';
                    }
                    
                    // Disable tombol Scan QR dan Dimensi
                    if (btnScanQR) {
                        btnScanQR.disabled = true;
                        btnScanQR.style.opacity = '0.5';
                        btnScanQR.style.cursor = 'not-allowed';
                    }
                    if (btnDimensi) {
                        btnDimensi.style.pointerEvents = 'none';
                        btnDimensi.style.opacity = '0.5';
                        btnDimensi.style.cursor = 'not-allowed';
                    }
                    
                    // Disable tombol Selesai Check saat Line Stop aktif
                    const btnSelesaiCheckActive = document.getElementById('btnSelesaiCheck');
                    if (btnSelesaiCheckActive) {
                        btnSelesaiCheckActive.disabled = true;
                        btnSelesaiCheckActive.style.opacity = '0.5';
                        btnSelesaiCheckActive.style.cursor = 'not-allowed';
                        btnSelesaiCheckActive.title = 'Selesaikan Line Stop terlebih dahulu sebelum submit';
                    }
                    
                    console.log('Line Stop timer started - Part Code disabled');
                } else {
                    // Stop timer
                    lineStopRunning = false;
                    if (lineStopInterval) {
                        clearInterval(lineStopInterval);
                        lineStopInterval = null;
                    }
                    
                    // Ambil data Line Stop untuk disimpan
                    const lineStopSelect = document.getElementById('lineStopSelect');
                    const lineStopValue = lineStopSelect ? lineStopSelect.value : '';
                    const durationValue = lineStopDurationValue ? lineStopDurationValue.value : '0:0:0:0';
                    
                    // Auto-save Line Stop ke database jika ada data
                    if (lineStopValue && durationValue && durationValue !== '0:0:0:0') {
                        const lineStopData = {
                            lineStop: lineStopValue,
                            statusCheckingTime: durationValue
                        };
                        
                        // Save via AJAX
                        fetch('/QCHose/SaveLineStop', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(lineStopData)
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                console.log('âœ… Line Stop data saved to database:', result.data);
                            } else {
                                console.error('âŒ Error saving Line Stop:', result.message);
                            }
                        })
                        .catch(error => {
                            console.error('âŒ Error saving Line Stop:', error);
                        });
                    }
                    
                    // Reset timer ke 0:0:0:0
                    lineStopSeconds = 0;
                    if (lineStopTimeEl) lineStopTimeEl.textContent = '0:0:0:0';
                    if (lineStopDurationValue) lineStopDurationValue.value = '0:0:0:0';
                    
                    // Reset dropdown ke "- Pilih Line Stop -"
                    if (lineStopSelect) {
                        lineStopSelect.value = '';
                    }
                    
                    // Sembunyikan timer container
                    const lineStopTimerRow = document.getElementById('lineStopTimerRow');
                    if (lineStopTimerRow) {
                        lineStopTimerRow.style.display = 'none';
                    }
                    
                    // Reset label text ke "Checking"
                    const lineStopLabel = document.querySelector('.line-stop-checking-label');
                    if (lineStopLabel) {
                        lineStopLabel.textContent = 'Checking';
                        lineStopLabel.style.color = ''; // Reset to default color
                        lineStopLabel.style.fontWeight = '';
                    }
                    
                    // Enable Part Code input dan sembunyikan pesan
                    if (partCodeInput) {
                        partCodeInput.disabled = false;
                        partCodeInput.style.backgroundColor = '';
                        partCodeInput.style.cursor = '';
                    }
                    
                    // Sembunyikan pesan "Sedang Line Stop"
                    if (lineStopMessage) {
                        lineStopMessage.style.display = 'none';
                    }
                    
                    // Enable tombol Scan QR dan Dimensi
                    if (btnScanQR) {
                        btnScanQR.disabled = false;
                        btnScanQR.style.opacity = '1';
                        btnScanQR.style.cursor = 'pointer';
                    }
                    if (btnDimensi) {
                        btnDimensi.style.pointerEvents = 'auto';
                        btnDimensi.style.opacity = '1';
                        btnDimensi.style.cursor = 'pointer';
                    }
                    
                    // Enable tombol Selesai Check saat Line Stop dihentikan
                    const btnSelesaiCheck = document.querySelector('.qchose-btn-secondary');
                    if (btnSelesaiCheck) {
                        btnSelesaiCheck.disabled = false;
                        btnSelesaiCheck.style.opacity = '1';
                        btnSelesaiCheck.style.cursor = 'pointer';
                        btnSelesaiCheck.title = '';
                    }
                    
                    console.log('Line Stop timer stopped and reset - Data saved to database, UI reset');
                }
            };

            // Timer Time Stop otomatis start saat Part Code diklik atau diisi
            // Fungsi untuk start timer (hanya sekali)
            const startTimeStopTimer = () => {
                if (!timerStarted && !timeStopRunning) {
                    timerStarted = true;
                    timeStopRunning = true;
                    
                    // Ubah label dari "Time Stop" menjadi "Time Check"
                    if (timeStopLabel) {
                        timeStopLabel.textContent = 'Time Check :';
                        timeStopLabel.style.color = '#22c55e'; // Hijau untuk menunjukkan timer aktif
                        timeStopLabel.style.fontWeight = '600';
                    }
                    
                    // Start timer
                    if (!timeStopInterval) {
                        timeStopInterval = setInterval(updateTimeStop, 1000);
                        console.log('Timer Time Stop started - Time:', new Date().toLocaleTimeString());
                    }
                }
            };

            // Part Code Autocomplete
            const partCodeInputField = document.getElementById('partCodeInputField') || document.getElementById('PartCode');
            const partCodeSuggestions = document.getElementById('partCodeSuggestions');
            const partCodeDatalist = document.getElementById('partCodeList');
            let allPartCodes = [];

            // Ambil semua part codes dari datalist
            if (partCodeDatalist) {
                const options = partCodeDatalist.querySelectorAll('option');
                allPartCodes = Array.from(options).map(opt => opt.value);
            }

            // Setup autocomplete untuk Part Code
            if (partCodeInputField && partCodeSuggestions) {
                partCodeInputField.addEventListener('input', (e) => {
                    const value = e.target.value.trim().toUpperCase();
                    const suggestionsContainer = partCodeSuggestions;
                    
                    // Start timer saat input
                    startTimeStopTimer();
                    
                    if (value.length === 0) {
                        suggestionsContainer.style.display = 'none';
                        suggestionsContainer.classList.remove('show');
                        return;
                    }

                    // Filter part codes yang dimulai dengan input user
                    const filtered = allPartCodes.filter(code => 
                        code.toUpperCase().startsWith(value)
                    ).slice(0, 10); // Limit 10 suggestions

                    if (filtered.length > 0) {
                        suggestionsContainer.innerHTML = filtered.map((code, index) => 
                            `<div class="part-code-suggestion-item" data-code="${code.replace(/"/g, '&quot;')}" data-index="${index}">${code}</div>`
                        ).join('');
                        suggestionsContainer.style.display = 'block';
                        // Force repaint untuk animasi dan tambahkan class show
                        suggestionsContainer.offsetHeight;
                        suggestionsContainer.classList.add('show');
                        
                        // Attach event listener ke setiap suggestion item
                        const suggestionItems = suggestionsContainer.querySelectorAll('.part-code-suggestion-item');
                        suggestionItems.forEach(item => {
                            item.addEventListener('click', (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                const selectedCode = item.getAttribute('data-code');
                                if (selectedCode && partCodeInputField) {
                                    partCodeInputField.value = selectedCode;
                                    suggestionsContainer.style.display = 'none';
                                    suggestionsContainer.classList.remove('show');
                                    // Trigger input event untuk start timer
                                    partCodeInputField.dispatchEvent(new Event('input', { bubbles: true }));
                                    partCodeInputField.focus(); // Keep focus on input
                                }
                            });
                        });
                    } else {
                        suggestionsContainer.style.display = 'none';
                    }
                });

                // Hide suggestions saat klik di luar (dengan delay untuk allow click on suggestions)
                document.addEventListener('click', (e) => {
                    if (partCodeInputField && partCodeSuggestions) {
                        // Jika klik bukan di input field atau suggestions container
                        if (!partCodeInputField.contains(e.target) && 
                            !partCodeSuggestions.contains(e.target)) {
                            partCodeSuggestions.style.display = 'none';
                            partCodeSuggestions.classList.remove('show');
                        }
                    }
                });

                // Hide suggestions saat focus out (dengan delay untuk allow click)
                partCodeInputField.addEventListener('blur', (e) => {
                    // Delay untuk allow click pada suggestion items
                    setTimeout(() => {
                        if (partCodeSuggestions && 
                            !partCodeSuggestions.contains(document.activeElement)) {
                            partCodeSuggestions.style.display = 'none';
                            partCodeSuggestions.classList.remove('show');
                        }
                    }, 250);
                });
            }

            // Fungsi untuk memilih part code dari suggestions (fallback)
            window.selectPartCode = (code) => {
                if (partCodeInputField) {
                    partCodeInputField.value = code;
                    if (partCodeSuggestions) {
                        partCodeSuggestions.style.display = 'none';
                    }
                    // Trigger input event untuk start timer
                    partCodeInputField.dispatchEvent(new Event('input', { bubbles: true }));
                    partCodeInputField.focus();
                }
            };
            
            // Setup event listener untuk Part Code - pastikan DOM sudah ready
            let partCodeTimerSetup = false; // Flag untuk menghindari setup berulang
            const setupPartCodeTimer = () => {
                if (partCodeTimerSetup) return; // Sudah di-setup, skip
                
                const partCodeInputEl = partCodeInputField || document.getElementById('PartCode');
                if (partCodeInputEl) {
                    // Start timer saat Part Code diklik (focus)
                    partCodeInputEl.addEventListener('focus', startTimeStopTimer, { passive: true, once: false });
                    
                    // Start timer saat Part Code diubah (change) - untuk memastikan
                    partCodeInputEl.addEventListener('change', startTimeStopTimer, { passive: true, once: false });
                    
                    partCodeTimerSetup = true;
                    console.log('Part Code event listeners attached to element:', partCodeInputEl.id || partCodeInputEl.name);
                } else {
                    console.error('Part Code input element not found!');
                }
            };
            
            // Setup saat DOM ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupPartCodeTimer);
            } else {
                // DOM sudah ready, setup langsung
                setupPartCodeTimer();
            }
            
            // Fallback: setup lagi setelah sedikit delay untuk memastikan
            setTimeout(setupPartCodeTimer, 200);


            // Kontrol Status Checking
            const btnStartStatus = document.getElementById('btnStartStatus');
            const btnStopStatus = document.getElementById('btnStopStatus');
            const btnResetStatus = document.getElementById('btnResetStatus');

            if (btnStartStatus) {
                btnStartStatus.addEventListener('click', () => {
                    statusRunning = true;
                    statusInterval = setInterval(updateStatus, 1000);
                    btnStartStatus.style.display = 'none';
                    btnStopStatus.style.display = 'block';
                });
            }

            if (btnStopStatus) {
                btnStopStatus.addEventListener('click', () => {
                    statusRunning = false;
                    if (statusInterval) {
                        clearInterval(statusInterval);
                        statusInterval = null;
                    }
                    btnStartStatus.style.display = 'block';
                    btnStopStatus.style.display = 'none';
                });
            }

            if (btnResetStatus) {
                btnResetStatus.addEventListener('click', () => {
                    statusRunning = false;
                    if (statusInterval) {
                        clearInterval(statusInterval);
                        statusInterval = null;
                    }
                    statusSeconds = 0;
                    if (statusTimeEl) statusTimeEl.textContent = '0:0:0';
                    if (statusCheckingTimeValue) statusCheckingTimeValue.value = '0:0:0';
                    btnStartStatus.style.display = 'block';
                    btnStopStatus.style.display = 'none';
                });
            }

            // Kontrol Timer Line Stop
            const lineStopSelect = document.getElementById('lineStopSelect');
            const lineStopTimerRow = document.getElementById('lineStopTimerRow');

            // Tampilkan timer saat Line Stop dipilih
            if (lineStopSelect) {
                lineStopSelect.addEventListener('change', (e) => {
                    const partCodeInput = document.getElementById('partCodeInputField') || document.getElementById('PartCode');
                    const lineStopMessage = document.getElementById('lineStopMessage');
                    const btnScanQR = document.getElementById('btnScanQR');
                    const btnDimensi = document.getElementById('btnDimensi');
                    
                    if (e.target.value && e.target.value.trim() !== '') {
                        // Tampilkan timer
                        if (lineStopTimerRow) lineStopTimerRow.style.display = 'block';
                    } else {
                        // Sembunyikan timer jika Line Stop dikosongkan
                        if (lineStopTimerRow) lineStopTimerRow.style.display = 'none';
                        // Reset timer
                        lineStopRunning = false;
                        const toggle = document.getElementById('lineStopToggle');
                        if (toggle) toggle.checked = false;
                        if (lineStopInterval) {
                            clearInterval(lineStopInterval);
                            lineStopInterval = null;
                        }
                        lineStopSeconds = 0;
                        if (lineStopTimeEl) lineStopTimeEl.textContent = '0:0:0:0';
                        if (lineStopDurationValue) lineStopDurationValue.value = '0:0:0:0';
                        
                        // Enable Part Code input saat Line Stop dihapus
                        if (partCodeInput) {
                            partCodeInput.disabled = false;
                            partCodeInput.style.backgroundColor = '';
                            partCodeInput.style.cursor = '';
                        }
                        if (lineStopMessage) {
                            lineStopMessage.style.display = 'none';
                        }
                        if (btnScanQR) {
                            btnScanQR.disabled = false;
                            btnScanQR.style.opacity = '1';
                            btnScanQR.style.cursor = 'pointer';
                        }
                        if (btnDimensi) {
                            btnDimensi.style.pointerEvents = 'auto';
                            btnDimensi.style.opacity = '1';
                            btnDimensi.style.cursor = 'pointer';
                        }
                    }
                });
            }

            // QR Code / Barcode Scanner dengan kamera
            const btnScanQR = document.getElementById('btnScanQR');
            let scannerActive = false;
            let scannerModal = null;
            let currentStream = null;
            let currentFacingMode = 'environment'; // 'environment' = back, 'user' = front
            let currentInputElement = null;
            let scanAnimationFrame = null;
            let scanning = false;
            
            // Manual input dialog function (defined early)
            function showManualInputDialog(inputElement) {
                const manualInput = prompt('Masukkan Part Code secara manual:');
                if (manualInput && manualInput.trim()) {
                    const manualValue = manualInput.trim().toUpperCase();
                    console.log('Manual input:', manualValue);
                    console.log('Input element:', inputElement);
                    
                    if (inputElement) {
                        inputElement.value = manualValue;
                        inputElement.dispatchEvent(new Event('input', { bubbles: true }));
                        inputElement.dispatchEvent(new Event('change', { bubbles: true }));
                        inputElement.focus();
                        
                        // Show success feedback
                        const originalBg = inputElement.style.backgroundColor;
                        inputElement.style.backgroundColor = '#dcfce7';
                        setTimeout(() => {
                            inputElement.style.backgroundColor = originalBg;
                        }, 1000);
                        
                        console.log('Manual input value set to:', inputElement.value);
                    } else {
                        console.error('Input element not found for manual input');
                    }
                }
            }
            
            // Create scanner modal
            function createScannerModal() {
                if (scannerModal) return scannerModal;
                
                const modal = document.createElement('div');
                modal.id = 'qrScannerModal';
                modal.className = 'qr-scanner-modal';
                modal.innerHTML = `
                    <div class="qr-scanner-content">
                        <div class="qr-scanner-header">
                            <h3>Scan Barcode / QR Code</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" class="qr-scanner-switch-camera" id="switchCamera" title="Ganti Kamera">
                                    <i class="bi bi-arrow-repeat"></i>
                                </button>
                                <button type="button" class="qr-scanner-close" id="closeScanner">&times;</button>
                            </div>
                        </div>
                        <div class="qr-scanner-body">
                            <div id="qr-scanner-container">
                                <div class="qr-scanning-indicator" id="qrScanningIndicator">
                                    <div class="qr-scanning-dot"></div>
                                    <span>Memindai...</span>
                                </div>
                                <div id="html5-qrcode-container" style="display: none;"></div>
                                <div id="quagga-scanner-container" style="display: none;"></div>
                                <div class="qr-bounding-box" id="qrBoundingBox"></div>
                                <video id="qr-video" autoplay playsinline style="display: none; width: 100%; max-width: 100%; height: auto; aspect-ratio: 4 / 3; border-radius: 12px; background: #000; object-fit: cover;"></video>
                                <canvas id="qr-canvas" style="display: none;"></canvas>
                                <canvas id="qr-overlay" style="position: absolute; top: 0; left: 0; pointer-events: none; z-index: 10; border-radius: 8px;"></canvas>
                            </div>
                            <div class="qr-scanner-instructions">
                                <p><i class="bi bi-info-circle"></i> Arahkan kamera ke barcode/QR code</p>
                                <p style="font-size: 12px; color: #6b7280;">Pastikan barcode/QR code dalam jangkauan kamera dan kotak hijau akan muncul saat terdeteksi</p>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                return modal;
            }
            
            if (btnScanQR) {
                console.log('btnScanQR element found, attaching click listener');
                btnScanQR.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('Scan QR button clicked');
                    
                    // Check if scanner is already active
                    if (scannerActive) {
                        console.log('Scanner is active, stopping...');
                        stopScanner();
                        return;
                    }
                    
                    // Check if Part Code input is disabled (Line Stop active)
                    const partCodeInputEl = document.getElementById('partCodeInputField') || 
                                           document.querySelector('input[name="PartCode"]') || 
                                           document.getElementById('PartCode');
                    
                    if (partCodeInputEl && partCodeInputEl.disabled) {
                        console.log('Part Code input is disabled (Line Stop active)');
                        alert('Part Code tidak dapat diisi saat Line Stop aktif!');
                        return;
                    }
                    
                    if (!partCodeInputEl) {
                        console.error('Input Part Code tidak ditemukan');
                        alert('Input Part Code tidak ditemukan');
                        return;
                    }
                    
                    console.log('Starting scanner for input:', partCodeInputEl.id || partCodeInputEl.name || partCodeInputEl);
                    
                    // Check if browser supports camera
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        console.log('Camera API not available, showing manual input dialog');
                        // Fallback to manual input if camera not available
                        showManualInputDialog(partCodeInputEl);
                        return;
                    }
                    
                    startScanner(partCodeInputEl);
                });
                
                // Also add mouseenter to check if button is clickable
                btnScanQR.addEventListener('mouseenter', function() {
                    console.log('Mouse hover over Scan QR button');
                });
            } else {
                console.error('btnScanQR element NOT FOUND!');
            }
            
            // Deteksi device mobile/tablet
            function isMobileOrTablet() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
            
            function startScanner(inputElement, facingMode = null) {
                console.log('=== STARTING SCANNER ===');
                scannerModal = createScannerModal();
                scannerModal.style.display = 'flex';
                scannerActive = true;
                
                // Set facing mode if provided, otherwise use current
                if (facingMode) {
                    currentFacingMode = facingMode;
                }
                currentInputElement = inputElement;
                
                const video = document.getElementById('qr-video');
                const canvas = document.getElementById('qr-canvas');
                const context = canvas.getContext('2d');
                
                // Ensure video is visible dengan ukuran konsisten
                video.style.display = 'block';
                video.style.width = '100%';
                video.style.maxWidth = '100%';
                video.style.height = 'auto';
                video.style.aspectRatio = '4 / 3';
                video.style.borderRadius = '12px';
                video.style.background = '#000';
                video.style.objectFit = 'cover';
                
                console.log('Requesting camera access with facingMode:', currentFacingMode);
                
                // Request camera access
                navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: { ideal: currentFacingMode },
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                })
                .then(function(stream) {
                    console.log('Camera access granted');
                    currentStream = stream;
                    video.srcObject = stream;
                    video.setAttribute('playsinline', 'true');
                    
                    // Wait for video to be ready
                    video.onloadedmetadata = () => {
                        console.log('Video metadata loaded');
                        console.log('Video dimensions:', video.videoWidth, 'x', video.videoHeight);
                        
                        // Pastikan ukuran video tetap konsisten
                        video.style.width = '100%';
                        video.style.maxWidth = '100%';
                        video.style.height = 'auto';
                        video.style.aspectRatio = '4 / 3';
                        video.style.objectFit = 'cover';
                        
                        video.play().then(() => {
                            console.log('Video playing');
                            startScanningLoop(video, canvas, context, inputElement);
                        }).catch(err => {
                            console.error('Error playing video:', err);
                        });
                    };
                    
                    // Pastikan ukuran tetap konsisten saat resize
                    video.onresize = () => {
                        video.style.width = '100%';
                        video.style.maxWidth = '100%';
                        video.style.height = 'auto';
                        video.style.aspectRatio = '4 / 3';
                    };
                    
                    video.onerror = (err) => {
                        console.error('Video error:', err);
                    };
                })
                .catch(function(err) {
                    console.error('Error accessing camera:', err);
                    if (scannerModal) {
                        scannerModal.style.display = 'none';
                    }
                    scannerActive = false;
                    
                    // Fallback to manual input
                    showManualInputDialog(inputElement);
                });
                
                // Close button
                const closeBtn = document.getElementById('closeScanner');
                if (closeBtn) {
                    closeBtn.onclick = stopScanner;
                }
                
                // Switch camera button
                const switchCameraBtn = document.getElementById('switchCamera');
                if (switchCameraBtn) {
                    switchCameraBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        switchCamera();
                    };
                }
                
                // Close on outside click
                scannerModal.onclick = function(e) {
                    if (e.target === scannerModal) {
                        stopScanner();
                    }
                };
            }
            
            function switchCamera() {
                if (!scannerActive || !currentInputElement) {
                    console.log('Cannot switch camera: scanner not active');
                    return;
                }
                
                console.log('Switching camera from', currentFacingMode);
                
                // Stop scanning loop
                scanning = false;
                if (scanAnimationFrame) {
                    cancelAnimationFrame(scanAnimationFrame);
                    scanAnimationFrame = null;
                }
                
                // Stop html5-qrcode if active
                if (window.html5QrCodeInstance) {
                    window.html5QrCodeInstance.stop().catch(() => {
                        console.log('Scanner already stopped');
                    });
                    window.html5QrCodeInstance = null;
                }
                
                // Stop Quagga if running
                if (typeof Quagga !== 'undefined' && Quagga.initialized) {
                    try {
                        Quagga.stop();
                    } catch (e) {
                        console.log('Error stopping Quagga:', e);
                    }
                }
                
                // Toggle facing mode
                currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
                console.log('Switching to', currentFacingMode);
                
                // Stop current stream
                const video = document.getElementById('qr-video');
                if (video && video.srcObject) {
                    const tracks = video.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                    video.srcObject = null;
                }
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
                
                // Clear bounding box overlay
                const overlayCanvas = document.getElementById('qr-overlay');
                if (overlayCanvas) {
                    const overlayContext = overlayCanvas.getContext('2d');
                    if (overlayContext) {
                        overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
                    }
                }
                
                // Restart scanner with new camera
                setTimeout(() => {
                    startScanner(currentInputElement, currentFacingMode);
                }, 300);
            }
            
            function startScanningLoop(video, canvas, context, inputElement) {
                scanning = true;
                let html5QrCodeInstance = null;
                
                // Store reference to input element globally for this scanner session
                window.currentScannerInputElement = inputElement;
                console.log('Scanner input element stored:', inputElement);
                
                // Show scanning indicator
                const scanningIndicator = document.getElementById('qrScanningIndicator');
                if (scanningIndicator) {
                    scanningIndicator.classList.add('scanning');
                }
                
                // Update scanning indicator text
                function updateScanningStatus(text, isDetected = false) {
                    if (scanningIndicator) {
                        const span = scanningIndicator.querySelector('span');
                        if (span) span.textContent = text;
                        if (isDetected) {
                            scanningIndicator.classList.add('detected');
                        } else {
                            scanningIndicator.classList.remove('detected');
                        }
                    }
                }
                
                // Update bounding box position using canvas overlay
                const overlayCanvas = document.getElementById('qr-overlay');
                const overlayContext = overlayCanvas ? overlayCanvas.getContext('2d') : null;
                
                function drawBoundingBox(barcode, videoWidth, videoHeight) {
                    if (!overlayCanvas || !overlayContext) {
                        console.log('Overlay canvas not available');
                        return;
                    }
                    
                    // Get video element dimensions (not container)
                    const videoElement = document.getElementById('qr-video');
                    if (!videoElement) {
                        console.log('Video element not found');
                        return;
                    }
                    
                    const videoRect = videoElement.getBoundingClientRect();
                    const displayWidth = videoRect.width;
                    const displayHeight = videoRect.height;
                    
                    console.log('Drawing bounding box - Video:', videoWidth, 'x', videoHeight, 'Display:', displayWidth, 'x', displayHeight);
                    
                    // Set overlay canvas size to match video display
                    overlayCanvas.width = displayWidth;
                    overlayCanvas.height = displayHeight;
                    overlayCanvas.style.width = displayWidth + 'px';
                    overlayCanvas.style.height = displayHeight + 'px';
                    
                    // Clear previous drawing
                    overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
                    
                    // Calculate scale factors
                    const scaleX = displayWidth / (videoWidth || 1);
                    const scaleY = displayHeight / (videoHeight || 1);
                    
                    // Draw bounding box from barcode detection
                    if (barcode.boundingBox) {
                        const box = barcode.boundingBox;
                        const x = box.x * scaleX;
                        const y = box.y * scaleY;
                        const width = box.width * scaleX;
                        const height = box.height * scaleY;
                        
                        // Draw green rectangle with rounded corners
                        overlayContext.strokeStyle = '#22c55e';
                        overlayContext.lineWidth = 4;
                        overlayContext.setLineDash([]);
                        
                        // Draw main rectangle (using standard rectangle for compatibility)
                        overlayContext.beginPath();
                        overlayContext.rect(x, y, width, height);
                        overlayContext.stroke();
                        
                        // Draw corner indicators
                        const cornerLength = 25;
                        overlayContext.strokeStyle = '#22c55e';
                        overlayContext.lineWidth = 5;
                        overlayContext.lineCap = 'round';
                        
                        // Top-left corner
                        overlayContext.beginPath();
                        overlayContext.moveTo(x, y + cornerLength);
                        overlayContext.lineTo(x, y);
                        overlayContext.lineTo(x + cornerLength, y);
                        overlayContext.stroke();
                        
                        // Top-right corner
                        overlayContext.beginPath();
                        overlayContext.moveTo(x + width - cornerLength, y);
                        overlayContext.lineTo(x + width, y);
                        overlayContext.lineTo(x + width, y + cornerLength);
                        overlayContext.stroke();
                        
                        // Bottom-left corner
                        overlayContext.beginPath();
                        overlayContext.moveTo(x, y + height - cornerLength);
                        overlayContext.lineTo(x, y + height);
                        overlayContext.lineTo(x + cornerLength, y + height);
                        overlayContext.stroke();
                        
                        // Bottom-right corner
                        overlayContext.beginPath();
                        overlayContext.moveTo(x + width - cornerLength, y + height);
                        overlayContext.lineTo(x + width, y + height);
                        overlayContext.lineTo(x + width, y + height - cornerLength);
                        overlayContext.stroke();
                        
                        // Draw success text
                        overlayContext.fillStyle = '#22c55e';
                        overlayContext.font = 'bold 16px Arial';
                        overlayContext.textAlign = 'center';
                        overlayContext.textBaseline = 'top';
                        overlayContext.fillText('âœ“ Barcode Terdeteksi', x + width / 2, y + height + 10);
                    } else if (barcode.cornerPoints && barcode.cornerPoints.length >= 4) {
                        // Draw polygon if corner points are available
                        overlayContext.strokeStyle = '#22c55e';
                        overlayContext.lineWidth = 4;
                        overlayContext.beginPath();
                        
                        barcode.cornerPoints.forEach((point, index) => {
                            const x = point.x * scaleX;
                            const y = point.y * scaleY;
                            if (index === 0) {
                                overlayContext.moveTo(x, y);
                            } else {
                                overlayContext.lineTo(x, y);
                            }
                        });
                        overlayContext.closePath();
                        overlayContext.stroke();
                        
                        // Draw corner indicators
                        overlayContext.fillStyle = '#22c55e';
                        barcode.cornerPoints.forEach(point => {
                            const x = point.x * scaleX;
                            const y = point.y * scaleY;
                            overlayContext.beginPath();
                            overlayContext.arc(x, y, 6, 0, 2 * Math.PI);
                            overlayContext.fill();
                        });
                    }
                }
                
                function clearBoundingBox() {
                    if (overlayCanvas && overlayContext) {
                        overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
                    }
                }
                
                // Draw bounding box for Quagga
                function drawQuaggaBoundingBox(box, container) {
                    if (!overlayCanvas || !overlayContext || !container) return;
                    
                    const containerRect = container.getBoundingClientRect();
                    overlayCanvas.width = containerRect.width;
                    overlayCanvas.height = containerRect.height;
                    overlayCanvas.style.width = containerRect.width + 'px';
                    overlayCanvas.style.height = containerRect.height + 'px';
                    
                    overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
                    
                    // Draw green rectangle around barcode
                    overlayContext.strokeStyle = '#22c55e';
                    overlayContext.lineWidth = 4;
                    
                    // Draw box
                    overlayContext.beginPath();
                    overlayContext.moveTo(box[0].x, box[0].y);
                    overlayContext.lineTo(box[1].x, box[1].y);
                    overlayContext.lineTo(box[2].x, box[2].y);
                    overlayContext.lineTo(box[3].x, box[3].y);
                    overlayContext.closePath();
                    overlayContext.stroke();
                    
                    // Draw corner indicators
                    const cornerLength = 25;
                    overlayContext.lineWidth = 5;
                    overlayContext.lineCap = 'round';
                    
                    box.forEach((point, index) => {
                        const nextPoint = box[(index + 1) % 4];
                        overlayContext.beginPath();
                        overlayContext.moveTo(point.x, point.y);
                        overlayContext.lineTo(
                            point.x + (nextPoint.x - point.x) * 0.3,
                            point.y + (nextPoint.y - point.y) * 0.3
                        );
                        overlayContext.stroke();
                    });
                    
                    // Draw success text
                    const centerX = (box[0].x + box[2].x) / 2;
                    const centerY = (box[0].y + box[2].y) / 2;
                    overlayContext.fillStyle = '#22c55e';
                    overlayContext.font = 'bold 16px Arial';
                    overlayContext.textAlign = 'center';
                    overlayContext.fillText('âœ“ Barcode Terdeteksi', centerX, centerY + 30);
                }
                
                // Update bounding box position (for html5-qrcode)
                function updateBoundingBox(boundingBox) {
                    const boxElement = document.getElementById('qrBoundingBox');
                    if (boxElement && boundingBox) {
                        boxElement.style.left = boundingBox.x + 'px';
                        boxElement.style.top = boundingBox.y + 'px';
                        boxElement.style.width = boundingBox.width + 'px';
                        boxElement.style.height = boundingBox.height + 'px';
                        boxElement.classList.add('active');
                    } else if (boxElement) {
                        boxElement.classList.remove('active');
                    }
                }
                
                // Use QuaggaJS untuk desktop, BarcodeDetector untuk mobile/tablet
                console.log('Initializing barcode scanner...');
                
                const mobileOrTablet = isMobileOrTablet();
                
                // Desktop â†’ pakai Quagga (lebih stabil), Mobile/Tablet â†’ skip Quagga langsung ke BarcodeDetector
                if (!mobileOrTablet && typeof Quagga !== 'undefined') {
                    console.log('QuaggaJS available, initializing scanner');
                    
                    // Hide other containers
                    const container = document.getElementById('html5-qrcode-container');
                    if (container) container.style.display = 'none';
                    video.style.display = 'none';
                    
                    // Get or create Quagga container
                    let quaggaContainer = document.getElementById('quagga-scanner-container');
                    if (!quaggaContainer) {
                        quaggaContainer = document.createElement('div');
                        quaggaContainer.id = 'quagga-scanner-container';
                        quaggaContainer.style.cssText = 'width: 100%; max-width: 500px; margin: 0 auto; position: relative;';
                        const scannerContainer = document.getElementById('qr-scanner-container');
                        if (scannerContainer) {
                            scannerContainer.appendChild(quaggaContainer);
                        }
                    }
                    quaggaContainer.style.display = 'block';
                    
                    updateScanningStatus('Memindai Barcode...', false);
                    
                    Quagga.init({
                        inputStream: {
                            name: "Live",
                            type: "LiveStream",
                            target: quaggaContainer,
                            constraints: {
                                width: { min: 640, ideal: 1280, max: 1920 },
                                height: { min: 480, ideal: 720, max: 1080 },
                                facingMode: currentFacingMode
                            }
                        },
                        locator: {
                            patchSize: "medium",
                            halfSample: true
                        },
                        numOfWorkers: 2,
                        decoder: {
                            readers: [
                                "code_128_reader",
                                "ean_reader",
                                "ean_8_reader",
                                "code_39_reader",
                                "code_39_vin_reader",
                                "codabar_reader",
                                "upc_reader",
                                "upc_e_reader",
                                "i2of5_reader"
                            ]
                        },
                        locate: true
                    }, function(err) {
                        if (err) {
                            console.error('Quagga initialization error:', err);
                            updateScanningStatus('Error: ' + err.message, false);
                            stopScanner();
                            const currentInput = window.currentScannerInputElement || inputElement;
                            showManualInputDialog(currentInput);
                            return;
                        }
                        console.log('Quagga initialization finished. Ready to start');
                        Quagga.start();
                    });
                    
                    // Handle barcode detection
                    Quagga.onDetected(function(result) {
                        if (scannerActive && scanning) {
                            const code = result.codeResult.code;
                            console.log('=== BARCODE DETECTED BY QUAGGA ===');
                            console.log('Barcode:', code);
                            console.log('Format:', result.codeResult.format);
                            
                            updateScanningStatus('âœ“ Barcode Terdeteksi!', true);
                            scanning = false;
                            
                            // Stop Quagga
                            Quagga.stop();
                            
                            // Small delay to show visual feedback
                            setTimeout(() => {
                                if (scannerActive) {
                                    const currentInput = window.currentScannerInputElement || 
                                                       document.getElementById('partCodeInputField') || 
                                                       document.querySelector('input[name="PartCode"]') || 
                                                       document.getElementById('PartCode');
                                    
                                    console.log('Calling handleScannedCode with:', code, currentInput);
                                    handleScannedCode(code, currentInput);
                                }
                            }, 500);
                        }
                    });
                    
                    // Handle detection process (for bounding box visualization)
                    Quagga.onProcessed(function(result) {
                        const drawingCtx = Quagga.canvas.ctx.overlay;
                        const drawingCanvas = Quagga.canvas.dom.overlay;
                        
                        if (result) {
                            if (result.boxes) {
                                drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                                result.boxes.filter(function(box) {
                                    return box !== result.box;
                                }).forEach(function(box) {
                                    Quagga.ImageDebug.drawPath(box, {x: 0, y: 1}, drawingCtx, {color: "green", lineWidth: 2});
                                });
                            }
                            
                            if (result.box) {
                                Quagga.ImageDebug.drawPath(result.box, {x: 0, y: 1}, drawingCtx, {color: "#22c55e", lineWidth: 3});
                            }
                            
                            if (result.codeResult && result.codeResult.code) {
                                Quagga.ImageDebug.drawPath(result.line, {x: 'x', y: 'y'}, drawingCtx, {color: 'red', lineWidth: 2});
                            }
                        }
                    });
                } else {
                    console.log('QuaggaJS not available, trying BarcodeDetector API...');
                    
                    // Fallback to BarcodeDetector API (priority 2)
                    if (window.BarcodeDetector) {
                        console.log('Using BarcodeDetector API as fallback');
                        
                        video.style.display = 'block';
                        video.style.width = '100%';
                        video.style.maxWidth = '500px';
                        video.style.borderRadius = '8px';
                        const container = document.getElementById('html5-qrcode-container');
                        if (container) container.style.display = 'none';
                        
                        const barcodeDetector = new BarcodeDetector({ 
                            formats: ['code_128', 'ean_13', 'ean_8', 'code_39', 'code_93', 'codabar', 'itf', 'upc_a', 'upc_e'] 
                        });
                        
                        function scanBarcode() {
                            if (!scannerActive || !scanning) {
                                clearBoundingBox();
                                if (scanAnimationFrame) {
                                    cancelAnimationFrame(scanAnimationFrame);
                                    scanAnimationFrame = null;
                                }
                                return;
                            }
                            
                            if (video.readyState >= video.HAVE_METADATA) {
                                try {
                                    canvas.width = video.videoWidth || 640;
                                    canvas.height = video.videoHeight || 480;
                                    
                                    if (video.videoWidth > 0 && video.videoHeight > 0) {
                                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                                        
                                        barcodeDetector.detect(canvas)
                                            .then(barcodes => {
                                                if (barcodes && barcodes.length > 0 && scannerActive && scanning) {
                                                    const barcode = barcodes[0];
                                                    const code = barcode.rawValue;
                                                    console.log('=== BARCODE DETECTED ===');
                                                    console.log('Barcode:', code);
                                                    
                                                    drawBoundingBox(barcode, canvas.width, canvas.height);
                                                    updateScanningStatus('âœ“ Barcode Terdeteksi!', true);
                                                    
                                                    scanning = false;
                                                    if (scanAnimationFrame) {
                                                        cancelAnimationFrame(scanAnimationFrame);
                                                        scanAnimationFrame = null;
                                                    }
                                                    
                                                    setTimeout(() => {
                                                        if (scannerActive) {
                                                            const currentInput = window.currentScannerInputElement || 
                                                                               document.getElementById('partCodeInputField') || 
                                                                               document.querySelector('input[name="PartCode"]') || 
                                                                               document.getElementById('PartCode');
                                                            handleScannedCode(code, currentInput);
                                                        }
                                                    }, 500);
                                                } else {
                                                    clearBoundingBox();
                                                    if (scannerActive && scanning) {
                                                        scanAnimationFrame = requestAnimationFrame(scanBarcode);
                                                    }
                                                }
                                            })
                                            .catch((err) => {
                                                if (scannerActive && scanning) {
                                                    scanAnimationFrame = requestAnimationFrame(scanBarcode);
                                                }
                                            });
                                    } else {
                                        if (scannerActive && scanning) {
                                            scanAnimationFrame = requestAnimationFrame(scanBarcode);
                                        }
                                    }
                                } catch (err) {
                                    console.error('Error in scanBarcode:', err);
                                    if (scannerActive && scanning) {
                                        scanAnimationFrame = requestAnimationFrame(scanBarcode);
                                    }
                                }
                            } else {
                                if (scannerActive && scanning) {
                                    scanAnimationFrame = requestAnimationFrame(scanBarcode);
                                }
                            }
                        }
                        
                        const startScanning = () => {
                            if (scannerActive && scanning) {
                                scanBarcode();
                            }
                        };
                        
                        video.addEventListener('loadedmetadata', startScanning, { once: true });
                        if (video.readyState >= video.HAVE_METADATA) {
                            setTimeout(startScanning, 100);
                        }
                    } else {
                        // Jika BarcodeDetector juga tidak tersedia, langsung pakai input manual
                        console.log('BarcodeDetector tidak tersedia, gunakan input manual');
                        stopScanner();
                        const currentInput = window.currentScannerInputElement || inputElement;
                        showManualInputDialog(currentInput);
                    }
                }
            }
            
            function handleScannedCode(code, inputElement) {
                console.log('=== HANDLE SCANNED CODE CALLED ===');
                console.log('Code received:', code);
                console.log('Input element received:', inputElement);
                
                if (!code || !code.trim()) {
                    console.warn('Empty or invalid code scanned');
                    return;
                }
                
                const scannedValue = code.trim().toUpperCase();
                console.log('Scanned value (uppercase):', scannedValue);
                
                // Find the actual input element if not found
                let actualInputElement = inputElement;
                if (!actualInputElement) {
                    console.log('Input element not provided, searching...');
                    actualInputElement = document.getElementById('partCodeInputField') || 
                                       document.querySelector('input[name="PartCode"]') || 
                                       document.querySelector('input[id="PartCode"]') ||
                                       document.getElementById('PartCode');
                    console.log('Input element found:', actualInputElement);
                }
                
                if (!actualInputElement) {
                    console.error('ERROR: Input element not found!');
                    console.error('Tried selectors: #partCodeInputField, input[name="PartCode"], #PartCode');
                    alert('Input Part Code tidak ditemukan. Silakan refresh halaman.');
                    stopScanner();
                    return;
                }
                
                console.log('Found input element:', {
                    id: actualInputElement.id,
                    name: actualInputElement.name,
                    type: actualInputElement.type,
                    currentValue: actualInputElement.value
                });
                
                // Set value to input field
                actualInputElement.value = scannedValue;
                console.log('Value set to input field:', actualInputElement.value);
                
                // Verify value was set
                if (actualInputElement.value !== scannedValue) {
                    console.error('ERROR: Value was not set correctly!');
                    console.error('Expected:', scannedValue, 'Got:', actualInputElement.value);
                    // Try setting it again
                    actualInputElement.setAttribute('value', scannedValue);
                    actualInputElement.value = scannedValue;
                }
                
                // Trigger events to ensure all handlers are called
                console.log('Dispatching events...');
                actualInputElement.dispatchEvent(new Event('input', { bubbles: true, cancelable: true }));
                actualInputElement.dispatchEvent(new Event('change', { bubbles: true, cancelable: true }));
                actualInputElement.dispatchEvent(new KeyboardEvent('keyup', { bubbles: true, cancelable: true }));
                
                // Also trigger native input event
                const nativeInputEvent = new InputEvent('input', {
                    bubbles: true,
                    cancelable: true,
                    data: scannedValue
                });
                actualInputElement.dispatchEvent(nativeInputEvent);
                
                // Trigger focus to ensure field is active
                setTimeout(() => {
                    actualInputElement.focus();
                    console.log('Input focused, final value:', actualInputElement.value);
                }, 100);
                
                console.log('Final verification - Input value:', actualInputElement.value);
                console.log('=== END HANDLE SCANNED CODE ===');
                
                // Stop scanner
                stopScanner();
                
                // Show success feedback
                const originalBg = actualInputElement.style.backgroundColor;
                const originalBorder = actualInputElement.style.borderColor;
                actualInputElement.style.backgroundColor = '#dcfce7';
                actualInputElement.style.borderColor = '#22c55e';
                actualInputElement.style.borderWidth = '2px';
                setTimeout(() => {
                    actualInputElement.style.backgroundColor = originalBg || '';
                    actualInputElement.style.borderColor = originalBorder || '';
                    actualInputElement.style.borderWidth = '';
                }, 2000);
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.textContent = 'âœ“ Barcode berhasil di-scan: ' + scannedValue;
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 12px 20px; border-radius: 8px; z-index: 10002; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-weight: 600;';
                document.body.appendChild(successMsg);
                setTimeout(() => {
                    successMsg.style.transition = 'opacity 0.3s';
                    successMsg.style.opacity = '0';
                    setTimeout(() => successMsg.remove(), 300);
                }, 3000);
            }
            
            function stopScanner() {
                console.log('Stopping scanner...');
                scannerActive = false;
                scanning = false;
                
                // Stop scanning loop
                if (scanAnimationFrame) {
                    cancelAnimationFrame(scanAnimationFrame);
                    scanAnimationFrame = null;
                }
                
                // Stop html5-qrcode if active
                if (window.html5QrCodeInstance) {
                    window.html5QrCodeInstance.stop().catch(() => {
                        console.log('Scanner already stopped');
                    });
                    window.html5QrCodeInstance = null;
                }
                
                // Stop Quagga if running
                if (typeof Quagga !== 'undefined' && Quagga.initialized) {
                    try {
                        Quagga.stop();
                    } catch (e) {
                        console.log('Error stopping Quagga:', e);
                    }
                }
                
                // Clear bounding box overlay
                const overlayCanvas = document.getElementById('qr-overlay');
                if (overlayCanvas) {
                    const overlayContext = overlayCanvas.getContext('2d');
                    if (overlayContext) {
                        overlayContext.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
                    }
                }
                
                // Hide visual elements
                const boundingBox = document.getElementById('qrBoundingBox');
                if (boundingBox) {
                    boundingBox.classList.remove('active');
                }
                
                const scanningIndicator = document.getElementById('qrScanningIndicator');
                if (scanningIndicator) {
                    scanningIndicator.classList.remove('scanning', 'detected');
                }
                
                const video = document.getElementById('qr-video');
                if (video && video.srcObject) {
                    const tracks = video.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                    video.srcObject = null;
                }
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
                if (scannerModal) {
                    scannerModal.style.display = 'none';
                }
                
                // Clear references
                window.currentScannerInputElement = null;
                currentInputElement = null;
                console.log('Scanner stopped');
            }
            
            function loadQRCodeLibrary() {
                return new Promise((resolve, reject) => {
                    if (typeof Html5Qrcode !== 'undefined') {
                        resolve();
                        return;
                    }
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/html5-qrcode@latest/html5-qrcode.min.js';
                    script.onload = resolve;
                    script.onerror = () => {
                        console.warn('Failed to load QR code library');
                        resolve(); // Resolve anyway to continue
                    };
                    document.head.appendChild(script);
                });
            }

            // Link Dimensi dengan Part Code
            const btnDimensi = document.getElementById('btnDimensi');
            if (btnDimensi) {
                btnDimensi.addEventListener('click', function(e) {
                    // Cari input Part Code dari beberapa kemungkinan id/name
                    const partCodeInputEl =
                        document.getElementById('partCodeInputField') ||
                        document.querySelector('input[name="PartCode"]') ||
                        document.getElementById('PartCode');

                    const partCode = partCodeInputEl ? (partCodeInputEl.value || '').trim() : '';

                    if (!partCode) {
                        e.preventDefault();
                        alert('Masukkan Part Code terlebih dahulu!');
                        return false;
                    }

                    // Link akan membuka halaman Dimensi dengan part code yang sudah ada
                    this.href = '@Url.Action("Input", "Dimensi")?partCode=' + encodeURIComponent(partCode);
                });
            }

            // Andon System Modal
            const btnSCW = document.getElementById('btnSCW');
            const andonModal = document.getElementById('andonModal');

            if (btnSCW && andonModal) {
                btnSCW.addEventListener('click', () => {
                    andonModal.style.display = 'flex';
                });
            }

            // Close modal saat klik overlay
            if (andonModal) {
                andonModal.addEventListener('click', (e) => {
                    if (e.target === andonModal) {
                        andonModal.style.display = 'none';
                    }
                });
            }

            // Fungsi Panggil Leader
            window.panggilLeader = () => {
                const abnormality = document.getElementById('listAbnormality').value;
                if (!abnormality) {
                    alert('Pilih List Abnormality terlebih dahulu!');
                    return;
                }
                // TODO: Implementasi panggil leader
                alert('Panggil Leader untuk: ' + abnormality);
                // Bisa ditambahkan logika untuk mengirim notifikasi ke leader
            };

            // Fungsi Panggil WhatsApp
            window.panggilWhatsApp = () => {
                const abnormality = document.getElementById('listAbnormality').value;
                if (!abnormality) {
                    alert('Pilih List Abnormality terlebih dahulu!');
                    return;
                }
                // Format pesan WhatsApp
                const message = encodeURIComponent(`ANDON SYSTEM\n\nList Abnormality: ${abnormality}\n\nMohon bantuan segera!`);
                // Ganti dengan nomor WhatsApp leader yang sebenarnya
                const phoneNumber = '6281234567890'; // Contoh nomor
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;
                window.open(whatsappUrl, '_blank');
            };
        })();

        // Data Table Modal Functions
        // Data Menu Modal
            // Fix icon position for tablet
            function fixIconPositionForTablet() {
                const btnLihatData = document.getElementById('btnLihatData');
                if (btnLihatData) {
                    if (window.innerWidth >= 768 && window.innerWidth <= 1400) {
                        // Tablet: posisi fixed di kanan bawah, tetap mengikuti saat scroll - cover ALL tablet sizes
                        btnLihatData.style.cssText = 'position: fixed !important; bottom: 15px !important; right: 15px !important; left: auto !important; transform: none !important; z-index: 99999 !important; margin: 0 !important; top: auto !important;';
                        // Pastikan icon tidak terlalu besar
                        const iconElement = btnLihatData.querySelector('i');
                        if (iconElement) {
                            iconElement.style.cssText = 'font-size: 24px !important;';
                        }
                    } else if (window.innerWidth < 768) {
                        // Mobile: di tengah bawah
                        btnLihatData.style.position = 'fixed';
                        btnLihatData.style.bottom = '20px';
                        btnLihatData.style.right = '50%';
                        btnLihatData.style.left = 'auto';
                        btnLihatData.style.transform = 'translateX(50%)';
                    } else {
                        // Desktop: kanan bawah
                        btnLihatData.style.position = 'fixed';
                        btnLihatData.style.bottom = '30px';
                        btnLihatData.style.right = '30px';
                        btnLihatData.style.left = 'auto';
                        btnLihatData.style.transform = 'none';
                    }
                }
            }
            
            // Run on load and resize
            fixIconPositionForTablet();
            window.addEventListener('resize', fixIconPositionForTablet);
            
            const btnLihatData = document.getElementById('btnLihatData');
            const fabSpeedDial = document.getElementById('fabSpeedDial');
            const fabBackdrop = document.getElementById('fabBackdrop');
        const dataTableModal = document.getElementById('dataTableModal');
        const btnCloseDataModal = document.getElementById('btnCloseDataModal');
        const dataModalBody = document.getElementById('dataModalBody');

        // Toggle FAB Speed Dial
        if (btnLihatData && fabSpeedDial) {
            btnLihatData.addEventListener('click', function(e) {
                e.stopPropagation();
                const iconElement = btnLihatData.querySelector('i');
                
                if (!iconElement) {
                    console.error('Icon element not found in btnLihatData');
                    return;
                }
                
                // Toggle active state
                fabSpeedDial.classList.toggle('active');
                
                // Toggle icon
                if (fabSpeedDial.classList.contains('active')) {
                    iconElement.classList.remove('bi-house-door-fill');
                    iconElement.classList.add('bi-arrow-clockwise');
                } else {
                    iconElement.classList.remove('bi-arrow-clockwise');
                    iconElement.classList.add('bi-house-door-fill');
                }
            });
        }
        
        // Close Speed Dial when clicking backdrop
        if (fabBackdrop && fabSpeedDial && btnLihatData) {
            fabBackdrop.addEventListener('click', function() {
                fabSpeedDial.classList.remove('active');
                
                // Reset icon
                const iconElement = btnLihatData.querySelector('i');
                if (iconElement) {
                    iconElement.classList.remove('bi-arrow-clockwise');
                    iconElement.classList.add('bi-house-door-fill');
                }
            });
        }

        // Handle FAB dial item clicks
        document.querySelectorAll('.fab-dial-item').forEach(function(item) {
            item.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                
                // Handle each action
                switch(action) {
                    case 'planning-qc':
                        // Redirect atau buka Planning QC
                        window.location.href = '@Url.Action("List", "QCHose")';
                        break;
                    case 'output-check':
                        // Buka Output Check modal
                        openOutputCheckModal();
                        break;
                    case 'detail-ng':
                        // Buka Detail NG modal
                        openDetailNGModal();
                        break;
                }
                
                // Close speed dial after action
                if (fabSpeedDial) {
                    fabSpeedDial.classList.remove('active');
                    
                    // Reset icon back to home
                    if (btnLihatData) {
                        const iconElement = btnLihatData.querySelector('i');
                        if (iconElement) {
                            iconElement.classList.remove('bi-arrow-clockwise');
                            iconElement.classList.add('bi-house-door-fill');
                        }
                    }
                }
            });
        });

        // Close modal
        if (btnCloseDataModal) {
            btnCloseDataModal.addEventListener('click', function() {
                dataTableModal.style.display = 'none';
            });
        }

        // Close modal saat klik di overlay
        if (dataTableModal) {
            dataTableModal.addEventListener('click', function(e) {
                if (e.target === dataTableModal) {
                    dataTableModal.style.display = 'none';
                }
            });
        }

        // Close modal dengan ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && dataTableModal && dataTableModal.style.display === 'flex') {
                dataTableModal.style.display = 'none';
            }
        });

        // Detail NG Modal Functions
        function openDetailNGModal() {
            const modal = document.getElementById('detailNGModal');
            if (modal) {
                modal.style.display = 'flex';
                loadDetailNGData();
            }
        }

        function loadDetailNGData(selectedDate = null) {
            const loading = document.getElementById('ngLoading');
            const table = document.getElementById('ngTable');
            const noData = document.getElementById('ngNoData');
            const tbody = document.getElementById('ngTableBody');

            // Show loading
            loading.style.display = 'flex';
            table.style.display = 'none';
            noData.style.display = 'none';

            // Build URL with date parameter if provided
            let url = '/QCHose/GetDetailNG';
            if (selectedDate) {
                url += `?date=${selectedDate}`;
            }

            fetch(url)
                .then(response => response.json())
                .then(result => {
                    loading.style.display = 'none';
                    
                    if (result.success && result.data && result.data.length > 0) {
                        tbody.innerHTML = result.data.map(row => `
                            <tr>
                                <td>${row.tanggal}</td>
                                <td>${row.lineChecking}</td>
                                <td>${row.partCode || '-'}</td>
                                <td>${row.jenisNG}</td>
                                <td>${row.namaOPR}</td>
                                <td>${row.qtyNG}</td>
                            </tr>
                        `).join('');
                        table.style.display = 'table';
                    } else {
                        noData.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error loading Detail NG:', error);
                    loading.style.display = 'none';
                    noData.style.display = 'block';
                });
        }

        // Detail NG Date Picker event listeners
        const ngDatePicker = document.getElementById('ngDatePicker');
        const selectedNGDateInfo = document.getElementById('selectedNGDateInfo');
        const btnClearNGDate = document.getElementById('btnClearNGDate');
        
        if (ngDatePicker) {
            ngDatePicker.addEventListener('change', function() {
                const selectedDate = this.value;
                
                if (selectedDate) {
                    // Load data for selected date
                    loadDetailNGData(selectedDate);
                    
                    // Show selected date info
                    if (selectedNGDateInfo) {
                        const dateObj = new Date(selectedDate);
                        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                        selectedNGDateInfo.textContent = `Menampilkan data: ${dateObj.toLocaleDateString('id-ID', options)}`;
                    }
                    
                    // Show clear button
                    if (btnClearNGDate) {
                        btnClearNGDate.style.display = 'block';
                    }
                }
            });
        }
        
        if (btnClearNGDate) {
            btnClearNGDate.addEventListener('click', function() {
                // Clear date picker
                if (ngDatePicker) {
                    ngDatePicker.value = '';
                }
                
                // Clear date info
                if (selectedNGDateInfo) {
                    selectedNGDateInfo.textContent = '';
                }
                
                // Hide clear button
                this.style.display = 'none';
                
                // Reload all data
                loadDetailNGData();
            });
        }

        // Output Check Modal Functions
        function openOutputCheckModal() {
            const modal = document.getElementById('outputCheckModal');
            if (modal) {
                modal.style.display = 'flex';
                // Show stats container immediately
                const statsContainer = document.getElementById('outputCheckStats');
                if (statsContainer) {
                    statsContainer.style.display = 'block';
                }
                loadOutputCheckData('harian'); // Default: hari ini
            }
        }

        // Flag to prevent duplicate calls
        let isLoadingOutputCheck = false;
        
        function loadOutputCheckData(filter, selectedDate = null) {
            // Prevent duplicate calls
            if (isLoadingOutputCheck) {
                console.log('Output check data is already loading, skipping...');
                return;
            }
            
            const loading = document.getElementById('outputLoading');
            const table = document.getElementById('outputTable');
            const noData = document.getElementById('outputNoData');
            const tbody = document.getElementById('outputTableBody');

            if (!loading || !table || !noData || !tbody) {
                console.error('Output check modal elements not found');
                return;
            }

            // Set loading flag
            isLoadingOutputCheck = true;

            // Show loading
            loading.style.display = 'flex';
            table.style.display = 'none';
            noData.style.display = 'none';
            
            // Clear existing data first
            tbody.innerHTML = '';

            // Build URL with parameters
            let url = '/QCHose/GetOutputCheck?';
            if (selectedDate) {
                url += `date=${selectedDate}`;
            } else {
                url += `filter=${filter || 'harian'}`;
            }

            fetch(url)
                .then(response => response.json())
                .then(result => {
                    loading.style.display = 'none';
                    isLoadingOutputCheck = false;
                    
                    // Update statistics cards - always show stats
                    const statsContainer = document.getElementById('outputCheckStats');
                    if (statsContainer) {
                        if (result.statistics) {
                            const totalQtyCheck = result.statistics.totalQtyCheck || 0;
                            const totalNG = result.statistics.totalNG || 0;
                            const totalRR = result.statistics.totalRRPercent || 0;
                            
                            // Update text content
                            document.getElementById('statTotalQtyCheck').textContent = totalQtyCheck;
                            document.getElementById('statTotalNG').textContent = totalNG;
                            document.getElementById('statTotalRR').textContent = totalRR + '%';
                            
                            // Update progress bars
                            // For QTY CHECK: use 100 as maximum (full at 100)
                            const qtyCheckPercent = Math.min((totalQtyCheck / 100) * 100, 100);
                            document.getElementById('progressQtyCheck').style.width = qtyCheckPercent + '%';
                            
                            // For NG: use 100 as maximum (full at 100)
                            const ngPercent = Math.min((totalNG / 100) * 100, 100);
                            document.getElementById('progressNG').style.width = ngPercent + '%';
                        } else {
                            // Default to 0 if no statistics
                            document.getElementById('statTotalQtyCheck').textContent = 0;
                            document.getElementById('statTotalNG').textContent = 0;
                            document.getElementById('statTotalRR').textContent = '0%';
                            document.getElementById('progressQtyCheck').style.width = '0%';
                            document.getElementById('progressNG').style.width = '0%';
                        }
                        statsContainer.style.display = 'block';
                    }
                    
                    if (result.success && result.data && result.data.length > 0) {
                        // Clear tbody before adding new data
                        tbody.innerHTML = '';
                        
                        // Use Set to remove duplicates based on unique identifier
                        const uniqueData = [];
                        const seenKeys = new Set();
                        
                        result.data.forEach(row => {
                            // Create unique key from row data
                            const key = `${row.tanggalInput}_${row.lineChecking}_${row.groupChecking}_${row.namaInspector}_${row.partCode}_${row.qtyCheck}`;
                            
                            if (!seenKeys.has(key)) {
                                seenKeys.add(key);
                                uniqueData.push(row);
                            }
                        });
                        
                        // Render only unique data
                        tbody.innerHTML = uniqueData.map(row => `
                            <tr>
                                <td style="white-space:nowrap; min-width:200px; width:200px;">${row.tanggalInput}</td>
                                <td style="white-space:nowrap; min-width:90px; width:90px; text-align:center;">${row.lineChecking}</td>
                                <td style="white-space:nowrap; min-width:80px; width:80px; text-align:center;">${row.groupChecking || '-'}</td>
                                <td style="white-space:nowrap; min-width:180px; width:180px;">${row.namaInspector}</td>
                                <td style="white-space:nowrap; min-width:160px; width:160px;">${row.partCode}</td>
                                <td style="white-space:nowrap; min-width:100px; width:100px; text-align:center;">${row.qtyCheck}</td>
                                <td style="white-space:nowrap; min-width:150px; width:150px; text-align:center;">${row.lineStop || '-'}</td>
                            </tr>
                        `).join('');
                        table.style.display = 'table';
                    } else {
                        noData.style.display = 'block';
                        // Stats cards remain visible even if no data (showing 0)
                    }
                })
                .catch(error => {
                    console.error('Error loading Output Check:', error);
                    loading.style.display = 'none';
                    noData.style.display = 'block';
                    isLoadingOutputCheck = false;
                });
        }

        // Close Detail NG Modal
        const btnCloseNGModal = document.getElementById('btnCloseNGModal');
        const detailNGModal = document.getElementById('detailNGModal');
        
        if (btnCloseNGModal) {
            btnCloseNGModal.addEventListener('click', function() {
                detailNGModal.style.display = 'none';
            });
        }

        if (detailNGModal) {
            detailNGModal.addEventListener('click', function(e) {
                if (e.target === detailNGModal) {
                    detailNGModal.style.display = 'none';
                }
            });
        }

        // Close Output Check Modal
        const btnCloseOutputModal = document.getElementById('btnCloseOutputModal');
        const outputCheckModal = document.getElementById('outputCheckModal');
        
        if (btnCloseOutputModal) {
            btnCloseOutputModal.addEventListener('click', function() {
                outputCheckModal.style.display = 'none';
            });
        }

        if (outputCheckModal) {
            outputCheckModal.addEventListener('click', function(e) {
                if (e.target === outputCheckModal) {
                    outputCheckModal.style.display = 'none';
                }
            });
        }

        // Filter button handlers - use event delegation to prevent duplicate listeners
        // outputCheckModal already declared above, reuse it
        if (outputCheckModal) {
            // Remove any existing listeners first
            const filterBtnHandler = function(e) {
                const filterBtn = e.target.closest('.filter-btn');
                if (filterBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Remove active from all
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    // Add active to clicked
                    filterBtn.classList.add('active');
                    
                    // Clear date picker when filter clicked
                    const datePicker = document.getElementById('outputDatePicker');
                    const dateInfo = document.getElementById('selectedDateInfo');
                    if (datePicker) {
                        datePicker.value = '';
                    }
                    if (dateInfo) {
                        dateInfo.textContent = '';
                    }
                    
                    // Load data with selected filter
                    const filter = filterBtn.getAttribute('data-filter');
                    loadOutputCheckData(filter);
                }
            };
            
            // Use event delegation - only one listener on modal
            outputCheckModal.addEventListener('click', filterBtnHandler);
        }

        // Date Picker event listener
        const outputDatePicker = document.getElementById('outputDatePicker');
        const selectedDateInfo = document.getElementById('selectedDateInfo');
        
        if (outputDatePicker) {
            outputDatePicker.addEventListener('change', function() {
                const selectedDate = this.value;
                
                if (selectedDate) {
                    // Remove active from all filter buttons
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    
                    // Load data for selected date
                    loadOutputCheckData(null, selectedDate);
                    
                    // Show selected date info
                    if (selectedDateInfo) {
                        const dateObj = new Date(selectedDate);
                        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                        selectedDateInfo.textContent = `Menampilkan data: ${dateObj.toLocaleDateString('id-ID', options)}`;
                    }
                }
            });
        }

        // UPDATE NG Button Handler - AJAX Save to Database
        const btnUpdateNG = document.getElementById('btnUpdateNG');
        const ngUpdateMessage = document.getElementById('ngUpdateMessage');
        
        if (btnUpdateNG) {
            btnUpdateNG.addEventListener('click', async function(e) {
                e.preventDefault();
                
                // Get form values
                const jenisNG = document.querySelector('select[name="JenisNG"]');
                const namaOPR = document.querySelector('input[name="NamaOPR"]');
                const qtyNG = document.querySelector('input[name="QtyNG"]');
                const partCode = document.getElementById('partCodeInputField');
                const lineChecking = document.getElementById('LineChecking');
                const groupChecking = document.querySelector('input[name="GroupChecking"]:checked');
                
                // Validasi input
                if (!jenisNG || !jenisNG.value || jenisNG.value === '') {
                    if (ngUpdateMessage) {
                        ngUpdateMessage.style.display = 'block';
                        ngUpdateMessage.style.background = '#fee2e2';
                        ngUpdateMessage.style.color = '#991b1b';
                        ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> Pilih Jenis NG terlebih dahulu';
                        
                        setTimeout(() => {
                            ngUpdateMessage.style.display = 'none';
                        }, 3000);
                    }
                    return;
                }
                
                if (!qtyNG || qtyNG.value === '' || parseInt(qtyNG.value) <= 0) {
                    if (ngUpdateMessage) {
                        ngUpdateMessage.style.display = 'block';
                        ngUpdateMessage.style.background = '#fee2e2';
                        ngUpdateMessage.style.color = '#991b1b';
                        ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> Masukkan QTY NG yang valid';
                        
                        setTimeout(() => {
                            ngUpdateMessage.style.display = 'none';
                        }, 3000);
                    }
                    return;
                }

                if (!partCode || !partCode.value) {
                    if (ngUpdateMessage) {
                        ngUpdateMessage.style.display = 'block';
                        ngUpdateMessage.style.background = '#fee2e2';
                        ngUpdateMessage.style.color = '#991b1b';
                        ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> Part Code harus diisi terlebih dahulu';
                        
                        setTimeout(() => {
                            ngUpdateMessage.style.display = 'none';
                        }, 3000);
                    }
                    return;
                }

                if (!lineChecking || !lineChecking.value) {
                    if (ngUpdateMessage) {
                        ngUpdateMessage.style.display = 'block';
                        ngUpdateMessage.style.background = '#fee2e2';
                        ngUpdateMessage.style.color = '#991b1b';
                        ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> Line Checking harus dipilih terlebih dahulu';
                        
                        setTimeout(() => {
                            ngUpdateMessage.style.display = 'none';
                        }, 3000);
                    }
                    return;
                }
                
                // Prepare data
                const ngData = {
                    jenisNG: jenisNG.value,
                    namaOPR: namaOPR.value || '',
                    qtyNG: parseInt(qtyNG.value),
                    partCode: partCode.value,
                    lineChecking: lineChecking.value,
                    groupChecking: groupChecking ? groupChecking.value : 'A'
                };
                
                // Show loading
                if (ngUpdateMessage) {
                    ngUpdateMessage.style.display = 'block';
                    ngUpdateMessage.style.background = '#dbeafe';
                    ngUpdateMessage.style.color = '#1e40af';
                    ngUpdateMessage.innerHTML = '<i class="bi bi-hourglass-split"></i> Menyimpan data...';
                }
                
                try {
                    // Send AJAX POST to SaveNG API
                    const response = await fetch('/QCHose/SaveNG', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(ngData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Show success message
                        if (ngUpdateMessage) {
                            ngUpdateMessage.style.display = 'block';
                            ngUpdateMessage.style.background = '#d1fae5';
                            ngUpdateMessage.style.color = '#065f46';
                            ngUpdateMessage.innerHTML = `
                                <i class="bi bi-check-circle"></i> 
                                ${result.message} 
                                <span style="font-size: 11px; display: block; margin-top: 4px;">
                                    (${result.data.jenisNG} / ${result.data.qtyNG} pcs)
                                </span>
                            `;
                            
                            setTimeout(() => {
                                ngUpdateMessage.style.display = 'none';
                            }, 5000);
                        }
                        
                        // Clear NG fields for next entry
                        jenisNG.value = '';
                        namaOPR.value = '';
                        qtyNG.value = '';
                        
                        // Reload Detail NG table if modal is open
                        const modalDetailNG = document.getElementById('detailNGModal');
                        if (modalDetailNG && modalDetailNG.style.display !== 'none') {
                            loadDetailNGData();
                        }
                    } else {
                        // Show error message
                        if (ngUpdateMessage) {
                            ngUpdateMessage.style.display = 'block';
                            ngUpdateMessage.style.background = '#fee2e2';
                            ngUpdateMessage.style.color = '#991b1b';
                            ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> ' + result.message;
                            
                            setTimeout(() => {
                                ngUpdateMessage.style.display = 'none';
                            }, 3000);
                        }
                    }
                } catch (error) {
                    // Show error message
                    if (ngUpdateMessage) {
                        ngUpdateMessage.style.display = 'block';
                        ngUpdateMessage.style.background = '#fee2e2';
                        ngUpdateMessage.style.color = '#991b1b';
                        ngUpdateMessage.innerHTML = '<i class="bi bi-x-circle"></i> Terjadi kesalahan: ' + error.message;
                        
                        setTimeout(() => {
                            ngUpdateMessage.style.display = 'none';
                        }, 3000);
                    }
                }
            });
        }

        // Function to load data table
        function loadDataTable() {
            dataModalBody.innerHTML = `
                <div class="data-loading">
                    <i class="bi bi-arrow-repeat" style="animation: spin 1s linear infinite; font-size: 24px;"></i>
                    <span>Memuat data...</span>
                </div>
            `;

            fetch('@Url.Action("GetDataJson", "QCHose")?limit=100')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data && result.data.length > 0) {
                        renderDataTable(result.data);
                    } else {
                        dataModalBody.innerHTML = `
                            <div class="data-empty">
                                <i class="bi bi-inbox"></i>
                                <h3>Belum Ada Data</h3>
                                <p>Data E_LWP masih kosong. Silakan input data terlebih dahulu.</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    dataModalBody.innerHTML = `
                        <div class="data-empty">
                            <i class="bi bi-exclamation-triangle"></i>
                            <h3>Error</h3>
                            <p>Gagal memuat data. Silakan coba lagi.</p>
                        </div>
                    `;
                });
        }

        // Function to render data table
        function renderDataTable(data) {
            const tableHTML = `
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Line</th>
                                <th>Inspector</th>
                                <th>Group</th>
                                <th>Part Code</th>
                                <th>Time Stop</th>
                                <th>Qty Check</th>
                                <th>Jenis NG</th>
                                <th>Qty NG</th>
                                <th>Line Stop</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.map(item => `
                                <tr>
                                    <td>${item.tanggalInput}</td>
                                    <td>${item.lineChecking}</td>
                                    <td>${item.namaInspector}</td>
                                    <td>${item.groupChecking}</td>
                                    <td>${item.partCode}</td>
                                    <td>${item.timeStop}</td>
                                    <td>${item.qtyCheck}</td>
                                    <td>${item.jenisNG}</td>
                                    <td>${item.qtyNG}</td>
                                    <td>${item.lineStop}</td>
                                    <td>
                                        <span class="badge-status ${getStatusClass(item.statusChecking)}">
                                            ${item.statusChecking}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 16px; text-align: center; color: #6b7280; font-size: 12px;">
                    Menampilkan ${data.length} data terbaru
                </div>
            `;
            
            dataModalBody.innerHTML = tableHTML;
        }

        // Function to get status class
        function getStatusClass(status) {
            if (status === 'Checking') return 'badge-checking';
            if (status === 'Done') return 'badge-done';
            if (status === 'Stop') return 'badge-stop';
            return '';
        }
    </script>

    <style>
        .badge-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-checking {
            background: #dcfce7;
            color: #15803d;
        }
        .badge-done {
            background: #dbeafe;
            color: #1e40af;
        }
        .badge-stop {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
    
    <!-- FORCE STYLE UNTUK TABLET - HARUS DILOAD TERAKHIR -->
    <style>
        /* FORCE OVERRIDE UNTUK TABLET - Range lebih luas untuk memastikan terdeteksi */
        @@media (min-width: 600px) {
            /* Force override semua container */
            body.desktop-view .main-content,
            body.desktop-view .main-content .content-area {
                padding: 0 !important;
                margin: 0 !important;
                max-width: 100% !important;
                width: 100% !important;
            }
            
            /* Force override qchose-page */
            .qchose-page {
                max-width: 100% !important;
                width: 100% !important;
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 16px 0 100px 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
            }
            
            /* Force override form */
            .qchose-page form {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 8px !important;
            }
            
            /* Pastikan parent container tidak mempengaruhi fixed */
            body.desktop-view .main-content,
            body.desktop-view .main-content .content-area,
            .qchose-page {
                transform: none !important;
                perspective: none !important;
                filter: none !important;
                will-change: auto !important;
            }
            
            /* Force override tombol home - posisi lebih aman agar tidak terpotong - PRESERVE PURPLE STYLE */
            body #btnLihatData,
            body .data-menu-icon-btn-fixed,
            #btnLihatData,
            .data-menu-icon-btn-fixed {
                position: fixed !important;
                bottom: 30px !important;
                right: 30px !important;
                left: auto !important;
                z-index: 9999 !important;
                transform: none !important;
                margin: 0 !important;
                top: auto !important;
                will-change: transform !important;
                background: #8b5cf6 !important;
                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;
            }
            
            /* Pastikan tombol tidak terpengaruh parent container - CRITICAL untuk fixed */
            body.desktop-view #btnLihatData,
            body.desktop-view .data-menu-icon-btn-fixed {
                position: fixed !important;
                background: #8b5cf6 !important;
            }
            
            /* Pastikan inner button tidak overflow - TIDAK PERLU LAGI */
        
        }
    </style>

    <script>
        // FORCE APPLY STYLE - Fungsi untuk apply style tablet
        function applyTabletStyles() {
            const width = window.innerWidth;
            // Apply untuk tablet (768px-1024px) - TIDAK untuk desktop
            if (width >= 768 && width <= 1024) {
                console.log('Applying tablet styles for width:', width);
                
                // Force style untuk container dengan ID yang lebih spesifik
                const mainContent = document.querySelector('.main-content');
                const contentArea = document.querySelector('.content-area');
                const qchosePage = document.getElementById('qchosePageContainer') || document.querySelector('.qchose-page');
                const form = document.getElementById('qchoseForm') || document.querySelector('.qchose-page form');
                const btnHome = document.getElementById('btnLihatData');
                
                // Apply dengan setAttribute untuk memaksa override
                if (mainContent) {
                    mainContent.setAttribute('style', 'margin-left: 0 !important; width: 100% !important; padding: 0 !important; max-width: 100% !important;');
                }
                if (contentArea) {
                    contentArea.setAttribute('style', 'padding: 0 !important; margin: 0 !important; max-width: 100% !important; width: 100% !important; box-sizing: border-box !important;');
                }
                if (qchosePage) {
                    qchosePage.setAttribute('style', 'max-width: 100% !important; width: 100% !important; margin: 0 !important; margin-left: 0 !important; margin-right: 0 !important; padding: 16px 0 100px 0 !important; padding-left: 0 !important; padding-right: 0 !important; box-sizing: border-box !important;');
                }
                if (form) {
                    form.setAttribute('style', 'width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 0 8px !important; box-sizing: border-box !important;');
                }
                if (btnHome) {
                    // Pastikan tombol fixed dan tidak terpotong - PRESERVE PURPLE BACKGROUND
                    btnHome.setAttribute('style', 'position: fixed !important; bottom: 30px !important; right: 30px !important; left: auto !important; z-index: 9999 !important; transform: none !important; margin: 0 !important; top: auto !important; width: auto !important; height: auto !important; background: #8b5cf6 !important; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;');
                }
                
                console.log('Tablet styles applied!');
            } else if (width > 1024) {
                // Desktop - HAPUS semua inline style agar CSS desktop bekerja
                console.log('Removing inline styles for desktop, width:', width);
                const mainContent = document.querySelector('.main-content');
                const contentArea = document.querySelector('.content-area');
                const qchosePage = document.getElementById('qchosePageContainer') || document.querySelector('.qchose-page');
                const form = document.getElementById('qchoseForm') || document.querySelector('.qchose-page form');
                
                // Hapus inline style agar CSS desktop.css bekerja normal
                if (mainContent && mainContent.hasAttribute('style')) {
                    mainContent.removeAttribute('style');
                }
                if (contentArea && contentArea.hasAttribute('style')) {
                    contentArea.removeAttribute('style');
                }
                if (qchosePage && qchosePage.hasAttribute('style')) {
                    qchosePage.removeAttribute('style');
                }
                if (form && form.hasAttribute('style')) {
                    form.removeAttribute('style');
                }
                
                // Pastikan tombol kembali ke posisi normal desktop
                const btnHome = document.getElementById('btnLihatData');
                if (btnHome && btnHome.parentElement === document.body) {
                    // Kembalikan ke posisi asli jika dipindahkan
                    const originalContainer = document.querySelector('.qchose-page');
                    if (originalContainer) {
                        originalContainer.appendChild(btnHome);
                    }
                }
            }
        }
        
        // Apply saat DOM ready - HANYA untuk tablet
        function initTabletStyles() {
            const width = window.innerWidth;
            if (width >= 768 && width <= 1024) {
                // Hanya apply untuk tablet
                applyTabletStyles();
            } else if (width > 1024) {
                // Desktop - pastikan tidak ada inline style
                applyTabletStyles(); // Ini akan remove inline style
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTabletStyles);
        } else {
            initTabletStyles();
        }
        
        // Apply saat resize - dengan check
        window.addEventListener('resize', function() {
            const width = window.innerWidth;
            if (width >= 768 && width <= 1024) {
                applyTabletStyles();
            } else if (width > 1024) {
                // Desktop - remove inline style
                applyTabletStyles();
            }
        });
        
        // Apply lagi setelah delay - HANYA untuk tablet
        setTimeout(function() {
            if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                applyTabletStyles();
            }
        }, 100);
        setTimeout(function() {
            if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                applyTabletStyles();
            }
        }, 500);
        
        // Memindahkan tombol ke body level untuk memastikan fixed bekerja - HANYA TABLET
        function moveButtonToBody() {
            const btnHome = document.getElementById('btnLihatData');
            if (btnHome && window.innerWidth >= 768 && window.innerWidth <= 1024) {
                // Cek apakah tombol masih di dalam qchose-page
                const qchosePage = document.querySelector('.qchose-page');
                if (qchosePage && qchosePage.contains(btnHome)) {
                    // Pindahkan ke body
                    document.body.appendChild(btnHome);
                    console.log('Button moved to body');
                }
                
                // Force tetap fixed - PRESERVE PURPLE BACKGROUND
                btnHome.style.cssText = 'position: fixed !important; bottom: 30px !important; right: 30px !important; left: auto !important; z-index: 9999 !important; transform: none !important; margin: 0 !important; top: auto !important; background: #8b5cf6 !important; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;';
            }
        }
        
        // Pindahkan tombol saat load
        moveButtonToBody();
        setTimeout(moveButtonToBody, 100);
        setTimeout(moveButtonToBody, 500);
        
        // Pastikan tombol tetap fixed saat scroll - dengan MutationObserver
        const btnHome = document.getElementById('btnLihatData');
        if (btnHome) {
            // MutationObserver untuk memastikan style tetap fixed - HANYA TABLET
            const observer = new MutationObserver(function(mutations) {
                if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                    btnHome.style.position = 'fixed';
                    btnHome.style.bottom = '30px';
                    btnHome.style.right = '30px';
                    btnHome.style.zIndex = '9999';
                    btnHome.style.left = 'auto';
                    btnHome.style.transform = 'none';
                    btnHome.style.background = '#8b5cf6';
                    btnHome.style.boxShadow = '0 4px 12px rgba(139, 92, 246, 0.3)';
                }
            });
            
            observer.observe(btnHome, {
                attributes: true,
                attributeFilter: ['style', 'class'],
                subtree: false
            });
            
            // Event listener untuk scroll - force apply style - HANYA TABLET
            let rafId = null;
            function forceFixedLoop() {
                if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                    // Pastikan di body
                    if (btnHome.parentElement !== document.body) {
                        document.body.appendChild(btnHome);
                    }
                    
                    // Force semua style dengan cssText - PRESERVE PURPLE BACKGROUND
                    btnHome.setAttribute('style', 'position: fixed !important; bottom: 30px !important; right: 30px !important; left: auto !important; z-index: 9999 !important; transform: none !important; margin: 0 !important; top: auto !important; background: #8b5cf6 !important; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;');
                }
                
                // Lanjutkan loop
                rafId = requestAnimationFrame(forceFixedLoop);
            }
            
            // Mulai loop
            rafId = requestAnimationFrame(forceFixedLoop);
            
            // Backup scroll listener
            window.addEventListener('scroll', function() {
                if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                    moveButtonToBody();
                }
            }, { passive: true });
            
            // Stop loop jika bukan tablet
            window.addEventListener('resize', function() {
                if (window.innerWidth < 768 || window.innerWidth > 1024) {
                    if (rafId) {
                        cancelAnimationFrame(rafId);
                        rafId = null;
                    }
                }
            });
            
            // Event listener untuk resize - HANYA TABLET
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768 && window.innerWidth <= 1024) {
                    moveButtonToBody();
                    // Force apply style lagi - PRESERVE PURPLE BACKGROUND
                    btnHome.style.cssText = 'position: fixed !important; bottom: 30px !important; right: 30px !important; left: auto !important; z-index: 9999 !important; transform: none !important; margin: 0 !important; top: auto !important; background: #8b5cf6 !important; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;';
                } else {
                    // Bukan tablet, kembalikan ke posisi normal
                    if (btnHome.parentElement === document.body) {
                        // Cari posisi asli atau biarkan di body
                        const originalContainer = document.querySelector('.qchose-page');
                        if (originalContainer && !originalContainer.contains(btnHome)) {
                            originalContainer.appendChild(btnHome);
                        }
                    }
                }
            });
        }
        
        // Reset form dan scroll ke atas setelah submit berhasil
        document.addEventListener('DOMContentLoaded', function() {
            // Close Line Stop Warning Modal
            const closeLineStopWarning = document.getElementById('closeLineStopWarning');
            const lineStopWarningModal = document.getElementById('lineStopWarningModal');
            if (closeLineStopWarning && lineStopWarningModal) {
                closeLineStopWarning.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    lineStopWarningModal.style.display = 'none';
                });
                
                // Close modal saat klik di luar
                lineStopWarningModal.addEventListener('click', function(e) {
                    if (e.target === lineStopWarningModal) {
                        lineStopWarningModal.style.display = 'none';
                    }
                });
            }

            const successAlert = document.getElementById('successAlert');
            const formSubmitted = '@TempData["FormSubmitted"]';
            
            if (formSubmitted === 'True' || successAlert) {
                // Scroll ke atas untuk melihat success message
                setTimeout(function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
                
                // Reset form
                const form = document.querySelector('form');
                if (form) {
                    // PRESERVE: Save values before reset
                    const lineCheckingEl = document.getElementById('LineChecking');
                    const namaInspectorEl = document.getElementById('NamaInspector') || 
                                           document.querySelector('input[name="NamaInspector"]') ||
                                           document.querySelector('input[asp-for="NamaInspector"]');
                    const grupCheckingA = document.querySelector('input[name="GroupChecking"][value="A"]');
                    const grupCheckingB = document.querySelector('input[name="GroupChecking"][value="B"]');
                    
                    const preservedLineChecking = lineCheckingEl ? lineCheckingEl.value : '';
                    const preservedNamaInspector = namaInspectorEl ? namaInspectorEl.value : '';
                    const preservedGrupChecking = grupCheckingA?.checked ? 'A' : (grupCheckingB?.checked ? 'B' : 'A');
                    
                    // Reset semua input fields
                    form.reset();
                    
                    // RESTORE: Kembalikan nilai yang harus di-preserve
                    if (lineCheckingEl && preservedLineChecking) {
                        lineCheckingEl.value = preservedLineChecking;
                    }
                    if (namaInspectorEl && preservedNamaInspector) {
                        namaInspectorEl.value = preservedNamaInspector;
                    }
                    // Restore grup checking
                    if (preservedGrupChecking === 'A' && grupCheckingA) {
                        grupCheckingA.checked = true;
                    } else if (preservedGrupChecking === 'B' && grupCheckingB) {
                        grupCheckingB.checked = true;
                    }
                    
                    // CLEAR: Explicitly clear fields that should be empty
                    const partCodeInput = document.getElementById('partCodeInputField') || 
                                        document.getElementById('PartCode') ||
                                        document.querySelector('input[name="PartCode"]');
                    const qtyCheckInput = document.getElementById('QtyCheck');
                    
                    if (partCodeInput) partCodeInput.value = '';
                    if (qtyCheckInput) qtyCheckInput.value = '';
                    
                    // Reset timer displays
                    const timeStopEl = document.getElementById('qcHoseTimeStop');
                    const lineStopTimeEl = document.getElementById('qcHoseLineStopTime');
                    if (timeStopEl) {
                        timeStopEl.textContent = '0:0:0';
                        // Stop timer jika sedang berjalan (dari closure timer di script sebelumnya)
                        if (window.timeStopInterval) {
                            clearInterval(window.timeStopInterval);
                            window.timeStopInterval = null;
                        }
                        if (window.timeStopSeconds !== undefined) {
                            window.timeStopSeconds = 0;
                        }
                    }
                    if (lineStopTimeEl) {
                        lineStopTimeEl.textContent = '0:0:0:0';
                    }
                    
                    // Reset checkbox Line Stop
                    const lineStopCheckbox = document.querySelector('input[name="IsLineStop"]');
                    if (lineStopCheckbox) lineStopCheckbox.checked = false;
                    
                    // Reset hidden status fields
                    const statusChecking = document.querySelector('input[name="StatusChecking"]');
                    const statusCheckingTime = document.getElementById('lineStopDurationValue');
                    if (statusChecking) statusChecking.value = 'Checking';
                    if (statusCheckingTime) statusCheckingTime.value = '0:0:0:0';
                    
                    // Reset Part Code suggestions
                    const partCodeSuggestions = document.getElementById('partCodeSuggestions');
                    if (partCodeSuggestions) partCodeSuggestions.style.display = 'none';
                }
                
                // Auto-hide success message setelah 5 detik
                if (successAlert) {
                    setTimeout(function() {
                        successAlert.style.transition = 'opacity 0.5s ease-out';
                        successAlert.style.opacity = '0';
                        setTimeout(function() {
                            successAlert.style.display = 'none';
                        }, 500);
                    }, 5000);
                }
                
                // Jika modal data sedang terbuka, refresh datanya
                const dataTableModal = document.getElementById('dataTableModal');
                if (dataTableModal && dataTableModal.style.display === 'flex') {
                    setTimeout(function() {
                        if (typeof loadDataTable === 'function') {
                            loadDataTable();
                        }
                    }, 500);
                }
            }
        });
    </script>
}

