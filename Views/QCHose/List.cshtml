@model List<AplikasiCheckDimensi.Models.QCHoseData>
@{
    ViewData["Title"] = "Data E_LWP";
    Layout = "_LayoutDesktop";
}

<style>
    body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        background-attachment: fixed;
        min-height: 100vh;
        position: relative;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
    }

    /* Override content-area padding untuk menghilangkan jarak kiri-kanan */
    .content-area {
        padding: 30px 0 !important;
        position: relative;
        z-index: 1;
    }

    .data-table-container {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98));
        backdrop-filter: blur(20px) saturate(180%);
        border-radius: 20px;
        box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.4),
            0 0 40px rgba(59, 130, 246, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        padding: 32px;
        margin: 24px 0;
        max-width: 100%;
        width: 100%;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .data-table-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 32px;
        flex-wrap: wrap;
        gap: 20px;
        padding-bottom: 24px;
        border-bottom: 2px solid rgba(148, 163, 184, 0.2);
    }

    .table-header-left {
        flex: 1;
    }

    .table-title {
        font-size: 28px;
        font-weight: 800;
        background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 50%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
        letter-spacing: -0.5px;
        filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));
        text-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }

    .table-title i {
        color: #3b82f6;
        font-size: 32px;
        filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
    }

    .table-subtitle {
        font-size: 14px;
        color: #94a3b8;
        font-weight: 500;
        margin-top: 4px;
    }

    .table-subtitle strong {
        color: #60a5fa;
        font-weight: 700;
        text-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
    }

    .table-header-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .btn-add-new {
        padding: 12px 24px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 
            0 4px 12px rgba(59, 130, 246, 0.3),
            0 0 20px rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-add-new:hover {
        transform: translateY(-2px);
        box-shadow: 
            0 6px 20px rgba(59, 130, 246, 0.5),
            0 0 30px rgba(59, 130, 246, 0.2);
        color: white;
    }

    .btn-add-new:active {
        transform: translateY(0);
    }

    .btn-add-new i {
        font-size: 16px;
    }

    /* Statistics Cards */
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        margin-bottom: 32px;
        position: relative;
    }

    /* Serbuk putih halus di area stats */
    .stats-cards::after {
        content: "";
        position: absolute;
        inset: -8px;
        pointer-events: none;
        background-image:
            radial-gradient(1px 1px at 20% 30%, rgba(255, 255, 255, 0.55), transparent 55%),
            radial-gradient(1.2px 1.2px at 70% 40%, rgba(255, 255, 255, 0.45), transparent 55%),
            radial-gradient(0.8px 0.8px at 40% 70%, rgba(255, 255, 255, 0.35), transparent 55%),
            radial-gradient(1.5px 1.5px at 85% 85%, rgba(255, 255, 255, 0.35), transparent 55%);
        opacity: 0.6;
    }

    .stat-card {
        position: relative;
        overflow: hidden;
        border-radius: 24px;
        padding: 26px 26px 20px 26px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
        backdrop-filter: blur(20px) saturate(180%);
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 20px rgba(59, 130, 246, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #f1f5f9;
    }
    
    .stat-card::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image:
            radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.15) 0, transparent 60%),
            radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0, transparent 60%);
        opacity: 1;
        pointer-events: none;
    }
    
    /* Hover: sedikit naik dengan glow effect */
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow:
            0 14px 40px rgba(0, 0, 0, 0.4),
            0 0 30px rgba(59, 130, 246, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        border-color: rgba(59, 130, 246, 0.4);
    }

    /* Variasi gradien modern per kartu dengan dark theme */
    .stat-card.blue {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(29, 78, 216, 0.95));
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(59, 130, 246, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        color: #e0f2fe;
    }
    
    .stat-card.green {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.95));
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(34, 197, 94, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        color: #dcfce7;
    }
    
    .stat-card.red {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(185, 28, 28, 0.95));
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(239, 68, 68, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        color: #fee2e2;
    }
    
    .stat-card.grey {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(148, 163, 184, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        color: #e2e8f0;
    }

    .stat-card-header {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        margin-bottom: 6px;
    }

    .stat-card-title {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        opacity: 0.95;
        margin-top: 0;
        color: rgba(255, 255, 255, 0.95);
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* Baris utama angka + ikon di kanan */
    .stat-card-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 14px;
        margin-bottom: 12px;
    }

    .stat-card-icon {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        background: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(10px);
        box-shadow:
            0 0 0 1px rgba(255, 255, 255, 0.1),
            0 4px 12px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .stat-card-value {
        font-size: 34px;
        font-weight: 800;
        margin-bottom: 0;
        line-height: 1;
    }

    .stat-card-footer {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        opacity: 0.95;
    }

    .stat-card-progress {
        flex: 1;
        height: 6px;
        background: rgba(15, 23, 42, 0.4);
        border-radius: 999px;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .stat-card-progress-bar {
        height: 100%;
        border-radius: 3px;
        transition: width 0.8s ease;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    .stat-card.blue .stat-card-progress-bar {
        background: linear-gradient(90deg, #60a5fa, #93c5fd);
        box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
    }

    .stat-card.green .stat-card-progress-bar {
        background: linear-gradient(90deg, #4ade80, #86efac);
        box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
    }

    .stat-card.red .stat-card-progress-bar {
        background: linear-gradient(90deg, #f87171, #fca5a5);
        box-shadow: 0 0 10px rgba(248, 113, 113, 0.5);
    }

    .stat-card-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .stat-card-list-item {
        padding: 8px 0;
        font-size: 13px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        opacity: 0.95;
        color: rgba(255, 255, 255, 0.9);
    }

    .stat-card-list-item:last-child {
        border-bottom: none;
    }

    .stat-card-list-item strong {
        font-weight: 600;
        color: rgba(255, 255, 255, 1);
    }

    /* Simplified Filter Section */
    .filter-section {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
        backdrop-filter: blur(20px) saturate(180%);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        box-shadow: 
            0 4px 16px rgba(0, 0, 0, 0.2),
            0 0 20px rgba(59, 130, 246, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .filter-row {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-search {
        flex: 1;
        min-width: 200px;
        position: relative;
    }

    .filter-search i {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        font-size: 16px;
    }

    .filter-search input {
        width: 100%;
        padding: 12px 16px 12px 42px;
        border: 2px solid rgba(148, 163, 184, 0.2);
        border-radius: 10px;
        font-size: 14px;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #f1f5f9;
    }

    .filter-search input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 
            0 0 0 3px rgba(59, 130, 246, 0.2),
            0 0 20px rgba(59, 130, 246, 0.3);
        background: rgba(15, 23, 42, 0.8);
    }

    .filter-search input::placeholder {
        color: #64748b;
    }

    .filter-select-compact {
        min-width: 150px;
        padding: 12px 16px;
        border: 2px solid rgba(148, 163, 184, 0.2);
        border-radius: 10px;
        font-size: 14px;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #f1f5f9;
        cursor: pointer;
    }

    .filter-select-compact:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 
            0 0 0 3px rgba(59, 130, 246, 0.2),
            0 0 20px rgba(59, 130, 246, 0.3);
        background: rgba(15, 23, 42, 0.8);
    }

    .filter-select-compact option {
        background: #1e293b;
        color: #f1f5f9;
    }

    .filter-advanced-link {
        margin-top: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: #60a5fa;
        cursor: pointer;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
    }

    .filter-advanced-link:hover {
        color: #3b82f6;
        text-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
    }

    .filter-advanced-section {
        display: none;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(148, 163, 184, 0.2);
    }

    .filter-advanced-section.show {
        display: block;
    }

    .filter-advanced-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .filter-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .filter-label {
        font-size: 13px;
        font-weight: 600;
        color: #cbd5e1;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-input, .filter-select {
        padding: 12px 16px;
        border: 2px solid rgba(148, 163, 184, 0.2);
        border-radius: 10px;
        font-size: 14px;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #f1f5f9;
    }

    .filter-input:focus, .filter-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 
            0 0 0 3px rgba(59, 130, 246, 0.2),
            0 0 20px rgba(59, 130, 246, 0.3);
        background: rgba(15, 23, 42, 0.8);
    }

    .filter-input::placeholder {
        color: #64748b;
    }

    .filter-select option {
        background: #1e293b;
        color: #f1f5f9;
    }

    .filter-actions {
        display: flex;
        gap: 12px;
        margin-top: 8px;
        justify-content: flex-end;
    }

    .btn-filter {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
    }

    .btn-filter-primary {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-filter-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }

    .btn-filter-secondary {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        color: #cbd5e1;
        border: 2px solid rgba(148, 163, 184, 0.2);
    }

    .btn-filter-secondary:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(148, 163, 184, 0.4);
        color: #f1f5f9;
        box-shadow: 0 0 15px rgba(148, 163, 184, 0.2);
    }

    .table-responsive {
        overflow-x: auto;
        overflow-y: auto; /* Enable vertical scroll */
        max-height: calc(100vh - 300px); /* Set max height untuk memungkinkan scroll */
        -webkit-overflow-scrolling: touch;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        box-shadow: 
            0 4px 16px rgba(0, 0, 0, 0.2),
            0 0 20px rgba(59, 130, 246, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
        backdrop-filter: blur(20px) saturate(180%);
        position: relative;
    }

    .table-responsive::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        border-radius: 12px 12px 0 0;
        z-index: 1;
    }

    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        min-width: 1200px;
        background: transparent;
        border-radius: 0;
        overflow: hidden;
    }

    thead {
        background: 
            radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.1) 0, transparent 50%),
            radial-gradient(circle at 80% 100%, rgba(139, 92, 246, 0.3) 0, transparent 60%),
            linear-gradient(135deg, #2563eb 0%, #3b82f6 50%, #8b5cf6 100%);
        position: sticky !important; /* Pastikan sticky bekerja */
        top: 0 !important;
        z-index: 100 !important; /* Z-index lebih tinggi untuk memastikan di atas konten */
        box-shadow: 
            0 4px 16px rgba(37, 99, 235, 0.4),
            0 0 20px rgba(59, 130, 246, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
    }

    th {
        padding: 16px 20px;
        text-align: left;
        font-weight: 700;
        font-size: 12px;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important; /* Garis horizontal lebih terlihat */
        border-right: 1px solid rgba(255, 255, 255, 0.2) !important; /* Garis vertikal antar kolom */
        white-space: nowrap;
        position: relative;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    /* Hapus border kanan di kolom terakhir */
    th:last-child {
        border-right: none !important;
    }

    th::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
        pointer-events: none;
    }

    th::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
        pointer-events: none;
    }

    th:first-child {
        border-top-left-radius: 0;
    }

    th:last-child {
        border-top-right-radius: 0;
    }

    td {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.3) !important; /* Garis horizontal lebih terlihat */
        border-right: 1px solid rgba(148, 163, 184, 0.2) !important; /* Garis vertikal antar kolom */
        font-size: 14px;
        color: #f1f5f9;
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Hapus border kanan di kolom terakhir */
    td:last-child {
        border-right: none !important;
    }

    /* Zebra striping dengan dark theme */
    tbody tr:nth-child(even) td {
        background: rgba(30, 41, 59, 0.4);
    }

    tbody tr:nth-child(odd) td {
        background: rgba(15, 23, 42, 0.5);
    }

    tbody tr {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-left: 1px solid transparent;
        border-right: 1px solid transparent;
    }

    tbody tr:hover {
        border-left: 1px solid rgba(59, 130, 246, 0.4);
        border-right: 1px solid rgba(59, 130, 246, 0.4);
    }

    tbody tr:hover td {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(99, 102, 241, 0.1));
        border-bottom-color: rgba(59, 130, 246, 0.3);
        box-shadow: 
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.2),
            0 2px 12px rgba(59, 130, 246, 0.2);
        transform: scale(1.002);
    }
    

    tbody tr:last-child td:first-child {
        border-bottom-left-radius: 12px;
    }

    tbody tr:last-child td:last-child {
        border-bottom-right-radius: 12px;
    }

    .badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        min-width: 100px;
        text-align: center;
    }

    .badge:hover {
        transform: scale(1.05);
    }

    .badge-checking {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.95));
        backdrop-filter: blur(10px);
        color: #dcfce7;
        box-shadow: 
            0 2px 8px rgba(21, 128, 61, 0.3),
            0 0 15px rgba(34, 197, 94, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .badge-done {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.95));
        backdrop-filter: blur(10px);
        color: #dbeafe;
        box-shadow: 
            0 2px 8px rgba(30, 64, 175, 0.3),
            0 0 15px rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .badge-stop {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.95));
        backdrop-filter: blur(10px);
        color: #fee2e2;
        box-shadow: 
            0 2px 8px rgba(220, 38, 38, 0.3),
            0 0 15px rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-action {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        margin-right: 8px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-action:active {
        transform: translateY(0);
    }

    .btn-edit {
        background: linear-gradient(135deg, #facc15, #fbbf24);
        color: #111827;
    }

    .btn-delete {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    /* Center align kolom Aksi */
    th:last-child {
        text-align: center !important;
    }

    /* Center align tombol di kolom Aksi - konsisten dengan kolom lain */
    td:last-child {
        text-align: center !important;
        padding: 16px 20px !important; /* Sama dengan kolom lain */
        vertical-align: middle !important;
        /* Pastikan border sama dengan kolom lain */
        border-bottom: 1px solid rgba(148, 163, 184, 0.3) !important; /* Sama dengan td lain */
        /* Hapus display flex untuk konsistensi background */
        display: table-cell !important; /* Gunakan table-cell agar background sama */
    }
    
    /* Pastikan zebra striping juga berlaku untuk kolom Aksi - override dengan !important */
    tbody tr:nth-child(even) td:last-child {
        background: rgba(30, 41, 59, 0.4) !important;
    }

    tbody tr:nth-child(odd) td:last-child {
        background: rgba(15, 23, 42, 0.5) !important;
    }
    
    /* Pastikan kolom Aksi juga mendapat hover effect yang sama */
    tbody tr:hover td:last-child {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(99, 102, 241, 0.1)) !important;
        border-bottom-color: rgba(59, 130, 246, 0.3) !important;
        box-shadow: 
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.2),
            0 2px 12px rgba(59, 130, 246, 0.2) !important;
        transform: scale(1.002) !important;
    }
    
    /* Styling tombol di kolom Aksi */
    td:last-child .btn-action {
        margin: 0 4px; /* Spacing antar tombol */
        white-space: nowrap; /* Prevent button text wrapping */
        display: inline-flex; /* Inline flex untuk alignment */
        align-items: center;
        gap: 6px;
    }
    
    td:last-child .btn-action:first-child {
        margin-left: 0;
    }
    
    td:last-child .btn-action:last-child {
        margin-right: 0;
    }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #94a3b8;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
        backdrop-filter: blur(20px) saturate(180%);
        border-radius: 16px;
        border: 2px dashed rgba(148, 163, 184, 0.3);
        box-shadow: 
            0 4px 16px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .empty-state-icon {
        font-size: 72px;
        color: #64748b;
        margin-bottom: 24px;
        opacity: 0.6;
        filter: drop-shadow(0 0 10px rgba(100, 116, 139, 0.3));
    }

    .empty-state-title {
        font-size: 22px;
        font-weight: 700;
        background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 12px;
        filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.3));
    }

    .empty-state-text {
        font-size: 15px;
        color: #94a3b8;
        line-height: 1.6;
    }

    .alert {
        padding: 16px 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .alert-success {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.3));
        backdrop-filter: blur(10px);
        color: #86efac;
        border: 2px solid rgba(34, 197, 94, 0.4);
        box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
    }

    .alert-warning {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3));
        backdrop-filter: blur(10px);
        color: #fbbf24;
        border: 2px solid rgba(245, 158, 11, 0.4);
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
    }

    .alert i {
        font-size: 20px;
    }

    /* Responsive Design - Tablet */
    @@media (min-width: 769px) and (max-width: 1024px) {
        .data-table-container {
            padding: 24px;
            margin: 20px 0;
            max-width: 100%;
        }

        .table-title {
            font-size: 26px;
        }

        .filter-row {
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .filter-section {
            padding: 20px;
        }

        .filter-actions {
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .btn-filter {
            flex: 0 0 auto;
            min-width: 140px;
        }

        table {
            min-width: 1000px;
            font-size: 13px;
        }

        th, td {
            padding: 14px 16px;
            font-size: 13px;
        }

        .table-header-actions {
            gap: 10px;
        }

        .btn-add-new {
            padding: 10px 20px;
            font-size: 13px;
        }
    }

    /* Responsive Design - Mobile */
    @@media (max-width: 768px) {
        .data-table-container {
            padding: 20px;
            margin: 16px 0;
            border-radius: 16px;
        }

        .table-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .table-title {
            font-size: 24px;
        }

        .table-header-actions {
            width: 100%;
        }

        .btn-add-new {
            flex: 1;
            justify-content: center;
        }

        .stats-cards {
            grid-template-columns: repeat(2, 1fr);
        }

        .filter-row {
            flex-direction: column;
        }

        .filter-search,
        .filter-select-compact {
            width: 100%;
        }

        .filter-actions {
            flex-direction: column;
        }

        .btn-filter {
            width: 100%;
            justify-content: center;
        }
    }

    @@media (max-width: 480px) {
        .stats-cards {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- Halaman ini HANYA menampilkan data dari DATABASE (tabel QCHoseData) -->
<!-- Data yang ditampilkan adalah data yang sudah tersimpan dari form Input Data QC Hose -->
<div class="data-table-container">
    @Html.AntiForgeryToken()
    
    <div class="table-header">
        <div class="table-header-left">
            <h2 class="table-title">
                <i class="bi bi-table"></i>
                Data E_LWP
            </h2>
            @if (ViewBag.TotalRecords != null)
            {
                <p class="table-subtitle">
                    Total Data: <strong>@ViewBag.TotalRecords</strong> record(s) dari database
                </p>
            }
        </div>
        <div class="table-header-actions">
            <a href="@Url.Action("Index", "MasterData")" class="btn-add-new" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                <i class="bi bi-gear"></i>
                Master Data
            </a>
            <a href="@Url.Action("Create", "QCHose")" class="btn-add-new">
                <i class="bi bi-plus-circle"></i>
                Input Data Baru
            </a>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            <i class="bi bi-check-circle"></i> @TempData["SuccessMessage"]
        </div>
    }

    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> @ViewBag.ErrorMessage
        </div>
    }

    <!-- Statistics Cards -->
    <div class="stats-cards">
        <div class="stat-card blue" id="stat-card-total-hari-ini">
            <div class="stat-card-header">
                <div class="stat-card-title">Total Hari Ini</div>
            </div>
            <div class="stat-card-main">
                <div class="stat-card-value" id="stat-value-total-hari-ini">@(ViewBag.TotalHariIni ?? 0)</div>
                <i class="bi bi-graph-up stat-card-icon"></i>
            </div>
            <div class="stat-card-footer">
                <span id="stat-footer-total-hari-ini">@(ViewBag.TotalHariIni ?? 0) record(s)</span>
            </div>
        </div>

        <div class="stat-card green" id="stat-card-status-checking">
            <div class="stat-card-header">
                <div class="stat-card-title">Status Checking</div>
            </div>
            <div class="stat-card-main">
                <div class="stat-card-value" id="stat-value-status-checking">@(ViewBag.StatusCheckingCount ?? 0)</div>
                <i class="bi bi-check-circle stat-card-icon"></i>
            </div>
            <div class="stat-card-footer">
                <div class="stat-card-progress">
                    <div class="stat-card-progress-bar" id="stat-progress-status-checking" style="width: @(ViewBag.StatusCheckingPercent ?? 0)%"></div>
                </div>
                <span id="stat-footer-status-checking">@(ViewBag.StatusCheckingPercent ?? 0)</span>
            </div>
        </div>

        <div class="stat-card red" id="stat-card-status-ng">
            <div class="stat-card-header">
                <div class="stat-card-title">Status NG</div>
            </div>
            <div class="stat-card-main">
                <div class="stat-card-value" id="stat-value-status-ng">@(ViewBag.StatusNGCount ?? 0)</div>
                <i class="bi bi-x-circle stat-card-icon"></i>
            </div>
            <div class="stat-card-footer">
                <span id="stat-footer-status-ng">@(ViewBag.StatusNGCount ?? 0) issue(s)</span>
            </div>
        </div>

        <div class="stat-card grey" id="stat-card-avg-time-stop">
            <div class="stat-card-header">
                <div class="stat-card-title">Avg Time Stop</div>
            </div>
            @{
                var topNGList = ViewBag.TopNGByLine as List<Tuple<string, string, int>>;
            }
            @if (topNGList != null && topNGList.Any())
            {
                <div class="stat-card-main" id="stat-main-avg-time-stop">
                    <ul class="stat-card-list" style="margin: 0;" id="stat-list-avg-time-stop">
                        @foreach (var item in topNGList)
                        {
                            <li class="stat-card-list-item">
                                <strong>@item.Item1</strong> @item.Item2 <strong>@item.Item3 NG</strong>
                            </li>
                        }
                    </ul>
                    <i class="bi bi-clock stat-card-icon"></i>
                </div>
            }
            else
            {
                <div class="stat-card-main" id="stat-main-avg-time-stop">
                    <div class="stat-card-value" style="font-size: 24px;" id="stat-value-avg-time-stop">
                        @{
                            var avgSeconds = ViewBag.AvgTimeStop ?? 0.0;
                            var avgHours = (int)(avgSeconds / 3600);
                            var avgMinutes = (int)((avgSeconds % 3600) / 60);
                            var avgSecs = (int)(avgSeconds % 60);
                        }
                        @avgHours:@avgMinutes.ToString("00"):@avgSecs.ToString("00")
                    </div>
                    <i class="bi bi-clock stat-card-icon"></i>
                </div>
            }
        </div>
    </div>

    <!-- Simplified Filter Section -->
    <div class="filter-section">
        <form method="get" action="@Url.Action("List", "QCHose")">
            <div class="filter-row">
                <div class="filter-search">
                    <i class="bi bi-search"></i>
                    <input type="text" name="search" placeholder="Search..." value="@ViewBag.Search" />
                </div>
                <select name="lineFilter" class="filter-select-compact">
                    <option value="">Semua Line</option>
                    @if (ViewBag.Lines != null)
                    {
                        @foreach (var line in ViewBag.Lines)
                        {
                            <option value="@line" selected="@(ViewBag.LineFilter == line)">@line</option>
                        }
                    }
                </select>
                <select name="dateFilter" class="filter-select-compact" onchange="this.form.submit()">
                    <option value="" selected="@(ViewBag.DateFilter == null || ViewBag.DateFilter == "")">Hari Ini</option>
                    <option value="week" selected="@(ViewBag.DateFilter == "week")">Minggu Ini</option>
                    <option value="month" selected="@(ViewBag.DateFilter == "month")">Bulan Ini</option>
                </select>
                <button type="submit" class="btn-filter btn-filter-primary">
                    <i class="bi bi-search"></i> Filter
                </button>
            </div>
            <a href="#" class="filter-advanced-link" onclick="toggleAdvancedFilter(event)">
                <i class="bi bi-chevron-down"></i> Filter Lanjutan
            </a>
            <div class="filter-advanced-section" id="advancedFilter">
                <div class="filter-advanced-row">
                    <div class="filter-item">
                        <label class="filter-label">
                            <i class="bi bi-person"></i> Inspector
                        </label>
                        <select name="inspectorFilter" class="filter-select">
                            <option value="">Semua Inspector</option>
                            @if (ViewBag.Inspectors != null)
                            {
                                @foreach (var inspector in ViewBag.Inspectors)
                                {
                                    <option value="@inspector" selected="@(ViewBag.InspectorFilter == inspector)">@inspector</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">
                            <i class="bi bi-upc-scan"></i> Part Code
                        </label>
                        <select name="partCodeFilter" class="filter-select">
                            <option value="">Semua Part Code</option>
                            @if (ViewBag.PartCodes != null)
                            {
                                @foreach (var partCode in ViewBag.PartCodes)
                                {
                                    <option value="@partCode" selected="@(ViewBag.PartCodeFilter == partCode)">@partCode</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">
                            <i class="bi bi-calendar"></i> Dari Tanggal
                        </label>
                        <input type="date" name="dateFrom" class="filter-input" value="@(ViewBag.DateFrom?.ToString("yyyy-MM-dd"))" />
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">
                            <i class="bi bi-calendar-check"></i> Sampai Tanggal
                        </label>
                        <input type="date" name="dateTo" class="filter-input" value="@(ViewBag.DateTo?.ToString("yyyy-MM-dd"))" />
                    </div>
                </div>
                <div class="filter-actions" style="margin-top: 16px;">
                    <a href="@Url.Action("List", "QCHose")" class="btn-filter btn-filter-secondary">
                        <i class="bi bi-x-circle"></i> Reset
                    </a>
                </div>
            </div>
        </form>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="bi bi-inbox"></i>
            </div>
            <div class="empty-state-title">Belum Ada Data</div>
            <div class="empty-state-text">
                Data E_LWP masih kosong. Klik tombol "Input Data Baru" untuk menambahkan data pertama.
            </div>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Plant</th>
                        <th>Line Checking</th>
                        <th>Inspector</th>
                        <th>Group</th>
                        <th>Part Code</th>
                        <th>Time Stop</th>
                        <th>Qty Check</th>
                        <th>Jenis NG</th>
                        <th>Nama OPR</th>
                        <th>Qty NG</th>
                        <th>Line Stop</th>
                        <th>Status</th>
                        <th>Status Time</th>
                        <th>Grup</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.TanggalInput.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@(string.IsNullOrEmpty(item.Plant) ? "-" : item.Plant)</td>
                            <td>@(string.IsNullOrEmpty(item.LineChecking) ? "-" : item.LineChecking)</td>
                            <td>@(string.IsNullOrEmpty(item.NamaInspector) ? "-" : item.NamaInspector)</td>
                            <td>@(string.IsNullOrEmpty(item.GroupChecking) ? "-" : item.GroupChecking)</td>
                            <td>@(string.IsNullOrEmpty(item.PartCode) ? "-" : item.PartCode)</td>
                            <td>@(string.IsNullOrEmpty(item.TimeStop) ? "-" : item.TimeStop)</td>
                            <td>@(item.QtyCheck?.ToString() ?? "-")</td>
                            <td>@(string.IsNullOrEmpty(item.JenisNG) ? "-" : item.JenisNG)</td>
                            <td>@(string.IsNullOrEmpty(item.NamaOPR) ? "-" : item.NamaOPR)</td>
                            <td>@(item.QtyNG?.ToString() ?? "-")</td>
                            <td>@(string.IsNullOrEmpty(item.LineStop) ? "-" : item.LineStop)</td>
                            <td>
                                @{
                                    var statusClass = item.StatusChecking == "Checking" ? "badge-checking" : 
                                                     item.StatusChecking == "Done" ? "badge-done" : "badge-stop";
                                }
                                <select class="badge @statusClass" 
                                        onchange="updateStatus(@item.Id, this.value)" 
                                        style="border: none; cursor: pointer; font-size: 12px; padding: 4px 12px;">
                                    @if (item.StatusChecking == "Checking")
                                    {
                                        <option value="Checking" selected>Checking</option>
                                        <option value="Done">Done</option>
                                        <option value="Stop">Stop</option>
                                    }
                                    else if (item.StatusChecking == "Done")
                                    {
                                        <option value="Checking">Checking</option>
                                        <option value="Done" selected>Done</option>
                                        <option value="Stop">Stop</option>
                                    }
                                    else
                                    {
                                        <option value="Checking">Checking</option>
                                        <option value="Done">Done</option>
                                        <option value="Stop" selected>Stop</option>
                                    }
                                </select>
                            </td>
                            <td>@(string.IsNullOrEmpty(item.StatusCheckingTime) ? "-" : item.StatusCheckingTime)</td>
                            <td>@(string.IsNullOrEmpty(item.Grup) ? "-" : item.Grup)</td>
                            <td>
                                <a href="@Url.Action("Edit", "QCHose", new { id = item.Id })" class="btn-action btn-edit">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                <button type="button" class="btn-action btn-delete" onclick="confirmDelete(@item.Id)">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@section Scripts {
    <script>
        function updateStatus(id, status) {
            fetch('@Url.Action("UpdateStatus", "QCHose")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                },
                body: JSON.stringify({ Id: id, Status: status })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                    location.reload();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat update status');
            });
        }

        function confirmDelete(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                // Get anti-forgery token
                const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value || '';
                
                // Create form data
                const formData = new FormData();
                formData.append('__RequestVerificationToken', token);
                
                // Send delete request
                fetch('/QCHose/Delete/' + id, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        // Redirect to list page to show success message
                        window.location.href = '/QCHose/List';
                    } else {
                        alert('Terjadi kesalahan saat menghapus data');
                        location.reload();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan saat menghapus data');
                    location.reload();
                });
            }
        }

        function toggleAdvancedFilter(event) {
            event.preventDefault();
            const advancedSection = document.getElementById('advancedFilter');
            const link = event.currentTarget;
            const icon = link.querySelector('i');
            
            if (advancedSection.classList.contains('show')) {
                advancedSection.classList.remove('show');
                icon.style.transform = 'rotate(0deg)';
            } else {
                advancedSection.classList.add('show');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // ===============================================
        // ðŸ”¥ REAL-TIME WEBSOCKET - SignalR Integration
        // ===============================================
    </script>

    <!-- SignalR CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>

    <script>
        // Initialize SignalR connection
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/qcHub")
            .withAutomaticReconnect()
            .build();

        // ðŸ‘‚ Listen for "NewQCDataAdded" event from server
        connection.on("NewQCDataAdded", function (data) {
            console.log("ðŸ“© New QC Data received via WebSocket:", data);
            
            // Add new row to table with animation
            addNewRowToTable(data);
            
            // Show toast notification
            showRealtimeToast(`New data added by ${data.namaInspector}`);
            
            // Update total count (if exists)
            updateTotalCount();
            
            // Update statistics cards
            updateStatisticsCards(data);
        });

        // Function to add new row to table dynamically
        function addNewRowToTable(data) {
            // Try multiple selectors to find the table - prioritize data-table-container
            const tbody = document.querySelector('.data-table-container table tbody') || 
                         document.querySelector('.data-table-container tbody') ||
                         document.querySelector('table tbody');
            if (!tbody) {
                console.warn('Table tbody not found. Available tables:', document.querySelectorAll('table').length);
                console.warn('Trying to find table in .data-table-container:', document.querySelectorAll('.data-table-container table').length);
                return;
            }
            
            console.log('âœ… Table tbody found, adding new row:', data);

            // Create new row element
            const newRow = document.createElement('tr');
            newRow.style.animation = 'fadeInUp 0.5s ease';
            newRow.style.backgroundColor = '#dbeafe'; // Highlight biru muda
            
            // Determine status class
            const statusClass = data.statusChecking === "Checking" ? "badge-checking" : 
                               data.statusChecking === "Done" ? "badge-done" : "badge-stop";
            
            // Build row HTML sesuai dengan struktur tabel yang sebenarnya (16 kolom)
            // Urutan: Tanggal, Plant, Line Checking, Inspector, Group, Part Code, Time Stop, Qty Check, Jenis NG, Nama OPR, Qty NG, Line Stop, Status, Status Time, Grup, Aksi
            // Plant diambil dari data yang dikirim via WebSocket (dari database)
            newRow.innerHTML = `
                <td>${data.tanggalInput || '-'}</td>
                <td>${data.plant || '-'}</td>
                <td>${data.lineChecking || '-'}</td>
                <td>${data.namaInspector || '-'}</td>
                <td>${data.groupChecking || '-'}</td>
                <td>${data.partCode || '-'}</td>
                <td>${data.timeStop || '-'}</td>
                <td>${data.qtyCheck || '-'}</td>
                <td>${data.jenisNG || '-'}</td>
                <td>${data.namaOPR || '-'}</td>
                <td>${data.qtyNG || '-'}</td>
                <td>${data.lineStop || '-'}</td>
                <td>
                    <select class="badge ${statusClass}" 
                            onchange="updateStatus(${data.id}, this.value)" 
                            style="border: none; cursor: pointer; font-size: 12px; padding: 4px 12px;">
                        <option value="Checking" ${data.statusChecking === 'Checking' ? 'selected' : ''}>Checking</option>
                        <option value="Done" ${data.statusChecking === 'Done' ? 'selected' : ''}>Done</option>
                        <option value="Stop" ${data.statusChecking === 'Stop' ? 'selected' : ''}>Stop</option>
                    </select>
                </td>
                <td>-</td>
                <td>${data.grup || '-'}</td>
                <td>
                    <a href="/QCHose/Edit/${data.id}" class="btn-action btn-edit">
                        <i class="bi bi-pencil-square"></i> Edit
                    </a>
                    <button onclick="confirmDelete(${data.id})" class="btn-action btn-delete">
                        <i class="bi bi-trash"></i> Hapus
                    </button>
                </td>
            `;

            // Insert at the top of table
            tbody.insertBefore(newRow, tbody.firstChild);

            // Remove highlight after animation
            setTimeout(() => {
                newRow.style.backgroundColor = '';
            }, 2000);
        }

        // Function to show real-time toast notification
        function showRealtimeToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 90px;
                right: 30px;
                padding: 16px 24px;
                background: linear-gradient(135deg, #22c55e, #16a34a);
                color: white;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(34, 197, 94, 0.4);
                z-index: 10000;
                font-weight: 600;
                font-size: 14px;
                display: flex;
                align-items: center;
                gap: 10px;
                animation: slideInRight 0.4s ease, pulse 1.5s ease 0.4s;
            `;
            
            toast.innerHTML = `
                <i class="bi bi-check-circle-fill" style="font-size: 20px;"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Function to update total count (optional)
        function updateTotalCount() {
            const countElement = document.querySelector('.table-subtitle strong');
            if (countElement) {
                const currentCount = parseInt(countElement.textContent) || 0;
                countElement.textContent = currentCount + 1;
            }
        }

        // Function to update statistics cards in real-time
        function updateStatisticsCards(data) {
            console.log('Updating statistics cards...');
            
            // Update TOTAL HARI INI
            const totalHariIniValue = document.getElementById('stat-value-total-hari-ini');
            const totalHariIniFooter = document.getElementById('stat-footer-total-hari-ini');
            if (totalHariIniValue && totalHariIniFooter) {
                const currentTotal = parseInt(totalHariIniValue.textContent) || 0;
                const newTotal = currentTotal + 1;
                totalHariIniValue.textContent = newTotal;
                totalHariIniFooter.textContent = `${newTotal} record(s)`;
                
                // Add animation effect
                totalHariIniValue.style.animation = 'pulse 0.5s ease';
                setTimeout(() => {
                    totalHariIniValue.style.animation = '';
                }, 500);
            }
            
            // Update STATUS CHECKING (if status is "Checking")
            if (data.statusChecking === "Checking") {
                const statusCheckingValue = document.getElementById('stat-value-status-checking');
                const statusCheckingProgress = document.getElementById('stat-progress-status-checking');
                const statusCheckingFooter = document.getElementById('stat-footer-status-checking');
                
                if (statusCheckingValue) {
                    const currentChecking = parseInt(statusCheckingValue.textContent) || 0;
                    const newChecking = currentChecking + 1;
                    statusCheckingValue.textContent = newChecking;
                    
                    // Update progress bar and percentage
                    const totalHariIni = parseInt(document.getElementById('stat-value-total-hari-ini')?.textContent) || 1;
                    const percentage = Math.round((newChecking / totalHariIni) * 100);
                    
                    if (statusCheckingProgress) {
                        statusCheckingProgress.style.width = `${percentage}%`;
                    }
                    if (statusCheckingFooter) {
                        statusCheckingFooter.textContent = percentage;
                    }
                    
                    // Add animation effect
                    statusCheckingValue.style.animation = 'pulse 0.5s ease';
                    setTimeout(() => {
                        statusCheckingValue.style.animation = '';
                    }, 500);
                }
            }
            
            // Update STATUS NG (if qtyNG > 0)
            const qtyNG = parseInt(data.qtyNG) || 0;
            if (qtyNG > 0) {
                const statusNGValue = document.getElementById('stat-value-status-ng');
                const statusNGFooter = document.getElementById('stat-footer-status-ng');
                
                if (statusNGValue) {
                    const currentNG = parseInt(statusNGValue.textContent) || 0;
                    const newNG = currentNG + 1;
                    statusNGValue.textContent = newNG;
                    
                    if (statusNGFooter) {
                        statusNGFooter.textContent = `${newNG} issue(s)`;
                    }
                    
                    // Add animation effect
                    statusNGValue.style.animation = 'pulse 0.5s ease';
                    setTimeout(() => {
                        statusNGValue.style.animation = '';
                    }, 500);
                }
            }
            
            // Fetch updated AVG TIME STOP from server (because calculation is complex)
            fetchStatisticsFromServer();
        }

        // Function to fetch updated statistics from server
        function fetchStatisticsFromServer() {
            // Get current filter parameters from URL
            const urlParams = new URLSearchParams(window.location.search);
            const dateFilter = urlParams.get('dateFilter') || '';
            
            // Fetch statistics endpoint (we'll need to create this endpoint)
            fetch(`/QCHose/GetStatistics?dateFilter=${dateFilter}`)
                .then(response => response.json())
                .then(stats => {
                    console.log('Statistics fetched from server:', stats);
                    
                    // Update AVG TIME STOP
                    updateAvgTimeStop(stats.avgTimeStop, stats.topNGByLine);
                })
                .catch(error => {
                    console.error('Error fetching statistics:', error);
                });
        }

        // Function to update AVG TIME STOP card
        function updateAvgTimeStop(avgSeconds, topNGList) {
            const statMain = document.getElementById('stat-main-avg-time-stop');
            if (!statMain) return;
            
            if (topNGList && topNGList.length > 0) {
                // Show Top NG list
                let statList = document.getElementById('stat-list-avg-time-stop');
                if (statList) {
                    statList.innerHTML = '';
                    topNGList.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'stat-card-list-item';
                        li.innerHTML = `<strong>${item.line || item.Line || '-'}</strong> ${item.jenisNG || item.JenisNG || '-'} <strong>${item.count || item.Count || 0} NG</strong>`;
                        statList.appendChild(li);
                    });
                } else {
                    // Create list if doesn't exist
                    const ul = document.createElement('ul');
                    ul.className = 'stat-card-list';
                    ul.style.margin = '0';
                    ul.id = 'stat-list-avg-time-stop';
                    topNGList.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'stat-card-list-item';
                        li.innerHTML = `<strong>${item.line || item.Line || '-'}</strong> ${item.jenisNG || item.JenisNG || '-'} <strong>${item.count || item.Count || 0} NG</strong>`;
                        ul.appendChild(li);
                    });
                    statMain.innerHTML = '';
                    statMain.appendChild(ul);
                    const icon = document.createElement('i');
                    icon.className = 'bi bi-clock stat-card-icon';
                    statMain.appendChild(icon);
                }
            } else {
                // Show average time
                const hours = Math.floor((avgSeconds || 0) / 3600);
                const minutes = Math.floor(((avgSeconds || 0) % 3600) / 60);
                const secs = Math.floor((avgSeconds || 0) % 60);
                const timeString = `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                let statValue = document.getElementById('stat-value-avg-time-stop');
                if (statValue) {
                    statValue.textContent = timeString;
                } else {
                    // Remove list if exists
                    const statList = document.getElementById('stat-list-avg-time-stop');
                    if (statList) {
                        statList.remove();
                    }
                    statMain.innerHTML = `
                        <div class="stat-card-value" style="font-size: 24px;" id="stat-value-avg-time-stop">${timeString}</div>
                        <i class="bi bi-clock stat-card-icon"></i>
                    `;
                }
            }
        }

        // Start SignalR connection
        connection.start()
            .then(() => {
                console.log("âœ… WebSocket connected! Listening for real-time updates...");
            })
            .catch(err => {
                console.error("âŒ WebSocket connection error:", err);
            });

        // Handle reconnection
        connection.onreconnecting(error => {
            console.log("ðŸ”„ Reconnecting to WebSocket...", error);
        });

        connection.onreconnected(connectionId => {
            console.log("âœ… WebSocket reconnected! ConnectionId:", connectionId);
        });

        connection.onclose(error => {
            console.log("âš ï¸ WebSocket connection closed", error);
        });

        // Add CSS animations (check if already exists)
        if (!window.websocketAnimationsAdded) {
            let animationStyle = document.getElementById('websocket-animations-style');
            if (!animationStyle) {
                animationStyle = document.createElement('style');
                animationStyle.id = 'websocket-animations-style';
                animationStyle.textContent = `
            @@keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @@keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @@keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }

            @@keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }
        `;
                document.head.appendChild(animationStyle);
                window.websocketAnimationsAdded = true;
            }
        }
    </script>
}
